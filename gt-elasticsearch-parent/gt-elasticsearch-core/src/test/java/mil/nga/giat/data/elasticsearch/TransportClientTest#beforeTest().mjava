    @Before
    public void beforeTest() throws InterruptedException, ExecutionException {
        indexName = "an_index";
        typeName = "a_type";
        client = ESIntegTestCase.internalCluster().transportClient();
        client.prepareIndex(indexName, typeName, "1").setSource("{\"key\":\"value\"}").execute().actionGet();
        elasticClient = new TransportElasticClient(client);

        mockClient = mock(Client.class);
        mockBuilder = mock(SearchRequestBuilder.class);
        when(mockClient.prepareSearch(anyString())).thenReturn(mockBuilder);
        when(mockBuilder.setTypes(anyString())).thenReturn(mockBuilder);
        when(mockBuilder.setSearchType(any(SearchType.class))).thenReturn(mockBuilder);
        mockSearchResponseFuture = mock(ListenableActionFuture.class);
        when(mockSearchResponseFuture.get()).thenReturn(mock(SearchResponse.class));
        when(mockBuilder.execute()).thenReturn(mockSearchResponseFuture);

        mockElasticClient = new TransportElasticClient(mockClient);
    }

