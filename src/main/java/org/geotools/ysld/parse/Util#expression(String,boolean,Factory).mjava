    /**
     * Parses an expression from its string representation.
     * <p>
     * The <tt>safe</tt> parameter when set to true will cause null to be returned
     * when the string can not be parsed as a ECQL expression. When false it will
     * return a literal.
     * </p>
     */
    public static Expression expression(String value, boolean safe, Factory factory) {
        try {
            Expression expr = ECQL.toExpression(value, factory.filter);
            if (expr instanceof PropertyName && !ATTRIBUTE_PATTERN.matcher(value).matches()) {
                // treat as literal
                return factory.filter.literal(((PropertyName) expr).getPropertyName());
            }
            return expr;
        } catch (CQLException e) {
            //TODO: log this?
            return safe ? null : factory.filter.literal(value);
            //throw new ParseException("Bad expression: "+value, evt, e);
        }
    }

