    /**
     * Connect to the shapefile and prompt the user to choose a feature
     * attribute to base line and fill colours on. A colour will be
     * generated for each unique value of the chosen attribute.
     */
    private void displayShapefile(File file) throws Exception {
        FileDataStore store = FileDataStoreFinder.getDataStore(file);
        FeatureSource featureSource = store.getFeatureSource();

        // Create a map context and add our shapefile to it
        MapContext map = new DefaultMapContext();
        map.setTitle("Style Function Lab");

        /*
         * Prompt the user for the feature attribute used to
         * determine the line and fill colour for each feature
         */
        FeatureType type = featureSource.getSchema();
        PropertyDescriptor geomDesc = type.getGeometryDescriptor();
        List<String> attributeNames = new ArrayList<String>();
        for (PropertyDescriptor desc : type.getDescriptors()) {
            if (!desc.equals(geomDesc)) {
                attributeNames.add(desc.getName().getLocalPart());
            }
        }

        Object selection = JOptionPane.showInputDialog(null,
                "Unique values of the attribute will be used to create a colour lookup table",
                "Select feature attribute",
                JOptionPane.PLAIN_MESSAGE, null,
                attributeNames.toArray(), null);

        /**
         * Create the Style and display the shapefile
         */
        if (selection != null) {
            Style style = createStyle(featureSource, (String)selection);
            map.addLayer(featureSource, style);

            // Now display the map
            JMapFrame.showMap(map);
        }
    }

