    /**
     * Opens a shapefile provided by the user (that should contain line or polygon features), then
     * iterates over the features within it to calculate the sum of their line or boundary length.
     * The user can specify the path/name of the shapefile as an argument on the command line;
     * otherwise a dialog is displayed to prompt for the file.
     * <p>
     * <b>Note:</b> If specifying the shapefile at the command line, don't forget the quotes around
     * your path if there are spaces!
     * <p>
     * The code for this method illustrates:
     * <ul>
     * <li>connecting to the shapefile using a {@code DataStore} object
     * <li>accessing features in the shapefile
     * <li>getting spatial data for each feature
     * </ul>
     * 
     * @param args
     *            Optionally, the path and name of the shapefile
     * 
     * @throws java.lang.Exception
     *             if the shapefile cannot be opened
     */
    public static void main(String[] args) throws Exception {
        System.out.println("Welcome to GeoTools:" + GeoTools.getVersion());

        /*
         * Get the shapefile, prompting for its path/name if this was not provided on the command
         * line
         */
        File file = promptShapeFile(args);

        try {
            /*
             * Attmpt to find a GeoTools DataStore that can handle the shapefile
             */
            Map<String, Serializable> connectParameters = new HashMap<String, Serializable>();

            connectParameters.put("url", file.toURI().toURL());
            connectParameters.put("create spatial index", true);

            DataStore dataStore = DataStoreFinder.getDataStore(connectParameters);
            if (dataStore == null) {
                Logger.getLogger(FirstProject.class.getName()).log(Level.WARNING,
                        "No DataStore found to handle" + file.getPath());
                System.exit(1);
            }

            /*
             * We are now connected to the shapefile. Get the type name of the features within it
             */
            String[] typeNames = dataStore.getTypeNames();
            String typeName = typeNames[0];

            /*
             * Iterate through the features, collecting some spatial data (line or boundary length)
             * on each one
             */
            SimpleFeatureSource featureSource =
                    dataStore.getFeatureSource(typeName);

            SimpleFeatureCollection collection =
                    featureSource.getFeatures();

            SimpleFeatureIterator iterator = collection.features();

            double totalLength = 0.0;
            try {
                while (iterator.hasNext()) {
                    SimpleFeature feature = iterator.next();

                    /*
                     * The spatial portion of the feature is represented by a Geometry object
                     */
                    Geometry geometry = (Geometry) feature.getDefaultGeometry();
                    totalLength += geometry.getLength();
                }
            } finally {
                /*
                 * You MUST explicitly close the feature iterator otherwise terrible things will
                 * happen !!!
                 */
                if (iterator != null) {
                    iterator.close();
                }
            }

            /*
             * Find out what units the features are measured in so that
             * we can display the results with this info
             */
            String units = "";
            CoordinateReferenceSystem crs = featureSource.getSchema().getCoordinateReferenceSystem();
            if (crs != null) {
                Unit<?> distanceUnit = crs.getCoordinateSystem().getAxis(0).getUnit();
                units = distanceUnit.toString();
            }
            JOptionPane.showMessageDialog(null,
                    String.format("Total length is %.4f %s", totalLength, units));

        } catch (Exception ex) {
            ex.printStackTrace();
            System.exit(1);
        }

        System.exit(0);
    }

