    protected Geobuf.Data.FeatureCollection encodeAsFeatureCollection(
            SimpleFeatureCollection featureCollection) {
        Geobuf.Data.FeatureCollection.Builder featureCollectionBuilder =
                Geobuf.Data.FeatureCollection.newBuilder();
        try (SimpleFeatureIterator it = featureCollection.features()) {
            while (it.hasNext()) {
                featureCollectionBuilder.addFeatures(geobufFeature.encode(it.next()));
            }
        }
        return featureCollectionBuilder.build();
    }

