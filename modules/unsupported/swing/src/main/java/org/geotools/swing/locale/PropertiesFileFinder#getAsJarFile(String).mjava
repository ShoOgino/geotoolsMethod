    /**
     * Returns a {@code JarInputStream} for the given jar.
     * 
     * @param jarPath the path
     * @return the input stream
     * @throws IllegalArgumentException if the jar cannot be found
     * @throws IOException on error opening file
     */
    private JarInputStream getAsJarFile(String jarPath) throws IOException {
        boolean filePrefix = jarPath.startsWith("file:");
        int pos = jarPath.indexOf(".jar!");

        if (!filePrefix || pos <= 0) {
            throw new IllegalArgumentException("Not a valid jar path");
        }
        
        String trimmed = jarPath.substring(5, pos + 4);
        File file = new File(trimmed);
        if (!file.exists()) {
            throw new IllegalArgumentException("File not found: " + file);
        }
        
        return new JarInputStream(new FileInputStream(file));
    }

