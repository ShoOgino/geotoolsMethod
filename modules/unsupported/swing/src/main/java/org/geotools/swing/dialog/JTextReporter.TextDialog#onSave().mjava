        private void onSave() {
            int len = textArea.getDocument().getLength();
            if (len > 0) {
                try {
                    // allow the file chooser to be on top of this dialog
                    boolean alwaysOnTop = isAlwaysOnTop();
                    setAlwaysOnTop(false);

                    File file = FileHelper.getFile();

                    // restore normal setting
                    setAlwaysOnTop(alwaysOnTop);

                    if (file != null) {
                        try (Writer writer = new BufferedWriter(new FileWriter(file))) {
                            for (int line = 0; line < textArea.getLineCount(); line++) {
                                int start = textArea.getLineStartOffset(line);
                                int end = textArea.getLineEndOffset(line);
                                String lineText = textArea.getText(start, end - start);
                                if (lineText.endsWith("\n")) {
                                    lineText = lineText.substring(0, lineText.length() - 1);
                                }
                                writer.write(lineText);
                                writer.write(NEWLINE);
                            }
                        }
                    }

                } catch (IOException ex) {
                    throw new IllegalStateException(ex);
                } catch (BadLocationException ex) {
                    // this should never happen
                    throw new IllegalStateException("Internal error getting report to save");
                }
            }
        }

