    /**
     * Waits of an event of the specified type to be received.
     *
     * @param type event type
     * @param timeoutMillis maximum waiting time
     * @return {@code true} if the event was received
     */
    public synchronized boolean await(E type, long timeoutMillis) {
        CountDownLatch latch = latches[type.ordinal()];
        if (latch == null) {
            throw new IllegalStateException("latch not set for " + type);
        }

        boolean result = false;
        try {
            result = latch.await(timeoutMillis, TimeUnit.MILLISECONDS);
        } catch (InterruptedException ex) {
            // do nothing
        } finally {
            latches[type.ordinal()] = null;
        }
        return result;
    }

