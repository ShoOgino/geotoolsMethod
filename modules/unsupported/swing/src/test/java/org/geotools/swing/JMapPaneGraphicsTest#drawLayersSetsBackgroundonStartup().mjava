    /** Test for GEOT-6342, background color is not used in 1st rendering of map */
    @Test
    public void drawLayersSetsBackgroundonStartup()
            throws InvocationTargetException, InterruptedException, IOException {

        window.show(new Dimension(WIDTH, HEIGHT));
        MapContent mapContent = createMapContent(createMatchedBounds(mapPane.getVisibleRect()));
        mapPane.setMapContent(mapContent);
        SwingUtilities.invokeAndWait(
                new Runnable() {

                    @Override
                    public void run() {
                        mapPane.setBackground(Color.BLUE);
                    }
                });

        mapPane.drawLayers(true);
        BufferedImage image = (BufferedImage) mapPane.getBaseImage();

        WritableRaster raster = image.getRaster();
        int[] pixel = new int[4];
        raster.getPixel(1, 1, pixel);
        assertEquals("Pixel at (1,1) was not renderered", 0, pixel[0]);
        assertEquals("Pixel at (1,1) was not renderered", 0, pixel[1]);
        assertEquals("Pixel at (1,1) was not renderered", 255, pixel[2]);
    }

