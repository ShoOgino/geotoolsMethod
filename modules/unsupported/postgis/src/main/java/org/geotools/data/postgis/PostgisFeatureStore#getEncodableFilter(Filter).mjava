	private FidFilter getEncodableFilter(Filter unEncodableFilter)
        throws IOException, FactoryRegistryException, IllegalAttributeException {
        // this is very similar to getFidSet - the reason is so that we
        // don't spend time constructing geometries when we don't need
        // to, but we probably could get some better code reuse.
        DefaultQuery query = new DefaultQuery();
        query.setPropertyNames(new String[0]);
        query.setFilter(unEncodableFilter);

        SimpleFeatureCollection features = getFeatures(unEncodableFilter);

        FilterFactory ff = FilterFactoryFinder.createFilterFactory();
        FidFilter fidFilter = ff.createFidFilter();
        SimpleFeatureIterator it = features.features();
        try {
            while( it.hasNext() ) {
                SimpleFeature feature = (SimpleFeature) it.next();
                fidFilter.addFid(feature.getID());
            }
        } finally {
          features.close( it );  
        }
        return fidFilter;
    }

