    private void encodeGeomFilter(GeometryFilter filter, String function, String comparison, boolean useIndex) {
        //this method blindly assumes that the filter is supported
        DefaultExpression left = (DefaultExpression) filter.getLeftGeometry();
        DefaultExpression right = (DefaultExpression) filter.getRightGeometry();

        try {
            //should we use the index?
            if (useIndex) {
                encodeExpression(left);
                out.write(" && ");
                encodeExpression(right);
            }
            
            // looseBbox only applies to GEOMETRY_BBOX, so unless this is a
            // BBOX, we will always generate the full SQL.
            if (filter.getFilterType() != AbstractFilter.GEOMETRY_BBOX || !looseBbox) {
                if (useIndex) {
                    out.write(" AND ");
                }
            	out.write(function + "(");
                encodeExpression(left);
                out.write(", ");
                encodeExpression(right);
                out.write(")" + comparison);
            }
        } catch (java.io.IOException ioe) {
            LOGGER.warning("Unable to export filter" + ioe);
        }
    }

