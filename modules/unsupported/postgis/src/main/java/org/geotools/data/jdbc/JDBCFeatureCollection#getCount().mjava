    /**
     * Performs optimized count if possible.
     *
     *
     * @throws IOException
     *
     * @see org.geotools.data.DefaultFeatureResults#getCount()
     */
    public int getCount() throws IOException {
        int count = getFeatureSource().count(query, getTransaction());

        if (count != -1) {
            // optimization worked, return maxFeatures if count is
            // greater.
            int maxFeatures = query.getMaxFeatures();
            return (count < maxFeatures) ? count : maxFeatures;
        }

        return super.getCount();
    }

