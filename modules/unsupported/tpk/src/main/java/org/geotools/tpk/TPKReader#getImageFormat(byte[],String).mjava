    /**
     * Infer file type from file data if possible -- In case TPK files allow tiles with mixed
     * formats we don't want to be entirely dependent on the Conf.xml "CacheTileFormat" element
     *
     * @param imageData -- reference to the raw byte data of the image
     * @param format -- format derived from metadata table
     * @return -- the inferred file type
     */
    private static String getImageFormat(byte[] imageData, String format) {
        String inferred = ImageFormats.inferFormatFromImageData(imageData);
        if (inferred != null && !inferred.equalsIgnoreCase(format)) {
            LOGGER.fine(
                    String.format("Overriding tile format: was %s, set to %s", format, inferred));
        }
        return (inferred != null ? inferred : format);
    }

