    /**
     * Get coordinates from a geometry and eliminate positions with equal coordinates
     *
     * @param geom
     * @return
     */
    // positions might actually go NPE, just ignoring it as the module is generally broken
    @SuppressFBWarnings("NP_NULL_ON_SOME_PATH")
    private static Coordinate[] extractCoordinates(GeometryImpl geom) {
        // Get relevant coordinates from the geometry instance

        Collection positions = null;

        if (geom instanceof PointImpl) {
            // Add point
            positions = new ArrayList<DirectPositionImpl>();
            positions.add(((PointImpl) geom).getDirectPosition());
        } else if (geom instanceof CurveImpl) {
            // Add control points
            positions = ((CurveImpl) geom).asDirectPositions();
        } else if (geom instanceof RingImpl) {
            // Add control points
            positions = ((RingImplUnsafe) geom).asDirectPositions();
        } else if (geom instanceof SurfaceImpl) {
            // Add control points of exterior ring of boundary
            positions =
                    ((RingImplUnsafe) ((SurfaceImpl) geom).getBoundary().getExterior())
                            .asDirectPositions();
        } else if (geom instanceof MultiPointImpl) {
            // Add all points of the set
            positions = ((MultiPointImpl) geom).getElements();
        } else if (geom instanceof MultiCurveImpl) {
            // Add all curves of the set
            positions = new HashSet<DirectPositionImpl>();
            Iterator<OrientableCurve> curveIter = ((MultiCurveImpl) geom).getElements().iterator();
            while (curveIter.hasNext()) {
                positions.addAll(((CurveImpl) curveIter.next()).asDirectPositions());
            }
        } else if (geom instanceof MultiSurfaceImpl) {
            // Add all exterior rings of the surfaceboundaries of the surfaces in the set
            positions = new HashSet<DirectPositionImpl>();
            Iterator<OrientableSurface> surfaceIter =
                    ((MultiSurfaceImpl) geom).getElements().iterator();
            while (surfaceIter.hasNext()) {
                positions.addAll(
                        ((RingImplUnsafe)
                                        ((SurfaceImpl) surfaceIter.next())
                                                .getBoundary()
                                                .getExterior())
                                .asDirectPositions());
            }
        } else if (geom instanceof MultiPrimitiveImpl) {
            positions = new HashSet<PointImpl>();
            Iterator<? extends Primitive> iterator =
                    ((MultiPrimitiveImpl) geom).getElements().iterator();
            while (iterator.hasNext()) {
                PrimitiveImpl prim = ((PrimitiveImpl) iterator.next());

                // if this is a point, it has no boundary so just add the point
                if (prim instanceof PointImpl) {
                    positions.add(prim);
                } else {
                    // this is not a point, so get its convexhull and add those
                    // points to this hull
                    Geometry hull = prim.getConvexHull();

                    if (hull instanceof CurveImpl) {
                        CurveImpl curve = (CurveImpl) prim.getConvexHull();
                        positions.addAll(((CurveImpl) curve).asDirectPositions());
                    } else if (hull instanceof SurfaceImpl) {
                        SurfaceImpl surface = (SurfaceImpl) prim.getConvexHull();
                        positions.addAll(
                                ((RingImplUnsafe)
                                                ((SurfaceImpl) surface).getBoundary().getExterior())
                                        .asDirectPositions());
                    }

                    /*
                    // this is not a point, so get its boundary and add its
                    // positions to the list.
                    PrimitiveBoundaryImpl pb = (PrimitiveBoundaryImpl) (prim.getBoundary());
                     if (pb instanceof CurveBoundaryImpl) {
                    	 CurveBoundaryImpl boundary = (CurveBoundaryImpl) pb;
                    	 positions.add(boundary.getStartPoint());
                    	 positions.add(boundary.getEndPoint());
                     }
                     else if (pb instanceof SolidBoundaryImpl) {
                    	 SolidBoundaryImpl boundary = (SolidBoundaryImpl) pb;
                    	 positions.addAll(boundary.getExterior().getElements());
                     }
                     else if (pb instanceof SurfaceBoundaryImpl) {
                    	 SurfaceBoundaryImpl boundary = (SurfaceBoundaryImpl) pb;
                    	 positions.addAll(boundary.getExterior().asDirectPositions());
                     }
                     */
                }
            }

            // Assert.isTrue(false, "not implemented yet");
        } else if (geom instanceof CompositePointImpl) {
            positions = new ArrayList<DirectPositionImpl>();
            positions.add(((CompositePointImpl) geom).getElements().iterator().next());
        } else if (geom instanceof CompositeCurveImpl) {
            Assert.isTrue(false, "not implemented yet");
        } else if (geom instanceof CompositeSurfaceImpl) {
            Assert.isTrue(false, "not implemented yet");
        } else if (geom instanceof CurveBoundaryImpl) {
            positions = new ArrayList<DirectPositionImpl>();
            positions.add(((CurveBoundaryImpl) geom).getStartPoint());
            positions.add(((CurveBoundaryImpl) geom).getEndPoint());
        } else if (geom instanceof SurfaceBoundaryImpl) {
            // Add control points of exterior ring
            positions =
                    ((RingImplUnsafe) ((SurfaceBoundaryImpl) geom).getExterior())
                            .asDirectPositions();
        }

        UniqueCoordinateArrayFilter filter = new UniqueCoordinateArrayFilter();

        // Filter all coordinates to eleminate redudant coordinates
        Iterator posIter = positions.iterator();
        while (posIter.hasNext()) {
            Object pos = posIter.next();
            if (pos instanceof DirectPositionImpl) {
                filter.filter(new Coordinate(((DirectPositionImpl) pos).getCoordinate()));
            } else if (pos instanceof PointImpl) {
                filter.filter(
                        new Coordinate(((PointImpl) pos).getDirectPosition().getCoordinate()));
            } else Assert.isTrue(false, "Invalid coordinate type");
        }

        return filter.getCoordinates();
    }

