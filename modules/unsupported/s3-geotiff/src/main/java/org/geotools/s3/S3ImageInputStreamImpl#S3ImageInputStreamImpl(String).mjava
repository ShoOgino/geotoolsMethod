    public S3ImageInputStreamImpl(String input) throws IOException {
        this.connector = new S3Connector(input);
        this.url = input;
        String urlWithoutQueryString = input.split("\\?")[0];
        String parts[] = urlWithoutQueryString.split("/");
        if (input.startsWith("http")) {
            this.bucket = parts[parts.length - 2];
            this.key = parts[parts.length - 1];
        } else {
            StringBuilder keyBuilder = new StringBuilder();
            this.bucket = parts[2];
            for (int i = 3; i < parts.length; i++) {
                keyBuilder.append("/").append(parts[i]);
            }
            this.key = keyBuilder.toString();
            /* Strip leading slash */
            this.key = this.key.startsWith("/") ? this.key.substring(1) : this.key;
        }

        AmazonS3 s3Client = this.getS3Client();
        ObjectMetadata meta =
                s3Client.getObjectMetadata(new GetObjectMetadataRequest(this.bucket, this.key));
        this.length = meta.getContentLength();

        this.fileName = nameFromKey(this.key);
        this.cacheBlockSize = CacheManagement.DEFAULT.getCacheConfig().getChunkSizeBytes();
    }

