        /**
         * Initialize the 2D properties (CRS and Envelope) of this coverage
         *
         * @throws TransformException
         * @throws FactoryException
         * @throws TransformException
         * @throws FactoryException
         */
        private void prepareCoverageSpatialElements() throws TransformException, FactoryException {
            //
            // basic initialization
            //
            coverageGeographicBBox =
                    new ReferencedEnvelope(CRS.transform(coverageEnvelope, GeoTiffUtils.WGS84));
            coverageGeographicCRS2D =
                    coverageGeographicBBox != null
                            ? coverageGeographicBBox.getCoordinateReferenceSystem()
                            : null;

            //
            // Get the original envelope 2d and its spatial reference system
            //
            coverageCRS2D = CRS.getHorizontalCRS(coverageCRS);
            assert coverageCRS2D.getCoordinateSystem().getDimension() == 2;
            if (coverageCRS.getCoordinateSystem().getDimension() != 2) {
                final GeneralEnvelope bbox =
                        new GeneralEnvelope(
                                CRS.transform(
                                        coverageEnvelope,
                                        (CoordinateReferenceSystem) coverageCRS2D));
                bbox.setCoordinateReferenceSystem(coverageCRS2D);
                coverageBBox = new ReferencedEnvelope(bbox);
            } else {
                // it is already a bbox
                coverageBBox = new ReferencedEnvelope(coverageEnvelope);
            }
        }

