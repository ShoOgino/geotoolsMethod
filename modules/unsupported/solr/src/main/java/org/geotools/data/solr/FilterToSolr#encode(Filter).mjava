    /**
     * Performs the encoding, sends the encoded SOLR string to the writer passed in.
     *
     * @param filter the Filter to be encoded.
     *
     * @throws Exception if there were io problems or unsupported filter operation
     */
    public void encode(Filter filter) throws Exception {
        if (out == null) throw new Exception("Can't encode to a null writer.");
        if (getCapabilities().fullySupports(filter)) {
            try {
                filter.accept(this, out);
            } catch (Exception ioe) {
                LOGGER.warning("Unable to export filter" + ioe);
                throw new Exception("Problem writing filter: ", ioe);
            }
        } else {
            throw new Exception("Filter type not supported");
        }
    }

