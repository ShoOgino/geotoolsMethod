    /**
     * Constructor 
     * @param contentState
     * @param fnQuery
     * @throws IOException
     */
    public SFSFeatureReader(ContentState contentState, SFSLayer layer, Query fnQuery, SimpleFeatureType targetSchema) throws IOException {

        this.contentState = contentState;
        this.layer = layer;

        /*Get datastore from the contentState */
        SFSDataStore ods = (SFSDataStore) contentState.getEntry().getDataStore();
        
        /* Encode the query into a protocol filter specification */
        String queryURL = null;
        if (fnQuery != null) {
            queryURL = SFSDataStoreUtil.encodeQuery(fnQuery);
        }

        // read the feature collection with a streaming reader
        jsonStream = ods.resourceToStream("data/" + layer.getTypeName().getLocalPart() + "?mode=features", queryURL);
        fjson = new FeatureJSON();
        fjson.setFeatureType(contentState.getFeatureType());
        featureIterator = fjson.streamFeatureCollection(jsonStream);
        fbuilder = new SimpleFeatureBuilder(targetSchema);
    }

