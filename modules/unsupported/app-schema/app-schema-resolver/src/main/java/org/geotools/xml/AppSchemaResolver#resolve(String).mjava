    /**
     * Resolve an absolute URL to a local file or jar URL.
     * 
     * @param location
     *            an absolute URL
     * @return the string representation of a file or jar URL
     * @throws RuntimeException
     *             if a local resource could not be found
     */
    public String resolve(String location) {
        String resolvedLocation = null;
        // Already resolved?
        if (location.startsWith("file:") || location.startsWith("jar:file:")) {
            resolvedLocation = location;
        }
        // Use catalog if one supplied.
        if (resolvedLocation == null && catalog != null) {
            resolvedLocation = catalog.resolveLocation(location);
        }
        // Look on classpath.
        if (resolvedLocation == null) {
            resolvedLocation = resolveClasspathLocation(location);
        }
        // Use download cache.
        if (resolvedLocation == null && cache != null) {
            resolvedLocation = cache.resolveLocation(location);
        }
        // Fail if still not resolved.
        if (resolvedLocation == null) {
            throw new RuntimeException(String.format("Failed to resolve %s", location));
        }
        resolvedLocationToOriginalLocationMap.put(resolvedLocation, location);
        try {
            /*
             * This monstrous hack is required because org.geotools.xml.Schemas.parse(String, List,
             * List) uses URLDecoder.decode(String) to handle escaped spaces in a file: URL, causing
             * an invalid URL (not RFC 1738 compliant) to be passed to the underlying EMF
             * infrastructure. The workaround is to allow reverse lookups with the decoded string by
             * inserting the decoded version into the map as well as the undecoded version inserted
             * above). *Shudder*.
             */
            resolvedLocationToOriginalLocationMap.put(URLDecoder.decode(resolvedLocation, "UTF-8"),
                    location);
        } catch (UnsupportedEncodingException e) {
            throw new RuntimeException(e);
        }
        LOGGER.fine(String.format("Resolved %s -> %s", location, resolvedLocation));
        return resolvedLocation;
    }

