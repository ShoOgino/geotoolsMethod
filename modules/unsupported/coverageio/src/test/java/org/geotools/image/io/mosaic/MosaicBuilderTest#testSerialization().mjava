    /**
     * Tests the serialization of current {@linkplain #builder}.
     *
     * @throws IOException If an I/O operation failed.
     * @throws ClassNotFoundException if a deserialization failed.
     */
    @Test
    public void testSerialization() throws IOException, ClassNotFoundException {
        final TileManager tileManager = builder.createTileManager(sourceTiles);
        assertEquals(4733, tileManager.getTiles().size());
        final String asText = tileManager.toString();
        assertFalse(asText.trim().length() == 0);
        assertTrue("Expected tiles created as in setUp()", manager.equals(tileManager));
        // we don't use assertEquals because the message is too long to format in case of failure.

        // Tests serialization
        final ByteArrayOutputStream buffer = new ByteArrayOutputStream();
        final ObjectOutputStream out = new ObjectOutputStream(buffer);
        out.writeObject(tileManager);
        out.close();

        final ObjectInputStream in = new ObjectInputStream(new ByteArrayInputStream(buffer.toByteArray()));
        final TileManager serialized = (TileManager) in.readObject();
        in.close();

        assertNotSame(tileManager, serialized);
        assertEquals(tileManager, serialized);
        assertEquals(tileManager.getImageReaderSpis(), serialized.getImageReaderSpis());
    }

