    /**
     * Returns the envelope. The default implementation constructs an envelope
     * using the values from the {@linkplain GeographicMetadata metadata} tree
     * <ul>
     *   <li>The horizontal limits {@link ImageGeometry#lowerCorner}.</li>
     *   <li>The vertical limits {@link ImageGeometry#upperCorner}.</li>
     * </ul>
     *
     * @throws MetadataException if the dimension specified for the envelope is illegal
     */
    public synchronized Envelope getEnvelope() throws MetadataException {
        final ImageGeometry geometry   = metadata.getGeometry();
        final int dimension            = geometry.getDimension();
        final GeneralEnvelope envelope = new GeneralEnvelope(dimension);
        for (int i=0; i<dimension; i++) {
            final NumberRange<Double> range = geometry.getOrdinateRange(i);
            final double              min   = range   .getMinimum();
            final double              max   = range   .getMaximum();
            try {
                envelope.setRange(i, min, max);
            } catch (IndexOutOfBoundsException e) {
                // Should not occur, but if it comes, throws the exception.
                throw new MetadataException(e.getLocalizedMessage());
            }
        }
        return envelope.clone();
    }

