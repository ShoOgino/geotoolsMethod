    /**
     * Converts to given rectangle from absolute to relative coordinates.
     * Coordinates are rounded to the smallest box enclosing fully the given region.
     *
     * @param region The rectangle to converts. Values are replaced in-place.
     * @throws ArithmeticException if {@link #setSubsampling} has not be invoked.
     */
    final void absoluteToRelative(final Rectangle region) throws ArithmeticException {
        final int sx = xSubsampling & MASK;
        final int sy = ySubsampling & MASK;
        int xmin = region.x;
        int xmax = region.width  + xmin;
        int ymin = region.y;
        int ymax = region.height + ymin;
        if (xmin < 0) xmin -= (sx - 1);
        if (xmax > 0) xmax += (sx - 1);
        if (ymin < 0) ymin -= (sy - 1);
        if (ymax > 0) ymax += (sy - 1);
        xmin /= sx;
        xmax /= sx;
        ymin /= sy;
        ymax /= sy;
        region.x = xmin;
        region.y = ymin;
        region.width  = xmax - xmin;
        region.height = ymax - ymin;
    }

