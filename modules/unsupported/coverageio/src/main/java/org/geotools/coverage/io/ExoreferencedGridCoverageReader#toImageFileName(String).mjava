    /**
     * Returns the filename for image data. This method is invoked by {@link #setInput} after
     * {@link #metadata} has been loaded. Default implementation just replace the file extension
     * by the {@code extension} argument specified to the constructor.
     *
     * @param  filename The filename part of metadata file. This is the filename part
     *         of the file supplied by users to {@link #setInput}.
     * @return The filename to use for for the image file. The directory is assumed
     *         to be the same than the metadata file.
     */
    protected String toImageFileName(String filename) {
        int ext = filename.lastIndexOf('.');
        if (ext < 0) {
            ext = filename.length();
        }
        return filename.substring(0, ext) + '.' + extension;
    }

