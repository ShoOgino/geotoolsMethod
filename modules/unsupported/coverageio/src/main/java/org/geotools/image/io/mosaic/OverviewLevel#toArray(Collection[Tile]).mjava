    /**
     * Expands the given tiles in a flat array. Tiles are stored by their index, with
     * <var>x</var> index varying faster.
     */
    private Tile[] toArray(final Collection<Tile> tiles) {
        final Tile[] array = new Tile[nx * ny];
        for (final Tile tile : tiles) {
            final Point pt = getIndex2D(tile);
            final int index = getIndex(pt.x, pt.y);
            if (array[index] != null && !tile.equals(array[index])) {
                throw duplicatedTile(pt);
            }
            array[index] = tile;
        }
        return array;
    }

