    /**
     * Returns a metadata object initialized to the specified data for encoding an image
     * of the given type. The default implementation copies the specified data into a
     * {@linkplain #getDefaultImageMetadata default image metadata}.
     *
     * @param inData Image metadata used to initialize the state of the returned object.
     * @param imageType The format of the image to be written later.
     * @param param Parameters that will be used to encode the image (in cases where
     *              it may affect the structure of the metadata), or {@code null}.
     * @return The metadata, or {@code null}.
     */
    public IIOMetadata convertImageMetadata(final IIOMetadata        inData,
                                            final ImageTypeSpecifier imageType,
                                            final ImageWriteParam    param)
    {
        ensureNonNull("inData", inData);
        final IIOMetadata outData = getDefaultImageMetadata(imageType, param);
        final String format = commonMetadataFormatName(inData, outData);
        if (format != null) try {
            outData.mergeTree(format, inData.getAsTree(format));
            return outData;
        } catch (IIOInvalidTreeException ex) {
            warningOccurred("convertImageMetadata", ex);
        }
        return null;
    }

