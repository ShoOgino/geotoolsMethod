    @Test
    public void testBuildClientWithMultipleHosts() throws IOException {
        params = getParams("localhost1,localhost2", 9201, "admin", "proxy");
        when(statusLine.getStatusCode()).thenReturn(200);
        assertNotNull(dataStoreFactory.createDataStore(params));
        assertEquals(2, dataStoreFactory.getClients().size());
        verify(clientBuilder, times(2)).build();
        assertEquals(2, hostsCaptor.getValue().length);
        assertEquals("localhost1", hostsCaptor.getValue()[0].getHostName());
        assertEquals(9201, hostsCaptor.getValue()[0].getPort());
        assertEquals("localhost2", hostsCaptor.getValue()[1].getHostName());
        assertEquals(9201, hostsCaptor.getValue()[1].getPort());
        configCallbackCaptor.getValue().customizeHttpClient(httpClientBuilder);
        assertNotNull(credentialsProviderCaptor.getValue().getCredentials(new AuthScope("localhost1", 9201)));
        assertNotNull(credentialsProviderCaptor.getValue().getCredentials(new AuthScope("localhost2", 9201)));
    }

