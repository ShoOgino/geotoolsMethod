    protected void init(String layerName, String geometryField) throws Exception {
        assertTrue("Elasticsearch test cluster is not initialized", port != null);
        this.layerName = layerName;
        attributes = dataStore.getElasticAttributes(this.layerName);
        ElasticLayerConfiguration config = new ElasticLayerConfiguration(
                new ArrayList<ElasticAttribute>());
        config.setLayerName(this.layerName);
        List<ElasticAttribute> layerAttributes = new ArrayList<>();
        for (ElasticAttribute attribute : attributes) {
            attribute.setUse(true);
            if (geometryField.equals(attribute.getName())) {
                ElasticAttribute copy = new ElasticAttribute(attribute);
                copy.setDefaultGeometry(true);
                layerAttributes.add(copy);
            } else {
                layerAttributes.add(attribute);
            }
        }
        config.getAttributes().addAll(layerAttributes);
        dataStore.setElasticConfigurations(config);
        featureSource = (ElasticFeatureSource) dataStore.getFeatureSource(this.layerName);
    }

