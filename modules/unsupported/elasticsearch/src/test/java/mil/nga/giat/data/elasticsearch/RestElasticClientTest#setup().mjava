    @Before
    public void setup() throws UnsupportedOperationException, IOException {
        mockRestClient = mock(RestClient.class);
        mockProxyRestClient = mock(RestClient.class);
        mockResponse = mock(Response.class);
        mockEntity = mock(HttpEntity.class);
        mockStatusLine = mock(StatusLine.class);
        mockAuth = mock(Authentication.class);
        mockStx = mock(SecurityContext.class);

        when(mockResponse.getEntity()).thenReturn(mockEntity);
        when(mockResponse.getStatusLine()).thenReturn(mockStatusLine);
        when(mockStatusLine.getStatusCode()).thenReturn(200);

        when(mockStx.getAuthentication()).thenReturn(mockAuth);
        when(mockAuth.isAuthenticated()).thenReturn(true);
        when(mockAuth.getName()).thenReturn("runAsTest");
        SecurityContextHolder.setContext(mockStx);

        client = new RestElasticClient(mockRestClient);
        clientWithProxy = new RestElasticClient(mockRestClient, mockProxyRestClient);

        InputStream inputStream = new ByteArrayInputStream("{}".getBytes());
        when(mockEntity.getContent()).thenReturn(inputStream);
    }

