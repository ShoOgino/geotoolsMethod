    @Test
    public void testGeoShapeBboxFilter() {
        BBOX filter = ff.bbox("geom", 0., 0., 1.1, 1.1, "EPSG:4326");
        List<List<Double>> coords = new ArrayList<>();
        coords.add(ImmutableList.of(0.,0.));
        coords.add(ImmutableList.of(0.,1.1));
        coords.add(ImmutableList.of(1.1,1.1));
        coords.add(ImmutableList.of(1.1,0.));
        coords.add(ImmutableList.of(0.,0.));
        // vertices in reverse order
        final List<List<Double>> reverseCoords = ImmutableList.of(
                coords.get(0), coords.get(3), coords.get(2), coords.get(1), coords.get(4)
        );
        Map<String,Object> expected = ImmutableMap.of("bool", 
                ImmutableMap.of("must", MATCH_ALL, "filter", ImmutableMap.of("geo_shape", 
                        ImmutableMap.of("geom", ImmutableMap.of("shape", 
                                ImmutableMap.of("coordinates", ImmutableList.of(coords), "type", "Polygon"),
                                "relation", "INTERSECTS")))));

        builder.visit(filter, null);
        assertTrue(builder.createCapabilities().fullySupports(filter));
        assertThat(builder.getQueryBuilder().toString(), isOneOf(expected.toString(),
                expected.toString().replace(coords.toString(), reverseCoords.toString())));
    }

