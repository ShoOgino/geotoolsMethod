    @Test
    public void testCompoundFilter() throws CQLException {
        Filter filter =
                ECQL.toFilter(
                        "time > \"1970-01-01\" and INTERSECTS(\"geom\", LINESTRING(0 0,1.1 1.1))");
        List<List<Double>> coords = new ArrayList<>();
        coords.add(ImmutableList.of(0., 0.));
        coords.add(ImmutableList.of(1.1, 1.1));
        Map<String, Object> expected =
                ImmutableMap.of(
                        "bool",
                        ImmutableMap.of(
                                "must",
                                ImmutableList.of(
                                        ImmutableMap.of(
                                                "range",
                                                ImmutableMap.of(
                                                        "time",
                                                        ImmutableMap.of("gt", "1970-01-01"))),
                                        ImmutableMap.of(
                                                "bool",
                                                ImmutableMap.of(
                                                        "must",
                                                        ElasticConstants.MATCH_ALL,
                                                        "filter",
                                                        ImmutableMap.of(
                                                                "geo_shape",
                                                                ImmutableMap.of(
                                                                        "geom",
                                                                        ImmutableMap.of(
                                                                                "shape",
                                                                                ImmutableMap.of(
                                                                                        "coordinates",
                                                                                        coords,
                                                                                        "type",
                                                                                        "LineString"),
                                                                                "relation",
                                                                                "INTERSECTS"))))))));

        builder.encode(filter);
        assertTrue(builder.createCapabilities().fullySupports(filter));
        assertEquals(expected.toString(), builder.getQueryBuilder().toString());
    }

