    @Test
    public void testMultipleAggregations() throws IOException {
        ElasticAggregation aggregation = new ElasticAggregation();
        aggregation.setBuckets(ImmutableList.of(ImmutableMap.of("key1", "value1")));
        aggregations.put("test", aggregation);
        aggregation = new ElasticAggregation();
        aggregation.setBuckets(ImmutableList.of(ImmutableMap.of("key2", "value2")));
        aggregations.put("test2", aggregation);

        reader = new ElasticFeatureReader(state, hits, aggregations, 0);
        assertTrue(reader.hasNext());
        feature = reader.next();
        assertNotNull(feature.getAttribute("_aggregation"));
        assertEquals(
                ImmutableSet.of("key1"),
                byteArrayToMap(feature.getAttribute("_aggregation")).keySet());
        assertFalse(reader.hasNext());
    }

