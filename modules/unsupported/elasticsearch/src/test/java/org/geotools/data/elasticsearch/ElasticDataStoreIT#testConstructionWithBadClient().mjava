    @Test(expected = IOException.class)
    public void testConstructionWithBadClient() throws IOException {
        Map<String, Serializable> params = createConnectionParams();
        String indexName =
                ElasticDataStoreFactory.getValue(ElasticDataStoreFactory.INDEX_NAME, params);

        RestClient mockClient = mock(RestClient.class);
        Response mockResponse = mock(Response.class);
        HttpEntity mockEntity = mock(HttpEntity.class);
        StatusLine mockStatusLine = mock(StatusLine.class);
        when(mockResponse.getEntity()).thenReturn(mockEntity);
        when(mockResponse.getStatusLine()).thenReturn(mockStatusLine);
        when(mockStatusLine.getStatusCode()).thenReturn(400);
        when(mockClient.performRequest(any(Request.class))).thenReturn(mockResponse);

        new ElasticDataStore(mockClient, indexName);
    }

