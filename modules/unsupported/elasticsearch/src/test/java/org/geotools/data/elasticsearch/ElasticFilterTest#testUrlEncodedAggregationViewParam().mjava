    @Test
    public void testUrlEncodedAggregationViewParam() {
        final String aggregation =
                "%7B%22ageohash_grid_agg%22%3A%20%7B%22geohash_grid%22%3A%20%7B%22field%22%3A%20%22a_field%22%2C%20%22precision%22%3A%201%7D%7D%7D";
        parameters.put("a", aggregation);
        builder.addViewParams(query);
        assertEquals(
                ImmutableMap.of(
                        "ageohash_grid_agg",
                        ImmutableMap.of(
                                "geohash_grid",
                                ImmutableMap.of("field", "a_field", "precision", 1))),
                builder.aggregations);
    }

