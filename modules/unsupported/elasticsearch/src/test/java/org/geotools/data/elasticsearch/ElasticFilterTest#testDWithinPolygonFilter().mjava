    @Test
    public void testDWithinPolygonFilter() throws CQLException {
        DWithin filter =
                (DWithin)
                        ECQL.toFilter(
                                "DWITHIN(\"geo_point\", POLYGON((0 0, 0 1, 1 1, 1 0, 0 0)), 1.0, meters)");
        Map<String, Object> expected =
                ImmutableMap.of(
                        "bool",
                        ImmutableMap.of(
                                "must",
                                ElasticConstants.MATCH_ALL,
                                "filter",
                                ImmutableMap.of(
                                        "geo_distance",
                                        ImmutableMap.of(
                                                "distance",
                                                "1.0m",
                                                "geo_point",
                                                ImmutableList.of(0.5, 0.5)))));

        builder.visit(filter, null);
        assertTrue(builder.createCapabilities().fullySupports(filter));
        assertEquals(expected, builder.getQueryBuilder());
    }

