    @Test
    public void testGeoShapeIntersectsFilter() throws CQLException {
        Intersects filter =
                (Intersects) ECQL.toFilter("INTERSECTS(\"geom\", LINESTRING(0 0,1.1 1.1))");
        List<List<Double>> coords = new ArrayList<>();
        coords.add(ImmutableList.of(0., 0.));
        coords.add(ImmutableList.of(1.1, 1.1));
        Map<String, Object> expected =
                ImmutableMap.of(
                        "bool",
                        ImmutableMap.of(
                                "must",
                                ElasticConstants.MATCH_ALL,
                                "filter",
                                ImmutableMap.of(
                                        "geo_shape",
                                        ImmutableMap.of(
                                                "geom",
                                                ImmutableMap.of(
                                                        "shape",
                                                        ImmutableMap.of(
                                                                "coordinates",
                                                                coords,
                                                                "type",
                                                                "LineString"),
                                                        "relation",
                                                        "INTERSECTS")))));

        builder.visit(filter, null);
        assertTrue(builder.createCapabilities().fullySupports(filter));
        // TODO: Why doesn't equality check on objects work here
        assertEquals(expected.toString(), builder.getQueryBuilder().toString());
    }

