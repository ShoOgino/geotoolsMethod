    @Override
    /**
     * Calculates the bounds of a specified query.
     *
     * @param query - the query to be applied.
     */
    protected ReferencedEnvelope getBoundsInternal(Query query) throws IOException {

        ReferencedEnvelope env = new ReferencedEnvelope(getSchema().getCoordinateReferenceSystem());
        if (lastQuery != query) filterFeatures(query);
        for (SimpleFeature feature : filteredFeatures) {

            Point p = (Point) feature.getDefaultGeometry();
            env.expandToInclude(p.getCoordinate());
        }

        return env;
    }

