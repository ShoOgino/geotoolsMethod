    private void testFilter(Filter filter, SimpleFeatureSource fsource, int expected)
            throws IOException {
        SimpleFeatureCollection fc = fsource.getFeatures(filter);

        try (SimpleFeatureIterator fi = fc.features()) {
            int numFeat = 0;
            while (fi.hasNext()) {
                fi.next();
                numFeat++;
            }

            String failMsg =
                    "Fully fetched features size and estimated num features count does not match";
            assertEquals(failMsg, expected, numFeat);
        }
    }

