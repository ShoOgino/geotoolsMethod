    /** convenience method to test if two images are identical in their RGB pixel values */
    public static boolean imageEquals(
            RenderedImage image1, RenderedImage image2, boolean ignoreAlpha) {

        int skipBand = -1;
        if (ignoreAlpha) {
            skipBand = 3;
        }

        for (int b = 0; b < image1.getData().getNumBands(); b++) {
            if (b == skipBand) continue;
            int[] img1data =
                    image1.getData()
                            .getSamples(
                                    0,
                                    0,
                                    image1.getWidth(),
                                    image1.getHeight(),
                                    b,
                                    new int[image1.getHeight() * image1.getWidth()]);
            int[] img2data =
                    image2.getData()
                            .getSamples(
                                    0,
                                    0,
                                    image1.getWidth(),
                                    image1.getHeight(),
                                    b,
                                    new int[image1.getHeight() * image1.getWidth()]);

            if (!Arrays.equals(img1data, img2data)) {
                // try to figure out which pixel (exactly) was different
                for (int i = 0; i < img1data.length; i++) {
                    if (img1data[i] != img2data[i]) {
                        final int x = i % image1.getWidth();
                        final int y = i / image1.getHeight();
                        LOGGER.warning(
                                "pixel "
                                        + i
                                        + " (possibly "
                                        + x
                                        + ","
                                        + y
                                        + ") differs: "
                                        + img1data[i]
                                        + " != "
                                        + img2data[i]);
                        return false;
                    }
                }
            }

            /*
             * for (int xpos = 0; xpos < image1.getWidth(); xpos++) { // System.out.println("checking
             * column " + xpos); int[] img1data = image1.getData().getSamples(xpos, 0, 1,
             * image1.getHeight(), b, new int[image1.getHeight()]); int[] img2data =
             * image2.getData().getSamples(xpos, 0, 1, image1.getHeight(), b, new
             * int[image1.getHeight()]); if (!Arrays.equals(img1data, img2data)) {
             * // System.out.println("pixels in column " + xpos + " are different"); return false; } }
             */

        }
        return true;
    }

