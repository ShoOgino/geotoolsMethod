    /**
     * The query that defines this readers interaction with an ArcSDE instance.
     *
     * @param query the {@link SeQuery} wrapper where to fetch rows from. Must NOT be already {@link
     *     ArcSDEQuery#execute() executed}.
     * @param geometryFactory the JTS GeometryFactory to use when creating Feature geometries
     * @param session the session the <code>query</code> is being ran over. This attribute reader
     *     will close it only if it does not have a transaction in progress.
     * @throws IOException
     */
    @SuppressWarnings("unchecked")
    public ArcSDEAttributeReader(
            final ArcSDEQuery query, final GeometryFactory geometryFactory, final ISession session)
            throws IOException {
        this.query = query;
        this.session = session;
        this.fidReader = query.getFidReader();
        this.schema = query.getSchema();
        this.geometryFactory = geometryFactory;

        String typeName = schema.getTypeName();

        this.fidPrefix = new StringBuffer(typeName).append('.');
        this.fidPrefixLen = this.fidPrefix.length();

        final GeometryDescriptor geomType = schema.getGeometryDescriptor();

        if (geomType != null) {
            this.schemaGeometryClass = (Class<? extends Geometry>) geomType.getType().getBinding();
        } else {
            this.schemaGeometryClass = null;
        }

        query.execute();
    }

