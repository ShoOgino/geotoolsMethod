    private static ReferencedEnvelope toNativeCrs(
            final GeneralEnvelope requestedEnvelope, final CoordinateReferenceSystem nativeCRS)
            throws IllegalArgumentException {

        ReferencedEnvelope reqEnv = toReferencedEnvelope(requestedEnvelope);

        if (!CRS.equalsIgnoreMetadata(nativeCRS, reqEnv.getCoordinateReferenceSystem())) {
            // we're being reprojected. We'll need to reproject reqEnv into
            // our native coordsys
            try {
                // ReferencedEnvelope origReqEnv = reqEnv;
                reqEnv = reqEnv.transform(nativeCRS, true);
            } catch (FactoryException fe) {
                // unable to reproject?
                throw new IllegalArgumentException(
                        "Unable to find a reprojection from requested "
                                + "coordsys to native coordsys for this request",
                        fe);
            } catch (TransformException te) {
                throw new IllegalArgumentException(
                        "Unable to perform reprojection from requested "
                                + "coordsys to native coordsys for this request",
                        te);
            }
        }
        return reqEnv;
    }

