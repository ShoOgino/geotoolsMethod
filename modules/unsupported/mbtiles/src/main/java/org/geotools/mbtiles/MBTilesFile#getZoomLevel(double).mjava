    /** Returns the zoom level for the given simplification distance */
    protected long getZoomLevel(double distance) throws SQLException {
        final long maxZoom = maxZoom();
        final long numberOfTiles = tilesForZoom(maxZoom);
        final double span = WORLD_ENVELOPE.getSpan(0) / numberOfTiles;
        double pxSize = span / 256; // assuming a visualization of 256px per tile
        for (long z = maxZoom; z > 0; z--, pxSize *= 2) {
            if (pxSize > distance) {
                // pick the lowest, vector tiles are made to be overzoomed a bit
                // and we need a large gutter to avoid rendering artifacts
                return z;
            }
        }

        return 0;
    }

