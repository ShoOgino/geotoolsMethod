    @Test
    public void testShapefileComparison() throws Exception {
        URL url = TestData.url(STATE_POP);
        ShapefileDataStore sds = new ShapefileDataStore(url);
        OGRDataStore ods = createDataStore(getAbsolutePath(STATE_POP), null);

        assertFeatureTypeEquals(sds.getSchema(), ods.getSchema(sds.getSchema().getTypeName()));

        Query query = new Query(sds.getSchema().getTypeName());
        try (FeatureReader sfr = sds.getFeatureReader(query, Transaction.AUTO_COMMIT);
                FeatureReader ofr = ods.getFeatureReader(query, Transaction.AUTO_COMMIT)) {
            SimpleFeature sf = null;
            SimpleFeature of = null;
            while (true) {
                if (!sfr.hasNext()) {
                    assertFalse(ofr.hasNext());
                    break;
                }
                sf = (SimpleFeature) sfr.next();
                of = (SimpleFeature) ofr.next();
                for (int i = 0; i < sds.getSchema().getAttributeCount(); i++) {
                    Object shapeAtt = sf.getAttribute(i);
                    Object ogrAtt = of.getAttribute(i);
                    assertEquals(shapeAtt, ogrAtt);
                }
            }
        }
        sds.dispose();
        ods.dispose();
    }

