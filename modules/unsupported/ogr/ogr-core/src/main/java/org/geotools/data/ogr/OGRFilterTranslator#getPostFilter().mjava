    /** Returns the post filter that could not be encoded */
    public Filter getPostFilter() {
        // see if the query has a single bbox filter (that's how much we're sure to be able to
        // encode)
        PostPreProcessFilterSplittingVisitor visitor =
                new PostPreProcessFilterSplittingVisitor(
                        STRICT_GEOMETRY_FILTER_CAPABILITIES, schema, null);
        filter.accept(visitor, null);
        Filter preFilter = visitor.getFilterPre();

        if (preFilter == null || preFilter instanceof BBOX) {
            // ok, then we can extract using the extended caps
            visitor =
                    new PostPreProcessFilterSplittingVisitor(
                            EXTENDED_FILTER_CAPABILITIES, schema, null);
            filter.accept(visitor, null);
            return visitor.getFilterPost();
        } else {
            // though luck, there is more than a single bbox filter
            visitor =
                    new PostPreProcessFilterSplittingVisitor(
                            ATTRIBUTE_FILTER_CAPABILITIES, schema, null);
            filter.accept(visitor, null);
            return visitor.getFilterPost();
        }
    }

