    /**
     * @todo this was spiked from GeoJSONUtil to allow adding the 'featureClass' property. I suppose
     *     another way to do this would be to wrap the geojson in another object and rewrite the
     *     spatial views, etc.
     * @todo GeoJSONUtil could be made more efficient and flexible by using Appendable
     */
    public static String writeJSON(SimpleFeature feature, String featureClass, GeometryJSON gjson) {
        SimpleFeatureType featureType = feature.getFeatureType();
        StringBuilder sb = new StringBuilder();
        sb.append("{");

        // type
        GeoJSONUtil.entry("type", "Feature", sb);
        sb.append(',');
        GeoJSONUtil.entry("featureClass", featureClass, sb);
        sb.append(',');

        // crs @todo
        /*
        if (encodeFeatureCRS) {
        CoordinateReferenceSystem crs =
        feature.getFeatureType().getCoordinateReferenceSystem();
        if (crs != null) {
        try {
        string("crs", sb).append(":");
        sb.append(FeatureJSON.this.toString(crs)).append(",");
        } catch (IOException e) {
        throw new RuntimeException(e);
        }
        }
        }
         */
        // bounding box @todo
        /*
        if (encodeFeatureBounds) {
        BoundingBox bbox = feature.getBounds();
        string("bbox", sb).append(":");
        sb.append(gjson.toString(bbox)).append(",");
        }
         */

        // geometry
        if (feature.getDefaultGeometry() != null) {
            GeoJSONUtil.string("geometry", sb)
                    .append(":")
                    .append(gjson.toString((Geometry) feature.getDefaultGeometry()));
            sb.append(",");
        }

        // properties
        int gindex =
                featureType.getGeometryDescriptor() != null
                        ? featureType.indexOf(featureType.getGeometryDescriptor().getLocalName())
                        : -1;

        GeoJSONUtil.string("properties", sb).append(":").append("{");
        boolean attributesWritten = false;
        for (int i = 0; i < featureType.getAttributeCount(); i++) {
            AttributeDescriptor ad = featureType.getDescriptor(i);

            // skip the default geometry, it's already encoded
            if (i == gindex) {
                continue;
            }

            Object value = feature.getAttribute(i);
            if (value == null) {
                // skip
                continue;
            }

            attributesWritten = true;

            // handle special types separately, everything else as a string or literal
            if (value instanceof Envelope) {
                GeoJSONUtil.array(ad.getLocalName(), gjson.toString((Envelope) value), sb);
            } else if (value instanceof BoundingBox) {
                GeoJSONUtil.array(ad.getLocalName(), gjson.toString((BoundingBox) value), sb);
            } else if (value instanceof Geometry) {
                GeoJSONUtil.string(ad.getLocalName(), sb)
                        .append(":")
                        .append(gjson.toString((Geometry) value));
            } else {
                GeoJSONUtil.entry(ad.getLocalName(), value, sb);
            }
            sb.append(",");
        }

        if (attributesWritten) {
            sb.setLength(sb.length() - 1);
        }
        sb.append("},");

        // id
        GeoJSONUtil.entry("id", feature.getID(), sb);

        sb.append("}");
        return sb.toString();
    }

