    /** Flat modes assumes the master rules applies to whatever was not caught by the child rules */
    private List<CssRule> removeNested(
            CssRule cssRule, FeatureType featureType, UnboundSimplifyingFilterVisitor simplifier) {
        List<CssRule> nested = cssRule.getNestedRules();
        if (nested == null || nested.isEmpty()) {
            return Collections.singletonList(cssRule);
        }

        // add covered by all directly nested rules
        final DomainCoverage coverage = new DomainCoverage(featureType, simplifier);
        coverage.setExclusiveRulesEnabled(true);
        for (CssRule r : cssRule.getNestedRules()) {
            coverage.addRule(r);
        }

        // get the residuals to be encoded
        return coverage.addRule(cssRule);
    }

