    public void testSingletonHint(boolean eDetached) {
        EFeatureDataStore eStore;
        Map<String,Serializable> params;
        try {
            //
            // Measure test duration
            //
            dTime();
            //
            // Prepare store
            //
            params = eParams.createParams(eResourceURI.toString(), null);
            eStore = eStoreFactory.createDataStore(params);
            Hints hints = new Hints();
            hints.put(EFeatureHints.EFEATURE_SINGLETON_FEATURES, false);
            hints.put(EFeatureHints.EFEATURE_VALUES_DETACHED, false);
            //
            // Loop over types
            //
            for(String eType : new String[]{"efeature.EFeatureData","efeature.EFeatureCompatibleData"}) {
                //
                // Prepare loop objects
                //
                Query query = new Query(eType,Filter.INCLUDE);
                query.setHints(hints);
                EFeatureReader eReader = eStore.getFeatureReader(query);
                EFeatureHints eHints = eReader.eHints();
                eHints.eSetValuesDetached(eDetached);
                //
                // -------------------------------------------------------
                //  A.1) Test instance ESimpleFeature mode (attached)
                // -------------------------------------------------------
                //
                query.getHints().put(EFeatureHints.EFEATURE_SINGLETON_FEATURES, false);
                ESimpleFeature f1 = eReader.next();
                ESimpleFeature f2 = eReader.next();
                assertNotSame("Features are same instances ["+eType+",detached:="+eDetached+",singleton:=false]", f1,f2);
                assertNotSame("EObjects are same instances ["+eType+",detached:="+eDetached+",singleton:=false]", f1.eObject(),f2.eObject());
                assertNotSame("EFeatures are same instances ["+eType+",detached:="+eDetached+",singleton:=false]", f1.eFeature(),f2.eFeature());
                //
                // -------------------------------------------------------
                //  A.2) Test singleton ESimpleFeature mode
                // -------------------------------------------------------
                //
                eHints.eSetSingletonFeatures(true);
                f1 = eReader.next();
                f2 = eReader.next();
                assertSame("Features are not same instances ["+eType+",detached:="+eDetached+",singleton:=true]", f1,f2);
                assertSame("EObjects are not same instances ["+eType+",detached:="+eDetached+",singleton:=true]", f1.eObject(),f2.eObject());
                assertSame("EFeatures are not same instances ["+eType+",detached:="+eDetached+",singleton:=true]", f1.eFeature(),f2.eFeature());
                //
                // -----------------------------------------------------------------------------
                //  A.3) Test instance ESimpleFeature mode again, this time ensuring hint resets
                // -----------------------------------------------------------------------------
                //
                eHints.eSetSingletonFeatures(false);
                f1 = eReader.next();
                f2 = eReader.next();
                assertNotSame("Features are same instances [transitive,"+eType+",detached:="+eDetached+",singleton:=false]", f1,f2);
                assertNotSame("EObjects are same instances [transitive,"+eType+",detached:="+eDetached+",singleton:=false]", f1.eObject(),f2.eObject());
                assertNotSame("EFeatures are same instances [transitive,"+eType+",detached:="+eDetached+",singleton:=false]", f1.eFeature(),f2.eFeature());
                //
                // Dispose data store
                //
                eStore.dispose();
            }
        } catch (Exception e) {
            LOGGER.log(Level.SEVERE, e.getMessage(), e);
            fail(e);
        }
    }    

