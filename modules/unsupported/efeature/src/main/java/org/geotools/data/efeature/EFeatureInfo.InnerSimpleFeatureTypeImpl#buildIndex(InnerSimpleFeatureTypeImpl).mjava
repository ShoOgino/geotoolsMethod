        /**
         * Builds the name -> position index used by simple features for fast attribute lookup
         *
         * @param featureType
         * @return
         */
        private Map<String, Integer> buildIndex(InnerSimpleFeatureTypeImpl featureType) {
            // build an index of attribute name to index
            Map<String, Integer> index = new HashMap<String, Integer>();
            int i = 0;
            for (AttributeDescriptor ad : featureType.getAttributeDescriptors()) {
                index.put(ad.getLocalName(), i++);
            }
            if (featureType.getGeometryDescriptor() != null) {
                index.put(null, index.get(featureType.getGeometryDescriptor().getLocalName()));
            }
            return Collections.unmodifiableMap(index);
        }

