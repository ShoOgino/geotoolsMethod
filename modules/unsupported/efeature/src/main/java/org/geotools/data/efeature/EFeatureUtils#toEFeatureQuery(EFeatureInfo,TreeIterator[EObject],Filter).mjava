    /**
     * Convert GeoTools {@link Query} to {@link EFeatureQuery} statemen
     * 
     * @param eFeatureInfo - {@link EFeatureInfo} instance
     * @param eClass - {@link EClass} implementing (or compatible with) {@link EFeature}
     * @param featureType - {@link SimpleFeatureType} instance
     * @param eObjects - {@link TreeIterator} of objects to by queried
     * @param filter - GeoTools spatial {@link Filter filter} instance
     * @return a {@link EFeatureQuery} statement
     * @throws EFeatureEncoderException If filter encoding failed.
     */
    public static EFeatureQuery toEFeatureQuery(EFeatureInfo eFeatureInfo,
            TreeIterator<EObject> eObjects, Filter filter) throws EFeatureEncoderException {
        // Create an EClass filter
        //
        EObjectCondition eClassFilter = createEClassFilter(eFeatureInfo.eClass());
        //
        // Create spatial filter
        //
        EObjectCondition eSpatialFilter = toEObjectCondition(eFeatureInfo,
                eFeatureInfo.getFeatureType(), true, filter);
        //
        // Create EMF Query WHERE clause
        //
        WHERE where = new WHERE(eClassFilter.AND(eSpatialFilter));
        //
        // Create EFeature filter
        //
        EFeatureFilter eWhere = new EFeatureFilter(eFeatureInfo, where);
        //
        // Create query instance
        //
        return new EFeatureQuery(eObjects, eWhere);
    }

