    @Test
    public void testServiceError() throws Exception {

        this.clientMock = PowerMockito.mock(HttpClient.class);
        PowerMockito.whenNew(HttpClient.class)
                .withNoArguments()
                .thenReturn(clientMock)
                .thenReturn(clientMock);
        this.getMock = PowerMockito.mock(GetMethod.class);
        PowerMockito.whenNew(GetMethod.class)
                .withNoArguments()
                .thenReturn(getMock)
                .thenReturn(getMock);
        when(clientMock.executeMethod(getMock))
                .thenReturn(HttpStatus.SC_OK)
                .thenReturn(HttpStatus.SC_OK);
        when(getMock.getResponseBodyAsStream())
                .thenReturn(
                        ArcGISRestDataStoreFactoryTest.readJSONAsStream("test-data/catalog.json"))
                .thenReturn(
                        ArcGISRestDataStoreFactoryTest.readJSONAsStream("test-data/error.json"));

        try {
            this.dataStore =
                    (ArcGISRestDataStore)
                            ArcGISRestDataStoreFactoryTest.createDefaultOpenDataTestDataStore();
            List<Name> names = this.dataStore.createTypeNames();
        } catch (IOException e) {
            assertTrue(e.getMessage().contains("400 Cannot perform query"));
        }
    }

