    @Test
    public void testFeaturesWithDate() throws Exception {

        this.clientMock = PowerMockito.mock(HttpClient.class);
        PowerMockito.whenNew(HttpClient.class)
                .withNoArguments()
                .thenReturn(clientMock)
                .thenReturn(clientMock);
        this.getMock = PowerMockito.mock(GetMethod.class);
        PowerMockito.whenNew(GetMethod.class)
                .withNoArguments()
                .thenReturn(getMock)
                .thenReturn(getMock);
        when(clientMock.executeMethod(getMock))
                .thenReturn(HttpStatus.SC_OK)
                .thenReturn(HttpStatus.SC_OK)
                .thenReturn(HttpStatus.SC_OK);
        when(getMock.getResponseBodyAsStream())
                .thenReturn(
                        ArcGISRestDataStoreFactoryTest.readJSONAsStream("test-data/catalog.json"))
                .thenReturn(
                        ArcGISRestDataStoreFactoryTest.readJSONAsStream(
                                "test-data/bicycleDataset.json"))
                .thenReturn(
                        ArcGISRestDataStoreFactoryTest.readJSONAsStream(
                                "test-data/bicycleDataset.json"));

        this.dataStore =
                (ArcGISRestDataStore)
                        ArcGISRestDataStoreFactoryTest.createDefaultOpenDataTestDataStore();
        this.dataStore.createTypeNames();

        FeatureSource<SimpleFeatureType, SimpleFeature> src =
                this.dataStore.createFeatureSource(
                        this.dataStore.getEntry(
                                new NameImpl(ArcGISRestDataStoreFactoryTest.NAMESPACE, TYPENAME4)));
        src.getSchema();

        this.clientMock = PowerMockito.mock(HttpClient.class);
        PowerMockito.whenNew(HttpClient.class).withNoArguments().thenReturn(this.clientMock);

        this.postMock = PowerMockito.mock(PostMethod.class);
        PowerMockito.whenNew(PostMethod.class).withNoArguments().thenReturn(this.postMock);
        when(this.clientMock.executeMethod(postMock)).thenReturn(HttpStatus.SC_OK);
        when(this.postMock.getResponseBodyAsStream())
                .thenReturn(
                        ArcGISRestDataStoreFactoryTest.readJSONAsStream(
                                "test-data/bicycleFeatures.geo.json"));

        FeatureCollection<SimpleFeatureType, SimpleFeature> fc = src.getFeatures(new Query());
        FeatureIterator iter = fc.features();

        assertEquals(true, iter.hasNext());
        SimpleFeature sf = (SimpleFeature) iter.next();
        assertEquals("ROAD", sf.getAttribute("LOCAL_TYPE"));
        assertEquals(5532, sf.getAttribute("RD_NUM"));
        assertNull(sf.getAttribute("VERI_DATE"));

        assertEquals(true, iter.hasNext());
        sf = (SimpleFeature) iter.next();
        assertEquals("ROAD", sf.getAttribute("LOCAL_TYPE"));
        assertEquals(5068, sf.getAttribute("RD_NUM"));
        assertEquals(
                (new SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss.SSSX"))
                        .parse("2011-08-02T00:00:00.000Z"),
                sf.getAttribute("VERI_DATE"));
    }

