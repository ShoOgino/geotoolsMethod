    protected SimpleFeatureCollection loadFeatures(String resource, Charset charset,
            Query q) throws Exception {
        if (q == null)
            q = new Query();
        File shpFile = copyShapefiles(resource);
        URL url = shpFile.toURI().toURL();
        s = new IndexedShapefileDataStore(url, null, false,
                true, IndexType.QIX, charset);
        SimpleFeatureSource fs = s.getFeatureSource(s.getTypeNames()[0]);
        SimpleFeatureCollection features = fs.getFeatures(q);
        return features;
    }

