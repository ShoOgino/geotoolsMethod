    @Override
    public int getGeometryDimension(
            String schemaName, String tableName, String columnName, Connection cx)
            throws SQLException {
        // Try the metadata table first
        if (tableExists(schemaName, METADATA_TABLE_NAME, cx)) {
            StringBuffer sql = new StringBuffer();
            sql.append("SELECT DIMENSION FROM ");
            encodeIdentifiers(sql, schemaName, METADATA_TABLE_NAME);
            sql.append(" WHERE TABLE_NAME = ? AND COLUMN_NAME = ?");

            PreparedStatement ps = null;
            ResultSet rs = null;
            try {
                ps = cx.prepareStatement(sql.toString());
                ps.setString(1, tableName);
                ps.setString(2, columnName);
                rs = ps.executeQuery();
                if (rs.next()) {
                    return rs.getInt(1);
                }
            } finally {
                dataStore.closeSafe(rs);
                dataStore.closeSafe(ps);
            }
        }

        // Try the first non-NULL geometry
        StringBuffer sql = new StringBuffer();
        sql.append("SELECT ");
        encodeIdentifiers(sql, columnName);
        sql.append(".ST_CoordDim() FROM ");
        encodeIdentifiers(sql, schemaName, tableName);
        sql.append(" WHERE ");
        encodeIdentifiers(sql, columnName);
        sql.append(" IS NOT NULL LIMIT 1");

        PreparedStatement ps = null;
        ResultSet rs = null;
        try {
            ps = cx.prepareStatement(sql.toString());
            rs = ps.executeQuery();
            if (rs.next()) {
                return rs.getInt(1);
            }
        } finally {
            dataStore.closeSafe(rs);
            dataStore.closeSafe(ps);
        }

        // Fallback
        return 2;
    }

