    @Test
    public void testGetTileFromCoordinate() throws Exception {
        int i=0;
        TileService[] services = new TileService[2];
        for (WMTSServiceType t : WMTSServiceType.values()) {
            
            services[i++] = createKVPService(); // TODO: create a testpoint array for REST too

        }
        TestPoint[] tests = {
            new TestPoint(90, -180, 2, 0,4),
            new TestPoint(75, -173, 2, 0,4),
            new TestPoint(90, -180, 0, 0,1),
            new TestPoint(0, 0, 3,     1,8),
            new TestPoint(0, 0, 2,     0,4),
            new TestPoint(0, 0, 1,     0,2),
            new TestPoint(50, -70, 0,  0,1),
            new TestPoint(50, 70, 0, 0, 1),
            new TestPoint(-50, -70, 1, 0,2),
            new TestPoint(50, 70, 1, 0, 2),
            new TestPoint(50, -70, 1,  0,2),
            new TestPoint(-50, 70, 1,  0,2)
        };

//        TestPoint[] tests = {
//            new TestPoint(90, -180, 2, 1,1),
//            new TestPoint(75, -173, 2, 1,1),
//            new TestPoint(90, -180, 0, 0,0),
//            new TestPoint(0, 0, 3, 2,3),
//            new TestPoint(0, 0, 2, 1,1),
//            new TestPoint(0, 0, 1, 0,0),
//            new TestPoint(50, -70, 0, 0, 0),
//            new TestPoint(50, 70, 0, 0, 0),
//            new TestPoint(-50, -70, 1, 0, 0),
//            new TestPoint(50, 70, 1, 0,0),
//            new TestPoint(50, -70, 1, 0,0),
//            new TestPoint(-50, 70, 1, 0,0)
//        };
        for (TestPoint tp : tests) {
            for (int i1=0;i1<2;i1++) {
                TileService service = services[i1];
                // For some reason map proxy has an extra level compared to GeoServer!
                int offset = 0;
                if (((WMTSTileService)service).getType().equals(WMTSServiceType.REST)) {
                    offset = 1;
                }
                WMTSZoomLevel zoomLevel = ((WMTSTileService) service).getZoomLevel(tp.zoomlevel + offset);// new WMTSZoomLevel(1,(WMTSService) service);
                // top right
                Tile tile = factory.findTileAtCoordinate(tp.lon, tp.lat, zoomLevel, service);

                WMTSTile expectedTile = new WMTSTile(tp.expectedCol, tp.expectedRow, zoomLevel, service);
                System.out.println(tp.lat+","+ tp.lon+" expected:"+expectedTile+" got "+tile);
                Assert.assertEquals(""+tp.lat+","+ tp.lon,expectedTile.getTileIdentifier(), tile.getTileIdentifier());

            }
        }

    }

