    /**
     * @see org.geotools.data.DataStore#getFeatureReader(org.geotools.data.Query,
     *      org.geotools.data.Transaction)
     */
    public FeatureReader<SimpleFeatureType, SimpleFeature> getFeatureReader(Query query,
            Transaction transaction) throws IOException {
        /**
         * @HACK: This is a hack to overcome the fact that WFS 1.0 support has not yet been ported
         *        to the new GeoAPI Filter interfaces and the renderer might be sending an
         *        org.geotools.renderer.lite.FastBBOX that makes Filters.accept(Filer) fail with a
         *        ClassCastException, and I don't want to pollute FastBBOX by implementing the
         *        deprecated geotools FilterVisitor interface, as this module is the one that should
         *        be upgraded. NOTE: it is good enough to check for the outer filter to be a BBOX
         *        because FastBBOX won't clone itself if the result of the visitor is not a BBOX
         */
        if (query.getFilter() instanceof BBOX) {
            DuplicatingFilterVisitor dfv = new DuplicatingFilterVisitor();
            Filter filter = (Filter) dfv.visit((BBOX)query.getFilter(), null);
            Query q = new Query(query);
            q.setFilter(filter);
            query = q;
        }
        return strategy.getFeatureReader(query, transaction);
    }

