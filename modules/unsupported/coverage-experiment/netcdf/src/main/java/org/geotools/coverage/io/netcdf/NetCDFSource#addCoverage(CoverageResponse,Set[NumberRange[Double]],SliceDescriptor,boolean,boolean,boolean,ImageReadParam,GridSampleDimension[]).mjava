    private void addCoverage(
    		final CoverageResponse response,
            Set<NumberRange<Double>> verticalSubset, 
            final SliceDescriptor sd,
            final boolean needTransformation, 
            final boolean emptyRequest,
            final boolean useJAI,
            ImageReadParam imageReadParam,
            GridSampleDimension[] sampleDimensions) throws IOException {
        if (!verticalSubset.isEmpty()) {
            for (NumberRange<Double> level : verticalSubset) {
                VerticalExtent ve = sd.getVerticalExtent();
                if (ve != null) {
                    final NumberRange<Double> veRange= NumberRange.create(ve.getMinimumValue().doubleValue(), ve.getMaximumValue().doubleValue());
                    if (veRange.contains(level)) { // TODO this is not correct, we should use inclusion
                        final int imageIndex = ((AbstractSliceDescriptor) sd).getImageIndex();
                        GridCoverage gc = Utilities.compute(access.getInput(), imageIndex,
                                needTransformation, emptyRequest, useJAI,
                                imageReadParam, false, sampleDimensions, NetCDFDriver.spi, this.name.toString(), coverageFactory, access.raster2ModelMap.get(this.name),
                                access.spatialReferenceSystem2DMap.get(this.name), access.coverageEnvelope2DMap.get(this.name));
                        if (gc != null)
                            response.addResult(gc);
                    }
                }
            }
        } else {
            final int imageIndex = ((AbstractSliceDescriptor) sd)
                    .getImageIndex();
            GridCoverage gc = Utilities.compute(access
                    .getInput(), imageIndex, needTransformation, emptyRequest,
                    useJAI, imageReadParam, false, sampleDimensions, NetCDFDriver.spi, this.name.toString(), coverageFactory, access.raster2ModelMap.get(this.name),
                    access.spatialReferenceSystem2DMap.get(this.name), access.coverageEnvelope2DMap.get(this.name));
            if (gc != null)
                response.addResult(gc);
        }
    }

