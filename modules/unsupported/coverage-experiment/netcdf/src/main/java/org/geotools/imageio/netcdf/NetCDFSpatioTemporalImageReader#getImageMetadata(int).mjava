    /**
     * Returns the ImageMetadata obtained from the underlying flatReader
     * 
     * @param imageIndex
     *                the index of the specified 2D raster.
     */
    public IIOMetadata getImageMetadata(int imageIndex) throws IOException {
        IIOMetadata metadata;
        synchronized (metadataMap) {
            if (!metadataMap.containsKey(imageIndex)) {
                metadata = directReader.getImageMetadata(imageIndex);
                metadataMap.put(imageIndex, metadata);
            } else {
                metadata = (BaseImageMetadata) metadataMap.get(imageIndex);
                if (metadata == null) {
                    metadata = directReader.getImageMetadata(imageIndex);
                    metadataMap.put(imageIndex, metadata);
                }
            }
        }
        return metadata;
    }

