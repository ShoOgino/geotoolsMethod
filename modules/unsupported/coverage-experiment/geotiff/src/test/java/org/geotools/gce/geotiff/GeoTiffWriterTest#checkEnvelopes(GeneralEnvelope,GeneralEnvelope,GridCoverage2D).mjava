        /**
         * Checks two envelopes for equality ignoring their CRSs.
         * 
         * @param sourceEnv
         *                first {@link GeneralEnvelope} to check.
         * @param targetEnv
         *                second {@link GeneralEnvelope} to check.
         * @param gc
         *                the source {@link GridCoverage2D}.
         * @return false if they are reasonably equal, false otherwise.
         */
        private boolean checkEnvelopes(GeneralEnvelope sourceEnv,
                GeneralEnvelope targetEnv, GridCoverage2D gc) {
            final int dimension = sourceEnv.getDimension();
            if (sourceEnv.getDimension() != targetEnv.getDimension()) {
                return false;
            }
            AffineTransform mathTransformation = (AffineTransform) ((GridGeometry2D) gc
                    .getGridGeometry()).getGridToCRS2D();
            double epsilon;
            for (int i = 0; i < dimension; i++) {
                epsilon = i == 0 ? XAffineTransform.getScaleX0(mathTransformation)
                        : XAffineTransform.getScaleY0(mathTransformation);
                // Comparison below uses '!' in order to catch NaN values.
                if (!(Math.abs(sourceEnv.getMinimum(i) - targetEnv.getMinimum(i)) <= epsilon && Math
                        .abs(sourceEnv.getMaximum(i) - targetEnv.getMaximum(i)) <= epsilon)) {
                    return false;
                }
            }
            return true;
        }

