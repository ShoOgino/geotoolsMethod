    public static AffineTransform getAffineTransform(RectifiedGrid rg) {
        AffineTransform at = new AffineTransform();
        if (rg == null)
            throw new IllegalArgumentException("unable to find rectified grid from metadata");
        int dimension = rg.getDimension();
        int offset = 0;
        // if (dimension == 3) {
        // offset = 1;
        // dimension = 2;
        // }

        double[][] ov = new double[dimension][];
        double[] origin = rg.getCoordinates();
        for (int i = 0; i < dimension; i++) {
            ov[i] = rg.getOffsetVectorValues(i + offset);
        }
        at.setTransform(ov[0][0 + offset], 0, 0, ov[1][1 + offset],
                origin[0 + offset], origin[1 + offset]);
        return at;
    }

