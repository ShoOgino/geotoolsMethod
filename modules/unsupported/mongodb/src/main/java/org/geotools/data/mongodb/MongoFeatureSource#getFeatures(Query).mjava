    public final SimpleFeatureCollection getFeatures (final Query query)
    {
        FilterToMongoQuery f2m = new FilterToMongoQuery();
        Filter filter = query.getFilter();
        BasicDBObject dbo = (BasicDBObject) filter.accept( f2m, null );
        MongoResultSet rs = new MongoResultSet( layer, dbo );
        // check for paging; maxFeatures and/or startIndex
        int maxFeatures = query.getMaxFeatures();
        if (maxFeatures > 0)
        {
            int startIndex = 0;
            if (query.getStartIndex() != null)
            {
                startIndex = query.getStartIndex().intValue();
            }
            rs.paginateFeatures( startIndex, maxFeatures );
        }
        return new MongoFeatureCollection( rs );
    }

