    @Override
    protected int getCountInternal(Query query) throws IOException {
        int count = -1;
        try (InputStream in = new FileInputStream(getDataStore().getFile())) {
            FlatgeobufReader reader =
                    new FlatgeobufReader(
                            getState().getFeatureType().getTypeName(),
                            getState().getFeatureType().getGeometryDescriptor().getLocalName(),
                            in);
            count = 0;
            while (reader.getNextFeature() != null) {
                count++;
            }
        }
        return count;
    }

