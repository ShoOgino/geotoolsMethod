    /** Creates the schema of the resulting feature collection */
    private SimpleFeatureType createSchema(
            SimpleFeatureType current, Query query, CoordinateReferenceSystem destcrs) {
        try {
            if (destcrs != null && !destcrs.equals(current.getCoordinateReferenceSystem())) {
                // need to change the projection of the schema
                return DataUtilities.createSubType(
                        current, query.getPropertyNames(), destcrs, query.getTypeName(), null);
            } else {
                if (query.retrieveAllProperties()) {
                    // nothing to change
                    return current;
                } else {
                    return DataUtilities.createSubType(current, query.getPropertyNames());
                }
            }
        } catch (SchemaException ex) {
            logger.log(Level.SEVERE, "Error converting feature type to match query request.", ex);
        }
        return null;
    }

