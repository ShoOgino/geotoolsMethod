    /**
     * Inverse operation of marshall : read a feature from a stream.
     *
     * @param s the stream to read from
     * @param the type of the feature to unmarshall
     * @return the unmarshalled feature
     * @throws IOException
     * @throws ClassNotFoundException
     * @throws IllegalAttributeException
     */
    protected SimpleFeature unmarshall(ObjectInput s, SimpleFeatureType type)
            throws IOException, ClassNotFoundException, IllegalAttributeException {
        String fid = (String) s.readObject();
        int natt = s.readInt();

        SimpleFeatureBuilder builder = lookupBuilder(type);

        if (!(natt == type.getAttributeCount())) {
            throw new IOException("Schema error");
        }

        for (int i = 0; i < natt; i++) {
            builder.add(unmarshallSimpleAttribute(s));
        }
        // return builder.feature(fid);
        return builder.buildFeature(fid);
    }

