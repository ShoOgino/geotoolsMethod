    /**
     * Perform a perceptual test verifying that icons can be correctly retrieved by name from a
     * sprite sheet.
     */
    @Test
    public void testRenderSpriteIcons() throws Exception {
        // Use the feature's "icon" property.
        String iconUrl = constructSpriteUrl(spriteBaseUrl, "${icon}");
        MapContent mc = new MapContent();
        ExternalGraphic eg = styleFactory.createExternalGraphic(iconUrl, "mbsprite");

        // Also add a simple background layer.
        mc.addLayer(
                new FeatureLayer(
                        bgFS,
                        SLD.wrapSymbolizers(
                                styleFactory.createPolygonSymbolizer(
                                        null,
                                        styleFactory.createFill(filterFactory.literal("#6ba3ff")),
                                        null))));

        mc.addLayer(new FeatureLayer(pointFS, pointStyleWithExternalGraphic(eg, null)));

        // Render the image and do a perceptual assert.
        StreamingRenderer renderer = new StreamingRenderer();
        renderer.setMapContent(mc);
        renderer.setJava2DHints(new RenderingHints(KEY_ANTIALIASING, VALUE_ANTIALIAS_ON));
        BufferedImage image =
                MapboxTestUtils.showRender(
                        "Mapbox Sprite Icon Test",
                        renderer,
                        DISPLAY_TIME,
                        new ReferencedEnvelope[] {bounds},
                        null);
        ImageAssert.assertEquals(file("rendered-icons"), image, 50);
    }

