    /**
     * Transform MBStyle to a GeoTools UserLayer.
     * 
     * @param mbStyle MBStyle
     * @return user layer
     */
    public StyledLayerDescriptor transform(MBStyle mbStyle) {
        JSONParser parser = new JSONParser();

        List<MBLayer> layers = mbStyle.layers();
        if (layers.isEmpty()) {
            throw new MBFormatException("layers empty");
        }


        StyledLayerDescriptor sld = sf.createStyledLayerDescriptor();
        Style style = sf.createStyle();

        for (MBLayer layer : layers) {
            
            int layerMaxZoom = layer.getMaxZoom();
            int layerMinZoom = layer.getMinZoom();
            Double layerMinScaleDenominator = layerMaxZoom == Integer.MAX_VALUE ? null
                    : MBObjectStops.zoomLevelToScaleDenominator((long) Math.min(25, layerMaxZoom));
            Double layerMaxScaleDenominator = layerMinZoom == Integer.MIN_VALUE ? null
                    : MBObjectStops.zoomLevelToScaleDenominator((long) Math.max(-25, layerMinZoom));
            
            Boolean hasStops = false;
            if (layer.visibility()) {
                if (layer.getPaint() != null) {
                    hasStops = MBObjectStops.hasStops(layer.getPaint());
                }
                if (layer.getLayout() != null && !hasStops) {
                    hasStops = MBObjectStops.hasStops(layer.getLayout());
                }
                FeatureTypeStyle featureTypeStyle = null;
                List<Long> stopLevels = MBObjectStops.getStopLevels(layer);
                if (stopLevels.size() > 0 && hasStops) {
                    try {
                        List<MBLayer> stopLayers = MBObjectStops.getLayerStyleForStops(layer, stopLevels);
                        List<long[]> ranges = MBObjectStops.getStopLevelRanges(stopLevels);
                        int j = 0;
                        for (MBLayer l : stopLayers) {
                            long stopLevel = stopLevels.get(j);

                            long[] rangeForStopLevel = MBObjectStops.getRangeForStop(stopLevel, ranges);
                            Double minScaleDenominator = MBObjectStops.zoomLevelToScaleDenominator(rangeForStopLevel[0]);
                            Double maxScaleDenominator = null;
                            if (stopLevel != rangeForStopLevel[1] && rangeForStopLevel[1] != -1) {
                                maxScaleDenominator = MBObjectStops.zoomLevelToScaleDenominator(rangeForStopLevel[1]);
                            }
                            
                            featureTypeStyle = transform(l, mbStyle, maxScaleDenominator, minScaleDenominator);
//                            Rule rule = featureTypeStyle.rules().get(0);
//                            
//                            rule.setMinScaleDenominator(minScaleDenominator);
//                            rule.setMaxScaleDenominator(maxScaleDenominator);
                            
                            style.featureTypeStyles().add(featureTypeStyle);
                            j++;
                        }
                    } catch (ParseException e) {

                    }

                } else {
                    featureTypeStyle = transform(layer, mbStyle, layerMinScaleDenominator, layerMaxScaleDenominator);
                    style.featureTypeStyles().add(featureTypeStyle);
                }
            }
        }
        
        if( style.featureTypeStyles().isEmpty() ){
            throw new MBFormatException("No visibile layers");
        }
        
        UserLayer userLayer = sf.createUserLayer();
        userLayer.userStyles().add(style);
        
        sld.layers().add(userLayer);
        sld.setName(mbStyle.getName());
        return sld;
    }

