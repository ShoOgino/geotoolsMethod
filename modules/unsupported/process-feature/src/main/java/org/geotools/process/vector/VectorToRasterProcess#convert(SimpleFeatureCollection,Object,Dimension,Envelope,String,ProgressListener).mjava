    private GridCoverage2D convert(
            SimpleFeatureCollection features,
            Object attribute,
            Dimension gridDim,
            Envelope bounds,
            String covName,
            ProgressListener monitor)
            throws VectorToRasterException {

        if (monitor == null) {
            monitor = new NullProgressListener();
        }

        initialize(features, bounds, attribute, gridDim);

        monitor.setTask(new SimpleInternationalString("Rasterizing features..."));

        float scale = 100.0f / features.size();
        monitor.started();

        try (SimpleFeatureIterator fi = features.features()) {
            int counter = 0;
            while (fi.hasNext()) {
                try {
                    processFeature(fi.next(), attribute);
                } catch (Exception e) {
                    monitor.exceptionOccurred(e);
                }

                monitor.progress(scale * counter++);
            }
        }
        monitor.complete();

        flattenImage();

        GridCoverageFactory gcf = new GridCoverageFactory();
        return gcf.create(covName, image, extent);
    }

