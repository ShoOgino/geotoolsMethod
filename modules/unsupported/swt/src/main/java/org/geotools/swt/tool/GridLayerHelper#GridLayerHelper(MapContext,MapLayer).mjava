    /**
     * Create a new helper to work with the given raster data source.
     *
     * @param context the {@code MapContext} associated with this helper
     * @param rasterSource an instance of either
     *        {@code GridCoverage2D} or {@code AbstractGridCoverage2DReader
     */
    public GridLayerHelper( MapContext context, MapLayer layer ) {
        super(context, null);

        Object rasterSource = null;
        try {
            FeatureIterator< ? > iter = layer.getFeatureSource().getFeatures().features();
            String gridAttrName = Utils.getGridAttributeName(layer);
            rasterSource = iter.next().getProperty(gridAttrName).getValue();
        } catch (Exception ex) {
            throw new IllegalStateException("Unable to access raster feature data", ex);
        }

        GridCoverage2D cov = null;
        try {
            if (AbstractGridCoverage2DReader.class.isAssignableFrom(rasterSource.getClass())) {
                cov = ((AbstractGridCoverage2DReader) rasterSource).read(null);
            } else {
                cov = (GridCoverage2D) rasterSource;
            }

            this.covRef = new WeakReference<GridCoverage2D>(cov);

        } catch (Exception ex) {
            throw new IllegalArgumentException(ex);
        }

        setCRS(cov.getCoordinateReferenceSystem());
    }

