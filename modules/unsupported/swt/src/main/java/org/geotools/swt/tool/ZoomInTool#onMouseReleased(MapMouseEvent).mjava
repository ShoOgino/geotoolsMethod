    /**
     * If the mouse was dragged, determines the bounds of the
     * box that the user defined and passes this to the mapPane's
     * {@link org.geotools.swing.JMapPane#setDisplayArea(org.opengis.geometry.Envelope) }
     * method
     *
     * @param ev the mouse event
     */
    @Override
    public void onMouseReleased( MapMouseEvent ev ) {

        if ( ! isTriggerMouseButton(ev)) {
            return;
        }

        if (dragged) {
            Envelope2D env = new Envelope2D();
            env.setFrameFromDiagonal(startDragPos, ev.getMapPosition());
            dragged = false;
            getMapPane().setDisplayArea(env);
        } else {
            Rectangle paneArea = getMapPane().getVisibleRect();

            double scale = getMapPane().getWorldToScreenTransform().getScaleX();
            double newScale = scale * zoom;

            DirectPosition2D corner = new DirectPosition2D(startDragPos.getX() - 0.5d * paneArea.width / newScale,
                    startDragPos.getY() + 0.5d * paneArea.height / newScale);

            Envelope2D newMapArea = new Envelope2D();
            newMapArea.setFrameFromCenter(startDragPos, corner);
            getMapPane().setDisplayArea(newMapArea);
        }

    }

