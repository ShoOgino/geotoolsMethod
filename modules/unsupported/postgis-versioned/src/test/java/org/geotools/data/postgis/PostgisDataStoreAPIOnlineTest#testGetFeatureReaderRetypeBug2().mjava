    public void testGetFeatureReaderRetypeBug2() throws Exception {
        // this is here to avoid http://jira.codehaus.org/browse/GEOT-1069
        // to come up again

        Transaction t = new DefaultTransaction();
        SimpleFeatureType type = data.getSchema("river");
         FeatureReader<SimpleFeatureType, SimpleFeature> reader;

        FilterFactory ff = FilterFactoryFinder.createFilterFactory();
        CompareFilter cf = ff.createCompareFilter(Filter.COMPARE_EQUALS);
        FunctionExpression ceil = new FilterFunction_ceil();
        ceil.setArgs(new Expression[] { ff.createAttributeExpression("flow") });
        cf.addLeftValue(ceil);
        cf.addRightValue(ff.createLiteralExpression(5));

        Query q = new Query("river");
        q.setPropertyNames(new String[] { "geom" });
        q.setFilter(cf);

        // with GEOT-1069 an exception is thrown here
        reader = data.getFeatureReader(q, t);
        assertTrue(reader.hasNext());
        assertEquals(1, reader.getFeatureType().getAttributeCount());
        reader.next();
        assertFalse(reader.hasNext());
        reader.close();
        t.close();
    }

