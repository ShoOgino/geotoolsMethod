    /**
     * Given an original query and a revision info, builds an equivalent query that will work
     * against the specified revision
     * 
     * @param query
     * @param ri
     * @return
     * @throws FactoryRegistryException
     * @throws IOException
     */
    DefaultQuery buildVersionedQuery(Query query) throws IOException {
        RevisionInfo ri = new RevisionInfo(query.getVersion());
        // build a filter that limits the number
        Filter newFilter = buildVersionedFilter(query.getTypeName(), query.getFilter(), ri);
        DefaultQuery versionedQuery = new DefaultQuery(query);
        versionedQuery.setPropertyNames(filterPropertyNames(query));
        versionedQuery.setFilter(newFilter);
        return versionedQuery;
    }

