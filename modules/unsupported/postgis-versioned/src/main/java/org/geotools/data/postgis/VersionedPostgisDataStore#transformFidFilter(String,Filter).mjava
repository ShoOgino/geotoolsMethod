    /**
     * Takes a fid filter with external fids and turns it into a set of filters against internal
     * feature type attributes, that is, an equivalent filter that can run against the internal,
     * versioned feature type
     * 
     * @param featureTypeName
     * @param filter
     * @return
     * @throws IOException
     * @throws FactoryRegistryException
     */
    protected Filter transformFidFilter(String featureTypeName, Filter filter) throws IOException,
            FactoryRegistryException {
        if(isVersionedFeatureCollection(featureTypeName))
            featureTypeName = getVFCTableName(featureTypeName);
        SimpleFeatureType featureType = wrapped.getSchema(featureTypeName);
        VersionedFIDMapper mapper = (VersionedFIDMapper) wrapped.getFIDMapper(featureTypeName);
        FidTransformeVisitor transformer = new FidTransformeVisitor(ff, featureType, mapper);
        
        Filter clone = (Filter) filter.accept(transformer, null);
        return clone;
    }

