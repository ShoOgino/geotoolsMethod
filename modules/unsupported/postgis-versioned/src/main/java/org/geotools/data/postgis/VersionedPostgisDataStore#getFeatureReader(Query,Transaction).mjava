    public  FeatureReader<SimpleFeatureType, SimpleFeature> getFeatureReader(Query query, Transaction trans) throws IOException {
        if (!isVersioned(query.getTypeName())) {
            return wrapped.getFeatureReader(query, trans);
        }

        // check what revision we have to gather, and build a modified query
        // that extracts it
        DefaultQuery versionedQuery = buildVersionedQuery(query);

         FeatureReader<SimpleFeatureType, SimpleFeature> reader = wrapped.getFeatureReader(versionedQuery, trans);
        VersionedFIDMapper mapper = (VersionedFIDMapper) getFIDMapper(query.getTypeName());
        return new VersionedFeatureReader(reader, mapper);
    }

