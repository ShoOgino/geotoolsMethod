    /**
     * Generates the order by clause.
     * <p>
     * This uses the standard ASC,DESC sql keywords to denote ascending,descending
     * sort respectivley.
     * </p>
     * 
     * FIXME:  Throw FilterToSQLException when the parent interface is fixed.
     */
    public void sqlOrderBy(StringBuffer sql, FIDMapper mapper, SortBy[] sortBy) throws SQLEncoderException {
    	if ( sortBy == null || sortBy.length == 0 ) 
    		return;	//nothing to sort on
    	
    	sql.append( " ORDER BY ");
    	for ( int i = 0; i < sortBy.length; i++ ) {
    		AttributeDescriptor type = (AttributeDescriptor) sortBy[i].getPropertyName().evaluate( ft );
    		if ( type != null ) {
    			sql.append( encoder.escapeName( type.getLocalName() ) );
    		}
    		else {
    			sql.append( encoder.escapeName( sortBy[i].getPropertyName().getPropertyName() ) );	
    		}
    		
    		
    		if ( SortOrder.DESCENDING.equals( sortBy[i].getSortOrder() ) ) {
    			sql.append( " DESC");
    		}
    		else {
    			sql.append( " ASC");
    		}
    		
    		if ( i < sortBy.length-1 ) {
    			sql.append( ", ");
    		}
    	}
    	
    }

