    public SimpleFeature next() throws IOException {
        SimpleFeature original = null;
        if (updateWriter != null && updateWriter.hasNext()) {
            oldFeature = updateWriter.next();
            newFeature = appendWriter.next();
            original = oldFeature;
            state.expandDirtyBounds(getWgs84FeatureEnvelope(oldFeature));
        } else {
            oldFeature = null;
            newFeature = appendWriter.next();
            original = newFeature;
        }

        try {
            liveFeature = DataUtilities.reType(featureType, original);
            // if the feature it brand new, it'll have a random fid, not a
            // proper one, keep using
            // it, we cannot un-version it
            String unversionedId = liveFeature.getID();
            if (oldFeature != null)
                unversionedId = mapper.getUnversionedFid(liveFeature.getID());
            liveFeature = new MutableFIDFeature((List) liveFeature
                    .getAttributes(), featureType, unversionedId);
            return liveFeature;
        } catch (IllegalAttributeException e) {
            throw new DataSourceException("Error casting versioned feature to external one. "
                    + "Should not happen, there's a bug at work", e);
        }
    }

