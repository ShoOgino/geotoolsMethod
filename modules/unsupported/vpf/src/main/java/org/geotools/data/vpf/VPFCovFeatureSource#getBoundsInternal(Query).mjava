    /**
     * Implementation that generates the total bounds (many file formats record this information in
     * the header)
     */
    protected ReferencedEnvelope getBoundsInternal(Query query) throws IOException {
        CoordinateReferenceSystem crs = this.featureType.getCoordinateReferenceSystem();
        ReferencedEnvelope bounds = null;

        FeatureReader<SimpleFeatureType, SimpleFeature> rdr = this.getReader();
        while (rdr.hasNext()) {
            SimpleFeature feature = rdr.next();

            if (feature != null) {

                BoundingBox bb = feature.getBounds();

                if (bounds == null) bounds = new ReferencedEnvelope(bb);
                else bounds.expandToInclude(ReferencedEnvelope.reference(bb));

                /*Object g = feature.getDefaultGeometry();
                if(g != null) {
                    System.out.println("++++++++++++++++++++++++++ found geom");
                    System.out.println(g.toString());
                }*/

            }
        }

        if (bounds == null) {
            bounds = ReferencedEnvelope.create(crs);
        }

        return bounds;
    }

