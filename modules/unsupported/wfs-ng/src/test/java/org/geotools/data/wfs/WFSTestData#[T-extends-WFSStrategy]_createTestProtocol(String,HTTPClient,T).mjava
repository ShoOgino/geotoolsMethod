    /**
     * Creates the test {@link #wfs} with the provided connection factory that parses the
     * capabilities object from the test xml file pointed out by {@code capabilitiesFileName}
     * <p>
     * Tests methods call this one to set up a protocolHandler to test
     * </p>
     * 
     * @param capabilitiesFileName
     *            the relative path under {@code test-data} for the file containing the
     *            WFS_Capabilities document.
     */
    public static <T extends WFSStrategy> T createTestProtocol(String capabilitiesFileName,
            HTTPClient http, T real) throws Exception {

        InputStream stream = TestData.openStream(WFSTestData.class, capabilitiesFileName);
        GetCapabilitiesResponse response = new GetCapabilitiesResponse(response(stream));
        WFSGetCapabilities capabilities = response.getCapabilities();
        real.setCapabilities(capabilities);
        real.setConfig(new WFSConfig());
        return real;
    }

