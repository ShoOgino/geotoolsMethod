    public static void doFeatureReaderWithBBox(
            DataStore wfs, String typeName, ReferencedEnvelope bbox) throws Exception {
        SimpleFeatureType featureType = wfs.getSchema(typeName);

        // take atleast attributeType 3 to avoid the undeclared one .. inherited optional attrs
        FilterFactory2 ff = CommonFactoryFinder.getFilterFactory2(null);
        Query query = new Query(featureType.getTypeName());
        PropertyName theGeom = ff.property(featureType.getGeometryDescriptor().getName());
        Filter filter = ff.bbox(theGeom, bbox);

        query.setFilter(filter);
        try (FeatureReader<SimpleFeatureType, SimpleFeature> fr =
                wfs.getFeatureReader(query, Transaction.AUTO_COMMIT)) {
            assertNotNull("GET " + typeName + " FeatureType was null", featureType);

            assertTrue("GET " + typeName + " has next?", fr.hasNext());
            assertNotNull("GET " + typeName + " has feature type", fr.getFeatureType());

            SimpleFeature feature = fr.next();

            assertNotNull("GET " + typeName + " has non null feature", feature);

            int j = 0;
            while (fr.hasNext()) {
                fr.next();
                j++;
            }
            assertTrue(j > 0);
        }
    }

