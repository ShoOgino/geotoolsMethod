    @Override
    public synchronized void commit() throws IOException {
        try {
            commitInternal();
        } finally {
            // If the commit fails or succeeds, state is reset
            clear();
        }
    }

