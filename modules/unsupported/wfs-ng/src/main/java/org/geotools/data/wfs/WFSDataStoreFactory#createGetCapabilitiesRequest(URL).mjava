    /**
     * Creates a HTTP GET Method based WFS {@code GetCapabilities} request.
     *
     * <p>If the query string in the {@code host} URL already contains a VERSION number, that
     * version is used, otherwise the queried version will be 1.0.0.
     *
     * <p><b>NOTE</b> the default version will be 1.0.0 until the support for 1.1.0 gets stable
     * enough for general use. If you want to use a 1.1.0 WFS you'll have to explicitly provide the
     * VERSION=1.1.0 parameter in the GetCapabilities request meanwhile.
     *
     * @param host non null URL pointing either to a base WFS service access point, or to a full
     *     {@code GetCapabilities} request.
     */
    public static URL createGetCapabilitiesRequest(final URL host) {
        if (host == null) {
            throw new NullPointerException("url");
        }

        String queryString = host.getQuery();
        queryString =
                queryString == null || "".equals(queryString.trim())
                        ? ""
                        : queryString.toUpperCase();

        final Version defaultVersion = Versions.highest();

        // which version to use
        Version requestVersion = defaultVersion;

        if (queryString.length() > 0) {

            Map<String, String> params = new HashMap<>();
            String[] split = queryString.split("&");
            for (String kvp : split) {
                int index = kvp.indexOf('=');
                String key = index > 0 ? kvp.substring(0, index) : kvp;
                String value = index > 0 ? kvp.substring(index + 1) : null;
                params.put(key, value);
            }

            String request = params.get("REQUEST");
            if ("GETCAPABILITIES".equals(request)) {
                String version = params.get("VERSION");
                if (version != null) {
                    requestVersion = Versions.find(version);
                    if (requestVersion == null) {
                        requestVersion = defaultVersion;
                    }
                }
            }
        }
        return createGetCapabilitiesRequest(host, requestVersion);
    }

