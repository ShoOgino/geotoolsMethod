    private WFSResponse issuePostRequest(final EObject request, final URL url, final Encoder encoder)
            throws IOException {

        final POSTCallBack requestBodyCallback = new POSTCallBack() {
            public long getContentLength() {
                // don't know
                return -1;
            }

            public String getContentType() {
                return "text/xml";
            }

            public void writeBody(final OutputStream out) throws IOException {
                final Charset charset = Charset.forName("UTF-8");
                encoder.setEncoding(charset);
                // if (LOGGER.isLoggable(Level.FINEST)) {
                // System.err.println("Sending POST request: ");
                // WFS_1_1_0_Protocol.encode(request, wfsConfig, System.err, charset);
                // }
                WFS_1_1_0_Protocol.encode(request, encoder, out);
            }
        };

        HTTPResponse httpResponse = http.issuePost(url, requestBodyCallback);

        String responseCharset = httpResponse.getResponseCharset();
        Charset charset = responseCharset == null ? null : Charset.forName(responseCharset);
        String contentType = httpResponse.getContentType();
        InputStream responseStream = httpResponse.getResponseStream();
        String target = httpResponse.getTargetUrl();
        WFSResponse response = new WFSResponse(target, request, charset, contentType,
                responseStream);
        return response;
    }

