    /**
     * Creates the HttpClient instance used to connect to the WFS service, compatible with the given
     * parameters.
     *
     * @param params wfs service connection parameters
     * @return the HttpClient instance
     */
    public HTTPClient getHttpClient(final Map<String, ?> params) throws IOException {
        final URL capabilitiesURL = URL.lookUp(params);
        final WFSConfig config = WFSConfig.fromParams(params);
        if (config.isUseHttpConnectionPooling() && isHttp(capabilitiesURL)) {
            HTTPClient client = HTTPClientFinder.createClient(HTTPConnectionPooling.class);

            client.setReadTimeout(config.getTimeoutMillis() / 1000);
            client.setConnectTimeout(config.getTimeoutMillis() / 1000);
            ((HTTPConnectionPooling) client).setMaxConnections(config.getMaxConnectionPoolSize());

            return client;
        } else {
            return HTTPClientFinder.createClient();
        }
    }

