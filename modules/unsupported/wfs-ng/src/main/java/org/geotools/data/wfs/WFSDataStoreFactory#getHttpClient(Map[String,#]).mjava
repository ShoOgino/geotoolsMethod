    /**
     * Creates the HttpClient instance used to connect to the WFS service, compatible with the given
     * parameters.
     *
     * @param params wfs service connection parameters
     * @return the HttpClient instance
     */
    public HTTPClient getHttpClient(final Map<String, ?> params) throws IOException {
        final URL capabilitiesURL = (URL) URL.lookUp(params);
        final WFSConfig config = WFSConfig.fromParams(params);
        return config.isUseHttpConnectionPooling() && isHttp(capabilitiesURL)
                ? new MultithreadedHttpClient(config)
                : new SimpleHttpClient();
    }

