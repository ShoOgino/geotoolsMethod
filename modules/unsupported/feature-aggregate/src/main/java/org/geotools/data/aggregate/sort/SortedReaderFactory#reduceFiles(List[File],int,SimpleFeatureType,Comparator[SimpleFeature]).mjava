    /**
     * Reduces the file list to the max number of files ensuring that we won't keep more than
     * maxFiles open at any time
     * 
     * @param files
     * @param maxFiles
     */
    static void reduceFiles(List<File> files, int maxFiles, SimpleFeatureType schema,
            Comparator<SimpleFeature> comparator) throws IOException {
        while (files.size() > maxFiles) {
            // merge the first batch into a single file
            List<File> currFiles = new ArrayList<File>(files.subList(0, maxFiles));
            SimpleFeatureReader reader = new MergeSortReader(schema, currFiles, comparator);
            File file = storeToFile(reader);

            // remove those files from the list and add the merged file at the end
            files.removeAll(currFiles);
            files.add(file);
        }

    }

