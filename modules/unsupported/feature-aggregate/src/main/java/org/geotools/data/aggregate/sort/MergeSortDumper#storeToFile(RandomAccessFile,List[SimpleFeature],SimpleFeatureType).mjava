    /**
     * Writes the feature attributes to a binary file
     * 
     * @param features
     * @return
     * @throws IOException
     */
    static FeatureBlockReader storeToFile(RandomAccessFile raf, List<SimpleFeature> features,
            SimpleFeatureType schema) throws IOException {
        long start = raf.getFilePointer();

        // write each attribute in the random access file
        List<AttributeDescriptor> attributes = schema.getAttributeDescriptors();
        for (SimpleFeature sf : features) {
            // write feature id
            raf.writeUTF(sf.getID());
            // write the attributes
            for (AttributeDescriptor ad : attributes) {
                Object value = sf.getAttribute(ad.getLocalName());
                writeAttribute(raf, ad, value);
            }
        }

        return new FeatureBlockReader(raf, start, features.size(), schema);
    }

