    @Override
    public boolean hasNext() throws IOException {
        if(next != null && next != FeatureQueue.END_MARKER) {
            return true;
        }
        
        // did we get any exception? if so the queue is closing anyways
        Exception e = queue.getException();
        if (e != null) {
            throw new IOException("Data retrieval failed", e);
        }

        // loop and see if we can grab a feature, or if we just get the end markers
        try {
            while(next == null || next == FeatureQueue.END_MARKER) {
                if (queue.isDone()) {
                    return false;
                }
                next = queue.take();
            }
        } catch (InterruptedException ie) {
            throw new IOException("Error while waiting for next feature", ie);
        }
        return true;
    }

