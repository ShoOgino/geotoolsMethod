    @Override
    public boolean hasNext() throws IOException {
        if (next != null && next != FeatureQueue.END_MARKER) {
            return true;
        }

        checkException();

        // loop and see if we can grab a feature, or if we just get the end markers
        try {
            while (next == null || next == FeatureQueue.END_MARKER) {
                if (queue.isDone()) {
                    return false;
                }
                next = queue.take();
                checkException();
            }
        } catch (InterruptedException ie) {
            throw new IOException("Error while waiting for next feature", ie);
        }
        return true;
    }

