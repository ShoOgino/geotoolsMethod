    @Override
    protected FeatureReader<SimpleFeatureType, SimpleFeature> getReaderInternal(Query query)
            throws IOException {
        try {
            // get the target schema from the primary store
            Query psQuery = new Query(query);
            Name psName = config.getPrimaryStore();
            psQuery.setTypeName(config.getStoreMap().get(psName));
            DataStore ps = getStore().getStore(psName, false);
            SimpleFeatureType target = DataUtilities.createView(ps, psQuery).getSchema();
            target = retypeNameSchema(target);

            // schedule all the data retrieval operations
            FeatureQueue queue = new FeatureQueue(config.getStoreMap().size());
            AggregatingDataStore store = getStore();
            for (Map.Entry<Name, String> entry : config.getStoreMap().entrySet()) {
                FeatureCallable fc = new FeatureCallable(store, query, entry.getKey(),
                        entry.getValue(), queue, target);
                queue.addSource(fc);
                store.submit(fc);
            }

            // return the feature collection reading from the queue
            if (query.getSortBy() != null && query.getSortBy() != null) {
                throw new UnsupportedOperationException("We can't sort at the moment");
            } else {
                return new QueueReader(queue, target);
            }
        } catch (SchemaException e) {
            throw new IOException("Failed to compute target feature type", e);
        }
    }

