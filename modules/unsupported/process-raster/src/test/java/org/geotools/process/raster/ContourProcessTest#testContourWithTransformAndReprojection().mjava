    @Test
    public void testContourWithTransformAndReprojection() throws Exception {
        int width = 256;
        int height = 256;
        // The style with opacity will not use the screenmap.
        int whiteSamples1 = countWhiteSamples("contour_with_opacity.sld", width, height);
        // The style without opacity will use the screenmap.
        int whiteSamples2 = countWhiteSamples("contour_without_opacity.sld", width, height);
        // The white contour lines with the sample data and styles should cover about
        // 0.25% of the rendered image regardless of whether the screenmap is used.
        // The bug that this is testing would cause a large number of diagonal lines
        // to be drawn across the image so the percentage of white pixels with the
        // bug would be significantly higher.
        double area = width * height;
        assertEquals(0.0025, whiteSamples1 / area, 0.0005);
        assertEquals(0.0025, whiteSamples2 / area, 0.0005);
    }

