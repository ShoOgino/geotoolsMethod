    private void checkCollectionPoints(
            SimpleFeatureCollection collection,
            boolean hemisphere,
            Float scaleFactor,
            CoordinateReferenceSystem targetCRS)
            throws MismatchedDimensionException, TransformException {
        // World2Grid transform associated to the coverage
        MathTransform2D w2g =
                coverage.getGridGeometry().getCRSToGrid2D(PixelOrientation.UPPER_LEFT);
        // Iterator on the FeatureCollection
        // Iterator on the input image
        // Boolean indicating that the TargetCRS is not null
        // Cycle on the Collection
        try (SimpleFeatureIterator it = collection.features()) {
            RandomIter imageIterator = RandomIterFactory.create(coverage.getRenderedImage(), null);
            boolean crsExists = targetCRS != null;
            while (it.hasNext()) {
                // Selection of the feature
                SimpleFeature ft = it.next();
                // If the scale factor is more than 1 then no comparison between the values is done
                // due
                // to possible differences on the interpolation
                if (scaleFactor == null) {
                    // Selection of the associated point
                    Point point = (Point) ft.getDefaultGeometry();
                    Point rasterPoint = (Point) JTS.transform(point, w2g);
                    int x = (int) (rasterPoint.getX());
                    int y = (int) (rasterPoint.getY());
                    // Selection of the value for the single band for the selected position
                    int sampleIMG = imageIterator.getSample(x, y, 0);
                    int sampleColl = (Short) ft.getAttribute(bandName);
                    // Ensure the values are equal
                    Assert.assertEquals(sampleIMG, sampleColl);
                }
                // Check the hemisphere
                if (hemisphere) {
                    Assert.assertEquals(NORTH, ft.getAttribute("emisphere"));
                }
                // Check the GridConvergenceAngle
                if (crsExists) {
                    double angle = (double) ft.getAttribute("gridConvergenceAngleCorrection");
                    Assert.assertTrue(angle != 0);
                }
            }
        }
    }

