    /**
     * Creates a region from envelope bounds snapped to a region grid.
     * 
     * <p>
     * This takes an envelope and a JGrass region and creates a new region to
     * match the bounds of the envelope, but the grid of the region. This is
     * important if the region has to match some feature layer.
     * </p>
     * <p>
     * The bounds of the new region contain completely the envelope.
     * </p>
     * 
     * @param sourceEnvelope
     *            the envelope to adapt.
     * @param sourceRegion
     *            the region from which to take the grid to be snapped.
     * @return a new region, created from the envelope bounds snapped to the
     *         region grid.
     */
    public static JGrassRegion adaptActiveRegionToEnvelope( Envelope sourceEnvelope,
            JGrassRegion sourceRegion ) {
        Coordinate eastNorth = JGrassRegion.snapToNextHigherInRegionResolution(sourceEnvelope
                .getMaxX(), sourceEnvelope.getMaxY(), sourceRegion);
        Coordinate westsouth = JGrassRegion.snapToNextHigherInRegionResolution(sourceEnvelope
                .getMinX()
                - sourceRegion.getWEResolution(), sourceEnvelope.getMinY()
                - sourceRegion.getNSResolution(), sourceRegion);
        JGrassRegion newRegion = new JGrassRegion(westsouth.x, eastNorth.x, westsouth.y,
                eastNorth.y, sourceRegion.getWEResolution(), sourceRegion.getNSResolution());
        return newRegion;
    }

