    /**
     * @see org.geotools.data.FeatureStore#modifyFeatures(org.opengis.feature.type.Name[],
     *      java.lang.Object[], org.opengis.filter.Filter)
     */
    @Override
    public void modifyFeatures(final Name[] attributeNames,
            final Object[] attributeValues, final Filter filter)
            throws IOException {

        checkTransaction();
        // throws exception if filter has a resourceid that doesn't match the
        // current version
        checkEditFilterMatchesCurrentVersion(filter);

        final SimpleFeatureCollection affectedFeatures = getFeatures(filter);
        final FeatureCollection newValues = new ModifyingFeatureCollection(
                affectedFeatures, attributeNames, attributeValues);

        VersioningTransactionState versioningState = getVersioningState();
        try {
            versioningState.stageUpdate(type.getName(), newValues);
        } catch (Exception e) {
            throw new IOException(e);
        }
    }

