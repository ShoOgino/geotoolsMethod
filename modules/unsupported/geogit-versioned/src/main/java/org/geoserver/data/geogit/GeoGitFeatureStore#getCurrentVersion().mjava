    /**
     * @return the object id of the current HEAD's commit if we're not inside a
     *         transaction, or {@code null} if we're inside a transaction
     */
    @Override
    public RevTree getCurrentVersion() {
        if (getTransaction() == null
                || Transaction.AUTO_COMMIT.equals(getTransaction())) {
            return super.getCurrentVersion();
        }

        // assume HEAD is at MASTER
        try {
            final Name typeName = this.type.getName();
            Repository repository = dataStore.getRepository();
            WorkingTree workingTree = repository.getWorkingTree();
            RevTree typeTree = workingTree.getStagedVersion(typeName);
            return typeTree;
        } catch (Exception e) {
            throw new RuntimeException(e);
        }
    }

