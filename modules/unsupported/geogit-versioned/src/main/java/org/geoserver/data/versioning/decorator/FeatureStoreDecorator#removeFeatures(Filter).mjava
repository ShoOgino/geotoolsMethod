    /**
     * @see org.geotools.data.FeatureStore#removeFeatures(org.opengis.filter.Filter)
     */
    @Override
    public void removeFeatures(Filter filter) throws IOException {
        final FeatureStore<T, F> unversioned = getUnversionedStore();
        if (isVersioned()) {
            checkTransaction();

            FeatureCollection<T, F> removed = unversioned.getFeatures(filter);
            try {
                Name typeName = getSchema().getName();
                getVersioningState().stageDelete(typeName, filter, removed);
            } catch (Exception e) {
                Throwables.propagate(e);
            }
        }
        unversioned.removeFeatures(filter);
    }

