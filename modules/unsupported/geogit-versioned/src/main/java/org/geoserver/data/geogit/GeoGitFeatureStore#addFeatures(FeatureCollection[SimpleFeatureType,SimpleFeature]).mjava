    /**
     * @see org.geotools.data.FeatureStore#addFeatures(org.geotools.feature.FeatureCollection)
     */
    @Override
    public List<FeatureId> addFeatures(
            FeatureCollection<SimpleFeatureType, SimpleFeature> collection)
            throws IOException {
        Preconditions.checkNotNull(collection);
        Preconditions.checkNotNull(collection.getSchema());
        Preconditions.checkArgument(type.getName().equals(
                collection.getSchema().getName()));

        checkTransaction();

        final Name typeName = getSchema().getName();
        final VersioningTransactionState versioningState = getVersioningState();

        List<FeatureId> insertedResourceIds;
        try {
            insertedResourceIds = versioningState.stageInsert(typeName,
                    collection);
        } catch (Exception e) {
            throw new IOException(e);
        }

        return insertedResourceIds;
    }

