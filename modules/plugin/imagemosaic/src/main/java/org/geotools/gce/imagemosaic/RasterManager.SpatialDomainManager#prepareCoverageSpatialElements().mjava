        /**
         * Initialize the 2D properties (CRS and Envelope) of this coverage
         *
         * @throws TransformException
         * @throws FactoryException
         * @throws TransformException
         * @throws FactoryException
         */
        private void prepareCoverageSpatialElements() throws TransformException, FactoryException {
            //
            // basic initialization
            //
            coverageGeographicBBox = ImageUtilities.getWGS84ReferencedEnvelope(coverageEnvelope);
            coverageGeographicCRS2D =
                    coverageGeographicBBox != null
                            ? coverageGeographicBBox.getCoordinateReferenceSystem()
                            : null;

            //
            // Get the original envelope 2d and its spatial reference system
            //
            coverageCRS2D = CRS.getHorizontalCRS(coverageCRS);
            assert coverageCRS2D.getCoordinateSystem().getDimension() == 2;
            if (coverageCRS.getCoordinateSystem().getDimension() != 2) {
                final MathTransform transform = CRS.findMathTransform(coverageCRS, coverageCRS2D);
                final GeneralEnvelope bbox = CRS.transform(transform, coverageEnvelope);
                coverageBBox = ReferencedEnvelope.create(bbox, coverageCRS2D);
            } else {
                // it is already a bbox
                coverageBBox =
                        ReferencedEnvelope.create(
                                coverageEnvelope, coverageEnvelope.getCoordinateReferenceSystem());
            }
        }

