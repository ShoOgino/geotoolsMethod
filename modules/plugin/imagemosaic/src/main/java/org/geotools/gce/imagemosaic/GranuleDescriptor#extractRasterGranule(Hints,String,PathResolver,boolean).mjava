    private URL extractRasterGranule(
            Hints hints,
            String granuleLocation,
            PathResolver pathResolver,
            boolean exceptionOnNullGranule) {
        boolean hasCustomGranuleProvider =
                hints != null && hints.containsKey(GranuleAccessProvider.GRANULE_ACCESS_PROVIDER);
        URL rasterGranule = null;
        if (!hasCustomGranuleProvider) {
            // If the granuleDescriptor is not there, dump a message and continue
            if (pathResolver != null) {
                rasterGranule = pathResolver.resolve(granuleLocation);
            } else {
                rasterGranule = URLs.fileToUrl(new File(granuleLocation));
            }

        } else {
            try {
                rasterGranule = new URL(granuleLocation);
            } catch (MalformedURLException e) {
                if (LOGGER.isLoggable(Level.WARNING)) {
                    LOGGER.warning(
                            "Unable to set an URL from the provided granuleLocation: "
                                    + granuleLocation);
                }
                rasterGranule = null;
            }
        }
        if (rasterGranule == null && exceptionOnNullGranule) {
            throw new IllegalArgumentException(
                    Errors.format(
                            ErrorKeys.ILLEGAL_ARGUMENT_$2, "granuleLocation", granuleLocation));
        }
        return rasterGranule;
    }

