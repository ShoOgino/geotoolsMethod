    public void initialize(final boolean checkDomains) throws IOException {
        final BoundingBox bounds = granuleCatalog.getBounds(typeName);
        if (checkDomains) {
            initDomains(configuration);
        }

        // we might have an imposed bbox
        CoordinateReferenceSystem crs = bounds.getCoordinateReferenceSystem();
        GeneralEnvelope originalEnvelope = null;

        if (imposedEnvelope == null) {
            originalEnvelope = new GeneralEnvelope(bounds);
        } else {
            originalEnvelope = new GeneralEnvelope(imposedEnvelope);
            originalEnvelope.setCoordinateReferenceSystem(crs);
        }

        // original gridrange (estimated). I am using the floor here in order to make sure
        // we always stays inside the real area that we have for the granule
        OverviewLevel highResOvLevel = overviewsController.resolutionsLevels.get(0);
        final double highestRes[] =
                new double[] {highResOvLevel.resolutionX, highResOvLevel.resolutionY};

        double xSpan = (originalEnvelope.getSpan(0) / highestRes[0]);
        double ySpan = (originalEnvelope.getSpan(1) / highestRes[1]);

        double xSpanCeil = Math.ceil(xSpan);
        double ySpanCeil = Math.ceil(ySpan);
        int width = (xSpanCeil - xSpan < 1E-10) ? (int) xSpanCeil : (int) xSpan;
        int height = (ySpanCeil - ySpan < 1E-10) ? (int) ySpanCeil : (int) ySpan;

//        GridEnvelope2D originalGridRange = new GridEnvelope2D(new Rectangle(width, height));
        GridEnvelope2D originalGridRange = new GridEnvelope2D(new Rectangle((int)xSpan, (int)ySpan));
        AffineTransform2D raster2Model =
                new AffineTransform2D(
                        highestRes[0],
                        0,
                        0,
                        -highestRes[1],
                        originalEnvelope.getLowerCorner().getOrdinate(0) + 0.5 * highestRes[0],
                        originalEnvelope.getUpperCorner().getOrdinate(1) - 0.5 * highestRes[1]);

        try {
            spatialDomainManager =
                    new SpatialDomainManager(
                            originalEnvelope,
                            originalGridRange,
                            crs,
                            raster2Model,
                            overviewsController);
        } catch (TransformException e) {
            throw new IOException(
                    "Exception occurred while initializing the SpatialDomainManager", e);
        } catch (FactoryException e) {
            throw new IOException(
                    "Exception occurred while initializing the SpatialDomainManager", e);
        }
        if (alternativeCRSCache != null) {
            alternativeCRSCache.invalidateAll();
        }
    }

