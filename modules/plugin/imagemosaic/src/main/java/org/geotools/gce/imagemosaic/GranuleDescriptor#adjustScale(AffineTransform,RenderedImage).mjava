    private void adjustScale(AffineTransform finalRaster2Model, RenderedImage raster) {
        // There are corner cases where the scaleFactor is almost 1 and the
        double scaleX = finalRaster2Model.getScaleX();
        double scaleY = finalRaster2Model.getScaleY();
        int width = raster.getWidth();
        int height = raster.getHeight();
        double widthDifference = width - (scaleX * width);
        double heightDifference = height - (scaleY * height);
        boolean adjustScaleX = false;
        boolean adjustScaleY = false;
        if ((1 - scaleX) < 1E-2 && (widthDifference > 0 && widthDifference <= 0.5)) {
            adjustScaleX = true;
            scaleX = 1d / scaleX;
        }
        if ((1 - scaleY) < 1E-2 && (heightDifference > 0 && heightDifference <= 0.5)) {
            adjustScaleY = true;
            scaleY = 1d / scaleY;
        }
        if (adjustScaleX || adjustScaleY) {
            finalRaster2Model.scale(adjustScaleX ? scaleX : 1d, adjustScaleY ? scaleY : 1d);
        }
    }

