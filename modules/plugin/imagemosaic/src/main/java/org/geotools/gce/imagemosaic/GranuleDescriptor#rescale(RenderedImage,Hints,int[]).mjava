    private RenderedImage rescale(RenderedImage raster, Hints hints, int[] bands) {
        Double[] rescalingScales = scales;
        Double[] rescalingOffsets = offsets;

        // make sure to update scales and offsets if there is a band-selection
        if (bands != null && (scales != null || offsets != null)) {
            rescalingScales = new Double[bands.length];
            rescalingOffsets = new Double[bands.length];
            int i = 0;
            for (int bandIndex : bands) {
                rescalingScales[i] = scales != null ? scales[bandIndex] : null;
                rescalingOffsets[i++] = offsets != null ? offsets[bandIndex] : null;
            }
        }
        raster = ImageUtilities.applyRescaling(rescalingScales, rescalingOffsets, raster, hints);
        return raster;
    }

