    @Override
    public int removeGranules(Filter filter, Hints hints) {
        try {
            int removed = catalog.removeGranules(new Query(typeName, filter), transaction);

            // we cannot re-initialize a raster manager if there are no granules
            Query q = new Query(manager.getTypeName());
            q.setMaxFeatures(1);
            if (DataUtilities.count(catalog.getGranules(q, transaction)) > 0) {
                manager.initialize(true, transaction);
            }
            return removed;
        } catch (IOException e) {
            throw new RuntimeException("Failed to remove granules matching " + filter, e);
        }
    }

