    public void getGranuleDescriptors(Query q, GranuleCatalogVisitor visitor) throws IOException {
        Utilities.ensureNonNull("q", q);
        final Lock lock = rwLock.readLock();
        try {
            lock.lock();
            checkStore();

            // get filter and check bbox
            final Filter filter = q.getFilter();
            ReferencedEnvelope requestedBBox = extractAndCombineBBox(filter);

            // get filter and check bbox
            checkIndex(lock);
            index.query(requestedBBox, new JTSIndexVisitorAdapter(visitor, q));

        } finally {
            lock.unlock();
        }
    }

