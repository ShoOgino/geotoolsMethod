    @Override
    public int removeGranules(Query query) {
        Utilities.ensureNonNull("query", query);
        query = mergeHints(query);
        final Lock lock = rwLock.writeLock();
        try {
            lock.lock();
            // check if the index has been cleared
            checkStore();
            String typeName = query.getTypeName();
            SimpleFeatureStore fs = null;
            try {
                // create a writer that appends this features
                fs = (SimpleFeatureStore) getTileIndexStore().getFeatureSource(typeName);
                final int retVal = fs.getCount(query);
                fs.removeFeatures(query.getFilter());

                return retVal;

            } catch (Throwable e) {
                if (LOGGER.isLoggable(Level.SEVERE))
                    LOGGER.log(Level.SEVERE, e.getLocalizedMessage(), e);
                return -1;
            }
            // do your thing
        } finally {
            lock.unlock();
        }
    }

