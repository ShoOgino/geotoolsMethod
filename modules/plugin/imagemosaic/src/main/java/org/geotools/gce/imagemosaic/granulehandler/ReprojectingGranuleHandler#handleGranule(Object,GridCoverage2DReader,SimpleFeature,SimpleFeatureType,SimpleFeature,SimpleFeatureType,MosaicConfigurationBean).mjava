    @Override
    public void handleGranule(Object source, GridCoverage2DReader inputReader,
            SimpleFeature targetFeature, SimpleFeatureType targetFeatureType,
            SimpleFeature inputFeature, SimpleFeatureType inputFeatureType,
            MosaicConfigurationBean mosaicConfiguration) throws GranuleHandlingException {

        CoordinateReferenceSystem targetCRS = mosaicConfiguration.getCrs();
        if (inputFeature instanceof StructuredGridCoverage2DReader) {
            handleStructuredGranule(source, inputReader, targetFeature, targetFeatureType,
                    inputFeature, inputFeatureType, mosaicConfiguration);
        } else {
            GeneralEnvelope coverageEnvelope = inputReader.getOriginalEnvelope();
            CoordinateReferenceSystem coverageCRS = inputReader.getCoordinateReferenceSystem();
            ReferencedEnvelope finalEnvelope = new ReferencedEnvelope(coverageEnvelope);
            Geometry geometry = null;
            if (!CRS.equalsIgnoreMetadata(targetCRS, coverageCRS)) {
                try {
                    geometry = Utils.reprojectEnvelopeToGeometry(finalEnvelope, targetCRS, null);
                    if(geometry == null) {
                        throw new GranuleHandlingException("Reprojection of source envelope failed, got back a null one " + finalEnvelope);
                    } else if (geometry instanceof GeometryCollection) {
                        // in case of wrapping only pick the first footprint
                        geometry = geometry.getGeometryN(0);
                    }
                } catch (TransformException | FactoryException e) {
                    throw new GranuleHandlingException(
                            "Unable to reproject incoming granule, but target and granule CRS "
                                    + "differ so we can't continue",
                            e);
                }
            } else {
                geometry = JTS.toGeometry(finalEnvelope);
            }

            targetFeature.setAttribute(targetFeatureType.getGeometryDescriptor().getName(), geometry);

        }

    }

