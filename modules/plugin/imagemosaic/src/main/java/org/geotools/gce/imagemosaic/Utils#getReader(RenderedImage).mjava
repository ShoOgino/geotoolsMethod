    /**
     * Scan back the rendered op chain (navigating the sources) 
     * to find an {@link ImageReader} used to read the main source.
     *  
     * @param rOp
     * @return the {@link ImageReader} related to this operation, if any.
     * {@code null} in case no readers are found.
     */
    public static ImageReader getReader(RenderedImage rOp) {
        if (rOp != null) {
            if (rOp instanceof RenderedOp) {
                RenderedOp renderedOp = (RenderedOp) rOp;

                final int nSources = renderedOp.getNumSources();
                if (nSources > 0) {
                    for (int k = 0; k < nSources; k++) {
                        Object source = null;
                        try {
                            source = renderedOp.getSourceObject(k);
                            
                        } catch (ArrayIndexOutOfBoundsException e) {
                            // Ignore
                        }
                        if (source != null) {
                            if (source instanceof RenderedOp) {
                                getReader((RenderedOp) source);
                            }
                        }
                    }
                } else {
                    // get the reader
                    Object imageReader = rOp.getProperty(ImageReadDescriptor.PROPERTY_NAME_IMAGE_READER);
                    if (imageReader != null && imageReader instanceof ImageReader) {
                        final ImageReader reader = (ImageReader) imageReader;
                        return reader;
                    }
                }
            }
        }
        return null;
    }

