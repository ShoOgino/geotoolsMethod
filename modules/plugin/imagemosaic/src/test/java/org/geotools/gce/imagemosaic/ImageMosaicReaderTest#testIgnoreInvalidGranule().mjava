    @Test
    public void testIgnoreInvalidGranule() throws Exception {
        // Get the resources as needed.
        File directory = setupTestDirectory(this, rgbURL, "poisoned");
        URL poisonedURL = fileToUrl(directory);
        final AbstractGridFormat format = TestUtils.getFormat(poisonedURL);
        final ImageMosaicReader reader = getReader(poisonedURL, format);

        GranuleStore granules =
                (GranuleStore) reader.getGranules(reader.getGridCoverageNames()[0], false);
        SimpleFeature first = DataUtilities.first(granules.getGranules(Query.ALL));
        // poison it
        first.setAttribute("location", "global_mosaic_11-invalid.png");
        try (Transaction t = new DefaultTransaction()) {
            granules.setTransaction(t);
            granules.addGranules(DataUtilities.collection(first));
            t.commit();
        }

        // Test the output coverage
        TestUtils.checkCoverage(reader, new GeneralParameterValue[0], "Ignore invalid granule");
    }

