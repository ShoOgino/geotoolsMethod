    @Test
    public void testVirtualNativeResolution() throws IOException, TransformException {
        TemporaryFolder folder = new TemporaryFolder();
        folder.create();
        File file = folder.newFile("sample.tif");
        Files.copy(TestData.file(this, "multiresolution/sample.tif"), file);

        ImageMosaicFormat format = new ImageMosaicFormat();
        ImageMosaicReader reader = format.getReader(folder.getRoot());
        GridEnvelope originalRange = reader.getOriginalGridRange();
        GeneralEnvelope envelope = reader.getOriginalEnvelope();
        MathTransform g2w = reader.getOriginalGridToWorld(PixelInCell.CELL_CORNER);
        AffineTransform2D at = (AffineTransform2D) g2w;

        ParameterValue<double[]> virtualNativeRes =
                ImageMosaicFormat.VIRTUAL_NATIVE_RESOLUTION.createValue();

        // Specifying a lower virtual native resolution
        virtualNativeRes.setValue(new double[] {at.getScaleX() * 16, -at.getScaleY() * 16});

        ParameterValue<GridGeometry2D> pam = AbstractGridFormat.READ_GRIDGEOMETRY2D.createValue();
        pam.setValue(new GridGeometry2D(originalRange, envelope));

        GridCoverage2D gc = reader.read(new ParameterValue<?>[] {virtualNativeRes, pam});
        RenderedImage ri = gc.getRenderedImage();

        // The Virtual Native Resolution resulted into getting back an image with
        // few pixels (Very low resolution)
        assertTrue(ri.getWidth() < 20);
        assertTrue(ri.getHeight() < 20);
        reader.dispose();
    }

