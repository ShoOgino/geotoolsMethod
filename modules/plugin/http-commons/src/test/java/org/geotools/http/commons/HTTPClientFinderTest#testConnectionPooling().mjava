    @Test
    public void testConnectionPooling() throws Exception {
        final int CONN_POOL = 4;
        Hints.putSystemDefault(Hints.HTTP_CLIENT_FACTORY, MultithreadedHttpClientFactory.class);
        try {
            HTTPClient client = HTTPClientFinder.createClient();
            Assert.assertTrue(client instanceof HTTPConnectionPooling);
            ((HTTPConnectionPooling) client).setMaxConnections(CONN_POOL);
            Assert.assertEquals(CONN_POOL, ((HTTPConnectionPooling) client).getMaxConnections());
            Assert.assertTrue(client instanceof MultithreadedHttpClient);
            ((HTTPConnectionPooling) client).close();
        } finally {
            Hints.removeSystemDefault(Hints.HTTP_CLIENT_FACTORY);
        }
    }

