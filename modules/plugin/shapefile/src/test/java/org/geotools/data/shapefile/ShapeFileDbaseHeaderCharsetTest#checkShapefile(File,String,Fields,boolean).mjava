    private void checkShapefile(
            File shpfile, String charsetName, Fields fields, boolean memoryMapped)
            throws IOException {
        ShapefileDataStore dataStore = openShapefileDataStore(shpfile, charsetName, memoryMapped);
        try {
            String typeName = dataStore.getTypeNames()[0];
            FeatureSource<SimpleFeatureType, SimpleFeature> source =
                    dataStore.getFeatureSource(typeName);
            checkFieldNames(fields, source);
            checkFieldValues(fields, source);
        } finally {
            dataStore.dispose();
        }
    }

