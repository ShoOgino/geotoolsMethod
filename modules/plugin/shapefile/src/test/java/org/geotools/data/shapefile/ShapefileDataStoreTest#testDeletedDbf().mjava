    @Test
    public void testDeletedDbf() throws Exception {
        // this shapefile has 4 records that are marked as deleted only inside the dbf, but 
        // not in the headers
        URL u = TestData.url(TestCaseSupport.class, "deleted/archsites.dbf");
        File shpFile = URLs.urlToFile(u);
        
        ShapefileDataStore store = new ShapefileDataStore(URLs.fileToUrl(shpFile));
        ContentFeatureSource fs = store.getFeatureSource();
        // this one reads the shp header, which still contains trace of all records
        assertEquals(25, fs.getCount(Query.ALL));
        // now read manually and check we skip the records with the dbf entry marked as deleted
        SimpleFeatureIterator fi = fs.getFeatures().features();
        int count = 0;
        while(fi.hasNext()) {
            fi.next();
            count++;
        }
        fi.close();
        assertEquals(21, count);
    }

