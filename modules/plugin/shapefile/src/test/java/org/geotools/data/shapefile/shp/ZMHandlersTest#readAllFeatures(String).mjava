    /**
     * Checks we can read all the features in the given shapefile as regular (3D) geometry.
     *
     * @returns the total number of features read
     */
    private int readAllFeatures(String filename) throws IOException {
        int numFeatures = 0;
        URL url = TestData.url(ShapefileDataStore.class, filename);
        ShapefileDataStore store = new ShapefileDataStore(url);
        Query q = new Query(store.getTypeNames()[0]);
        try (FeatureReader<SimpleFeatureType, SimpleFeature> reader =
                store.getFeatureReader(q, Transaction.AUTO_COMMIT)) {
            while (reader.hasNext()) {
                SimpleFeature f = reader.next();
                assertNotNull(f.getDefaultGeometry());
                numFeatures++;
            }
            return numFeatures;
        }
    }

