    @Test
    public void testWriteNulls() throws Exception {
        File tempShape = getTempFile();
        ShapefileDataStore store = new ShapefileDataStore(tempShape.toURI().toURL());
        store.createSchema(schema);

        // write out the features
        SimpleFeatureStore fs = (SimpleFeatureStore) store.getFeatureSource();
        fs.addFeatures(collection);

        // read it back
        SimpleFeature[] readfc = (SimpleFeature[]) fs.getFeatures().toArray(new SimpleFeature[0]);
        assertEquals(features.length, readfc.length);

        // check the first geometry
        Geometry read = (Geometry) features[0].getDefaultGeometry();
        assertNull(read);

        Geometry orig = (Geometry) features[1].getDefaultGeometry();
        read = (Geometry) features[1].getDefaultGeometry();
        assertTrue(orig.equalsTopo(read));

        // check the null geometry
        read = (Geometry) features[2].getDefaultGeometry();
        assertNull(read);

        // make sure the third is ok as well
        orig = (Geometry) features[3].getDefaultGeometry();
        read = (Geometry) features[3].getDefaultGeometry();
        assertTrue(orig.equalsTopo(read));

        store.dispose();
    }

