    @Test
    public void testVeryLongStrings() throws Exception {
        // formatter.setFieldString will truncate input to the desired size. But it should do this
        // in a reasonably performant manner.
        DbaseFileWriter.FieldFormatter formatter =
                new DbaseFileWriter.FieldFormatter(
                        StandardCharsets.UTF_8, TimeZone.getDefault(), false);

        // build up a very large input string. The test string is also formed so that the 8th char
        // is also multibyte
        String test =
                IntStream.range(0, 100000)
                        .mapToObj(i -> "\u0412A cat\u0412jumped over the dog")
                        .collect(Collectors.joining(","));

        String formattedString = formatter.getFieldString(8, test);
        assertEquals("\u0412A cat ", formattedString);
        assertEquals(8, formattedString.getBytes().length);
    }

