    private void createShapefile(File shpfile, String charsetName, Fields fields) throws Exception {
        String attributeDefinitionString = buildAttributeDefinitionString(fields);
        SimpleFeatureType featureType =
                DataUtilities.createType("Location", attributeDefinitionString);

        List<SimpleFeature> features = buildFeatures(fields, featureType);

        ShapefileDataStore newDataStore = createShapefileDataStore(shpfile, charsetName);
        try {
            writeFeatures(newDataStore, features, featureType);
        } finally {
            newDataStore.dispose();
        }
    }

