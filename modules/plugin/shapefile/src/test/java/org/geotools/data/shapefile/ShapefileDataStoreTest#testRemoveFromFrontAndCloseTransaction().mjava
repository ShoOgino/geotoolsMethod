    /**
     * Create a test file, then continue removing the first entry until there are no features left.
     */
    @Test
    public void testRemoveFromFrontAndCloseTransaction() throws Throwable {
        ShapefileDataStore sds = createDataStore();

        int idx = loadFeatures(sds).size();

        while (idx > 0) {
            try (Transaction t = new DefaultTransaction();
                    FeatureWriter<SimpleFeatureType, SimpleFeature> writer =
                            sds.getFeatureWriter(sds.getTypeNames()[0], Filter.INCLUDE, t)) {
                writer.next();
                writer.remove();
                t.commit();
            }
            assertEquals(--idx, loadFeatures(sds).size());
        }
        sds.dispose();
    }

