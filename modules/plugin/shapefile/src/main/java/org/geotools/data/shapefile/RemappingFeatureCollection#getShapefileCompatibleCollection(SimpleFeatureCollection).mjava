    /**
     * Returns a shapefile compatible collection, that is, geometry field is always named the_geom and field names have a max length of 10.
     * Will return the original collection if already compatible
     * 
     * @param fc
     * @return
     */
    public static SimpleFeatureCollection getShapefileCompatibleCollection(
            SimpleFeatureCollection fc) {
        Map<String, String> attributeMappings = createAttributeMappings(fc.getSchema());
        
        // check if the remapping is actually needed
        for (Entry<String, String> entry : attributeMappings.entrySet()) {
            if(!entry.getKey().equals(entry.getValue())) {
                return new RemappingFeatureCollection(fc, attributeMappings);
            }
        }
        
        // return the original collection otherwise
        return fc;
    }

