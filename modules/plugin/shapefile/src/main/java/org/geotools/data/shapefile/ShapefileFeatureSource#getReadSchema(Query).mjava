    SimpleFeatureType getReadSchema(Query q) {
        if (q.getPropertyNames() == Query.ALL_NAMES) {
            return getSchema();
        }
        // Step 1: start with requested property names 
        LinkedHashSet<String> attributes = new LinkedHashSet<String>();
        attributes.addAll(Arrays.asList(q.getPropertyNames()));
        
        Filter filter = q.getFilter();
        if(filter != null && !Filter.INCLUDE.equals(filter)) {
            // Step 2: Add query attributes (if needed)
            // Step 3: Fill empty XPath with appropriate property names
            FilterAttributeExtractor fat = new AbsoluteAttributeExtractor(getSchema());
            filter.accept(fat, null);
            attributes.addAll(fat.getAttributeNameSet());
        }
        return SimpleFeatureTypeBuilder.retype(getSchema(), new ArrayList<String>(attributes));
    }

