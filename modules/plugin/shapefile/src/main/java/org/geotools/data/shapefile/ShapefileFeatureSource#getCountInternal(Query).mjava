    @Override
    protected int getCountInternal(Query query) throws IOException {
        if (query.getFilter() == Filter.INCLUDE) {
            try (IndexFile file = getDataStore().shpManager.openIndexFile()) {
                if (file != null) {
                    return file.getRecordCount();
                }
            }

            // no Index file so use the number of shapefile records
            int count = -1;
            try (ShapefileReader reader =
                    getDataStore().shpManager.openShapeReader(new GeometryFactory(), false)) {
                count = reader.getCount(count);
            } catch (IOException e) {
                throw e;
            }

            return count;
        }

        return -1;
    }

