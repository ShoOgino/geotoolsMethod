    SimpleFeature buildFeature(int number, Geometry geometry, Row row, Envelope envelope)
            throws IOException {
        if (dbfindexes != null) {
            for (int i = 0; i < dbfindexes.length; i++) {
                if (dbfindexes[i] == -1) {
                    builder.add(geometry);
                } else {
                    builder.add(row.read(dbfindexes[i]));
                }
            }
        } else if(geometry != null) {
            builder.add(geometry);
        }
        // build the feature id
        String featureId = buildFeatureId(number);
        SimpleFeature feature = builder.buildFeature(featureId);
        if (filter != null) {
            // if we should not return the feature, just drop it and continue reading
            if (!filter.evaluate(feature)) {
                return null;
            }
        }

        // update screenmap if present, now that we have the certainty
        // that the record is to be returned and will be displayed
        if (screenMap != null) {
            // we are going to keep the feature, if we have the screenmap do update
            // it (if we got here, we already checked the screenmap was not busy)
            try {
                screenMap.checkAndSet(envelope);
            } catch (TransformException e) {
                if (LOGGER.isLoggable(Level.FINE)) {
                    LOGGER.log(Level.FINE, "Failed to set screenmap", e);
                }
            }
        }

        return feature;
    }

