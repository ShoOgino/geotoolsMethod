    /** Drain internal buffers into underlying channels. */
    private void drain() throws IOException {
        writeBuffer.flip();

        int written = 0;

        while (writeBuffer.remaining() > 0) written += channel.write(writeBuffer, position);

        position += written;

        writeBuffer.flip().limit(writeBuffer.capacity());
    }

