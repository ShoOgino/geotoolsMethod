    @Override
    protected ReferencedEnvelope getBoundsInternal(Query query) throws IOException {
        if (query.getFilter() != Filter.INCLUDE) {
            return null;
        }

        ByteBuffer buffer = ByteBuffer.allocate(100);
        FileReader reader = () -> "Shapefile Datastore's getBounds Method";
        try (ReadableByteChannel in = shpFiles.getReadChannel(SHP, reader)) {
            in.read(buffer);
            buffer.flip();

            ShapefileHeader header = new ShapefileHeader();
            header.read(buffer, true);

            SimpleFeatureType schema = getSchema();

            Envelope env;

            // If it is a shapefile without any data (file length equals 50), return an empty
            // envelope as expected
            if (header.getFileLength() == 50) {
                env = new Envelope();
            } else {
                env = new Envelope(header.minX(), header.maxX(), header.minY(), header.maxY());
            }

            CoordinateReferenceSystem crs = null;
            if (schema != null) {
                crs = schema.getCoordinateReferenceSystem();
            }
            return new ReferencedEnvelope(env, crs);
        } catch (IOException ioe) {
            throw new DataSourceException("Problem getting Bbox", ioe);
        }
    }

