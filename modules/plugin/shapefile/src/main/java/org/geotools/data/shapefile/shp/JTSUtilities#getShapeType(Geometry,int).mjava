    /**
     * Determine the best ShapeType for a geometry with the given dimension.
     *
     * @param geom The Geometry to examine.
     * @param shapeFileDimentions The dimension 2,3 or 4.
     * @throws ShapefileException If theres a problem, like a bogus Geometry.
     * @return The best ShapeType.
     */
    public static final ShapeType getShapeType(Geometry geom, int shapeFileDimentions)
            throws ShapefileException {

        ShapeType type = null;

        if (geom instanceof Point) {
            switch (shapeFileDimentions) {
                case 2:
                    type = ShapeType.POINT;
                    break;
                case 3:
                    type = ShapeType.POINTM;
                    break;
                case 4:
                    type = ShapeType.POINTZ;
                    break;
                default:
                    throw new ShapefileException(
                            "Too many dimensions for shapefile : " + shapeFileDimentions);
            }
        } else if (geom instanceof MultiPoint) {
            switch (shapeFileDimentions) {
                case 2:
                    type = ShapeType.MULTIPOINT;
                    break;
                case 3:
                    type = ShapeType.MULTIPOINTM;
                    break;
                case 4:
                    type = ShapeType.MULTIPOINTZ;
                    break;
                default:
                    throw new ShapefileException(
                            "Too many dimensions for shapefile : " + shapeFileDimentions);
            }
        } else if ((geom instanceof Polygon) || (geom instanceof MultiPolygon)) {
            switch (shapeFileDimentions) {
                case 2:
                    type = ShapeType.POLYGON;
                    break;
                case 3:
                    type = ShapeType.POLYGONM;
                    break;
                case 4:
                    type = ShapeType.POLYGONZ;
                    break;
                default:
                    throw new ShapefileException(
                            "Too many dimensions for shapefile : " + shapeFileDimentions);
            }
        } else if ((geom instanceof LineString) || (geom instanceof MultiLineString)) {
            switch (shapeFileDimentions) {
                case 2:
                    type = ShapeType.ARC;
                    break;
                case 3:
                    type = ShapeType.ARCM;
                    break;
                case 4:
                    type = ShapeType.ARCZ;
                    break;
                default:
                    throw new ShapefileException(
                            "Too many dimensions for shapefile : " + shapeFileDimentions);
            }
        }

        if (type == null) {
            throw new ShapefileException(
                    "Cannot handle geometry type : "
                            + (geom == null ? "null" : geom.getClass().getName()));
        }
        return type;
    }

