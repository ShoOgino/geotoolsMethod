    public SimpleFeatureCollection getFeatures(Query query) throws IOException {

        SimpleFeatureSource fs = getFeatureSourceFor(query);
        Query newQuery = getProxyObject(query, fs);
        Generalization di = info.getGeneralizationForDistance(getRequestedDistance(query));
        if (di != null) logDistanceInfo(di);
        return new PreGeneralizedFeatureCollection(
                fs.getFeatures(newQuery),
                getSchema(),
                getReturnedSchema(getSchema(), query),
                query.getPropertyNames() == Query.ALL_NAMES
                        ? indexMapping.get(di == null ? 0.0 : di.getDistance())
                        : null,
                info.getGeomPropertyName(),
                getBackendGeometryName(fs));
    }

