    public FeatureReader<SimpleFeatureType, SimpleFeature> getFeatureReader(
            Query query, Transaction transaction) throws IOException {

        SimpleFeatureSource fs = getFeatureSourceFor(query);
        Query newQuery = getProxyObject(query, fs);
        DataAccess<SimpleFeatureType, SimpleFeature> access = fs.getDataStore();
        if (access instanceof DataStore) {
            String backendGeometryPropertyName = getBackendGeometryName(fs);

            Generalization di = info.getGeneralizationForDistance(getRequestedDistance(query));
            if (di != null) logDistanceInfo(di);

            return new PreGeneralizedFeatureReader(
                    getSchema(),
                    getReturnedSchema(getSchema(), query),
                    indexMapping.get(di == null ? 0.0 : di.getDistance()),
                    ((DataStore) access).getFeatureReader(newQuery, transaction),
                    info.getGeomPropertyName(),
                    backendGeometryPropertyName);
        }
        return null;
    }

