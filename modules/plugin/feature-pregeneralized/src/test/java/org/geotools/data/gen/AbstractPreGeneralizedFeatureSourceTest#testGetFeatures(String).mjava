    protected void testGetFeatures(String configName) {

        try {
            PreGeneralizedDataStore ds = getDataStore(configName);

            SimpleFeatureSource fs = ds.getFeatureSource("GenStreams");
            Assert.assertTrue(fs.getSupportedHints().contains(Hints.GEOMETRY_DISTANCE));

            Filter filter = CQL.toFilter("CAT_ID = 2");

            Query[] queries = new Query[2];
            queries[0] = new Query("GenStreams");
            queries[1] = new Query("GenStreams", filter, new String[] {"the_geom", "CAT_ID"});

            for (Query q : queries) {

                q.getHints().put(Hints.GEOMETRY_DISTANCE, 1.0);
                SimpleFeatureCollection fCollection = fs.getFeatures(q);
                String typeName = fCollection.getSchema().getTypeName();
                Assert.assertEquals("GenStreams", typeName);
                Assert.assertEquals(
                        "the_geom", fCollection.getSchema().getGeometryDescriptor().getLocalName());
                SimpleFeatureIterator iterator = fCollection.features();
                try {
                    while (iterator.hasNext()) {
                        SimpleFeature f = iterator.next();
                        checkPoints(f, 0.0);
                    }
                } finally {
                    iterator.close();
                }

                q.getHints().put(Hints.GEOMETRY_DISTANCE, 5.0);
                fCollection = fs.getFeatures(q);
                typeName = fCollection.getSchema().getTypeName();
                Assert.assertEquals("GenStreams", typeName);
                Assert.assertEquals(
                        "the_geom", fCollection.getSchema().getGeometryDescriptor().getLocalName());
                iterator = fCollection.features();
                try {
                    while (iterator.hasNext()) {
                        SimpleFeature f = iterator.next();
                        checkPoints(f, 5.0);
                    }
                } finally {
                    iterator.close();
                }

                q.getHints().put(Hints.GEOMETRY_DISTANCE, 10.0);
                fCollection = fs.getFeatures(q);
                typeName = fCollection.getSchema().getTypeName();
                Assert.assertEquals("GenStreams", typeName);
                Assert.assertEquals(
                        "the_geom", fCollection.getSchema().getGeometryDescriptor().getLocalName());
                iterator = fCollection.features();
                try {
                    while (iterator.hasNext()) {
                        SimpleFeature f = iterator.next();
                        checkPoints(f, 10.0);
                    }
                } finally {
                    iterator.close();
                }

                q.getHints().put(Hints.GEOMETRY_DISTANCE, 20.0);
                fCollection = fs.getFeatures(q);
                typeName = fCollection.getSchema().getTypeName();
                Assert.assertEquals("GenStreams", typeName);
                Assert.assertEquals(
                        "the_geom", fCollection.getSchema().getGeometryDescriptor().getLocalName());
                iterator = fCollection.features();
                try {
                    while (iterator.hasNext()) {
                        SimpleFeature f = iterator.next();
                        checkPoints(f, 20.0);
                    }
                } finally {
                    iterator.close();
                }
                q.getHints().put(Hints.GEOMETRY_DISTANCE, 50.0);
                fCollection = fs.getFeatures(q);
                typeName = fCollection.getSchema().getTypeName();
                Assert.assertEquals("GenStreams", typeName);
                Assert.assertEquals(
                        "the_geom", fCollection.getSchema().getGeometryDescriptor().getLocalName());
                iterator = fCollection.features();
                try {
                    while (iterator.hasNext()) {
                        SimpleFeature f = iterator.next();
                        checkPoints(f, 0.0);
                    }
                } finally {
                    iterator.close();
                }
            }
        } catch (Exception ex) {
            Assert.fail(ex.getMessage());
        }
    }

