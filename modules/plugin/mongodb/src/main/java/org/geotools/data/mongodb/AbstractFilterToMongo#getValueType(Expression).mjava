    protected Class<?> getValueType(Expression e) {

        Class<?> ret = getValueTypeInternal(e);
        if (ret == null && e instanceof Function)
            // get the value type from the function return type
            ret = getFunctionReturnType((Function) e);
        return ret;
    }

