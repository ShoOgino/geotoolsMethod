    /**
     * Truncates (removes all the features in) the ArcSDE table named <code>typeName</code> by using
     * an SeTable with the provided <code>connection</code>. This means if the connection has a
     * transaction in progress, the truncation takes effect upon commit, otherwise it takes effect
     * immediately.
     *
     * @param typeName
     * @param session
     * @throws DataSourceException
     */
    private void truncate(final String typeName, final ISession session) throws IOException {
        final boolean transactionInProgress = session.isTransactionActive();
        final SeTable table = session.getTable(typeName);
        if (transactionInProgress) {
            // need to do actual deletes, as SeTable.truncate does not respects
            // transactions and would delete all content
            LOGGER.fine("deleting all table records for " + typeName);
            final FeatureWriter<SimpleFeatureType, SimpleFeature> writer =
                    dataStore.getFeatureWriter(typeName, transaction);
            while (writer.hasNext()) {
                writer.next();
                writer.remove();
            }
        } else {
            // we're in auto commit mode, lets truncate the table the fast way
            LOGGER.fine("truncating table " + typeName);
            session.issue(
                    new Command<Void>() {
                        @Override
                        public Void execute(ISession session, SeConnection connection)
                                throws SeException, IOException {
                            table.truncate();
                            return null;
                        }
                    });
        }
    }

