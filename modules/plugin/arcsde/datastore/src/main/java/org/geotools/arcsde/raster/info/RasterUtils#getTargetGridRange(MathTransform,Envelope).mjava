    private static GridEnvelope getTargetGridRange(
            final MathTransform modelToRaster, final Envelope requestedEnvelope) {
        GridEnvelope levelOverlappingPixels;
        int levelMinPixelX;
        int levelMaxPixelX;
        int levelMinPixelY;
        int levelMaxPixelY;
        {
            // use a model to raster transform to find out which pixel range at the specified level
            // better match the requested extent
            GeneralEnvelope requestedPixels;
            try {
                requestedPixels = CRS.transform(modelToRaster, requestedEnvelope);
            } catch (NoninvertibleTransformException e) {
                throw new IllegalArgumentException(e);
            } catch (TransformException e) {
                throw new IllegalArgumentException(e);
            }

            levelMinPixelX = (int) Math.floor(requestedPixels.getMinimum(0));
            levelMinPixelY = (int) Math.floor(requestedPixels.getMinimum(1));

            levelMaxPixelX = (int) Math.ceil(requestedPixels.getMaximum(0));
            levelMaxPixelY = (int) Math.ceil(requestedPixels.getMaximum(1));

            final int width = levelMaxPixelX - levelMinPixelX;
            final int height = levelMaxPixelY - levelMinPixelY;
            levelOverlappingPixels =
                    new GridEnvelope2D(levelMinPixelX, levelMinPixelY, width, height);
        }
        return levelOverlappingPixels;
    }

