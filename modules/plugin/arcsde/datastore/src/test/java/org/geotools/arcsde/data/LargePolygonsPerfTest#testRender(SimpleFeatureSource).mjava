    private void testRender(SimpleFeatureSource featureSource) throws Exception {
        SimpleFeatureType schema = featureSource.getSchema();
        ReferencedEnvelope bounds = featureSource.getBounds();

        MapContent content = new MapContent();
        Style style = new BasicPolygonStyle();
        content.addLayer(new FeatureLayer(featureSource, style));
        content.getViewport().setBounds(bounds);
        StreamingRenderer renderer = new StreamingRenderer();
        renderer.setMapContent(content);

        BufferedImage image = new BufferedImage(800, 600, BufferedImage.TYPE_INT_ARGB);
        Graphics2D graphics = image.createGraphics();
        Rectangle paintArea = new Rectangle(800, 600);
        ReferencedEnvelope mapArea = bounds;
        Stopwatch sw = new Stopwatch();
        long totalTime = 0;
        for (int i = 0; i < numRuns; i++) {
            sw.start();
            renderer.paint(graphics, paintArea, mapArea);
            sw.stop();
            totalTime += sw.getTime();
            log("Layer rendered in " + sw.getTimeString());
            sw.reset();
            File output = new File("testRender.png");
            log("writing rendered image to " + output.getAbsolutePath());
            ImageIO.write(image, "png", output);
        }
        log(
                "-- Average rendering time after "
                        + numRuns
                        + " runs: "
                        + ((totalTime / numRuns) / 1000)
                        + "s");
    }

