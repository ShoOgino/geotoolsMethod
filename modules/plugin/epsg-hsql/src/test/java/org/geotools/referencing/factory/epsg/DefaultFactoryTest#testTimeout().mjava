    /**
     * Tests closing the factory after the timeout. <strong>IMPORTANT:</strong> This test must be
     * run after {@link #testCreation} and before any call to {@code getAuthorityCodes()}.
     *
     * @throws FactoryException if an error occured while querying the factory.
     */
    @Test
    public void testTimeout() throws FactoryException {
        System.gc(); // If there is any object holding a connection to the EPSG
        System.runFinalization(); // database, running finalizers may help to close them.
        // Fetch this CRS first in order to prevent garbage collection.
        CoordinateReferenceSystem crs = factory.createCoordinateReferenceSystem("4273");
        assertEquals("4273", getIdentifier(crs));
        factory.setTimeout(200);
        try {
            assertTrue(factory.isConnected());
            Thread.sleep(800);
            System.gc();
            System.runFinalization();
            Thread.sleep(200);
            System.gc();
            System.runFinalization();
            assertFalse(factory.isConnected());
        } catch (InterruptedException e) {
            fail(e.getLocalizedMessage());
        }
        assertFalse(factory.isConnected());
        // Should be in the cache.
        assertSame(crs, factory.createCoordinateReferenceSystem("4273"));
        assertFalse(factory.isConnected());
        // Was not in the cache
        assertEquals("4275", getIdentifier(factory.createCoordinateReferenceSystem("4275")));
        assertTrue(factory.isConnected());
        factory.setTimeout(30 * 60 * 1000L);
    }

