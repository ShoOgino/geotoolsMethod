    private ImageInputStream getImageInputStream() throws IOException {
        if (inStream instanceof ImageInputStream && !closeMe) {
            return inStream;
        } else if (inStreamSPI == null) {
            return ImageIO.createImageInputStream(source);
        } else if (inStreamSPI instanceof CogImageInputStreamSpi) {
            return ((CogSourceSPIProvider) source).getStream();
        } else {
            return inStreamSPI.createInputStreamInstance(
                    source, ImageIO.getUseCache(), ImageIO.getCacheDirectory());
        }
    }

