    @Test
    public void testWriteNoData() throws Exception {

        // Input geotiff including noData information
        final File input = TestData.file(GeoTiffReaderTest.class, "nodata.tiff");
        final double noDataValue = -9999;

        // reading the coverage, checking it has nodata
        GeoTiffReader reader = new GeoTiffReader(input);
        GridCoverage2D coverage = (GridCoverage2D) reader.read(null);
        Map props = coverage.getProperties();

        assertTrue(props.containsKey(NoDataContainer.GC_NODATA));
        NoDataContainer nodata = (NoDataContainer) props.get(NoDataContainer.GC_NODATA);
        assertEquals(noDataValue, nodata.getAsSingleValue(), 1e-6);
        reader.dispose();

        // Writing it, including noData
        writeAndRead(coverage, Boolean.TRUE, noDataValue);

        // Writing it again, excluding noData this time
        writeAndRead(coverage, Boolean.FALSE, noDataValue);

        // Writing it one more time, this time with no parameter being specified
        // but using the default value being set by system properties
        setFinalStaticField("DEFAULT_WRITE_NODATA", false);
        writeAndRead(coverage, null, noDataValue);
        setFinalStaticField("DEFAULT_WRITE_NODATA", true);
    }

