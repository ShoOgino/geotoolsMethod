    @Test
    public void testRescaleWithNodataFloat() throws IOException {
        GridCoverage2DReader reader =
                new GeoTiffReader(TestData.file(GeoTiffReaderTest.class, "float32_nodata.tif"));
        GridCoverage2D coverage = null;
        double[] redBackground = {255, 0, 0};
        try {
            coverage = reader.read(null);
            ImageWorker iw = new ImageWorker(coverage.getRenderedImage());

            RenderedImage output =
                    iw.scale(64, 64, 0, 0, Interpolation.getInstance(Interpolation.INTERP_NEAREST))
                            .rescaleToBytes()
                            .bandMerge(3)
                            .forceComponentColorModel()
                            .forceColorSpaceRGB()
                            .getRenderedImage();
            output =
                    new ImageWorker(output)
                            .setBackground(redBackground)
                            .mosaic(
                                    new RenderedImage[] {output},
                                    MosaicDescriptor.MOSAIC_TYPE_OVERLAY,
                                    null,
                                    null,
                                    null,
                                    null)
                            .getRenderedImage();

            Raster data = output.getData();
            final int w = data.getWidth();
            final int h = data.getHeight();

            // Before the fix, all the samples were simply either 0,0,0 or 1,1,1
            checkPixel(data, 0, 0, gray(1));
            checkPixel(data, w - 1, 0, gray(43));
            checkPixel(data, w / 2, h / 2, gray(85));
            checkPixel(data, w - 1, h - 1, gray(255));
            checkPixel(data, 0, h - 1, Color.RED);
        } finally {
            if (coverage != null) {
                ImageUtilities.disposeImage(coverage.getRenderedImage());
                coverage.dispose(true);
            }
        }
    }

