    @Test
    public void testScaleOffset() throws IllegalArgumentException, IOException, FactoryException {
        // prepare reader
        final File scaleOffset = TestData.file(GeoTiffReaderTest.class, "scaleOffset.tif");
        GeoTiffReader reader = new GeoTiffReader(scaleOffset);

        // read with explicit request not to rescale
        GridCoverage2D coverage = null;
        try {
            ParameterValue<Boolean> rescalePixels = AbstractGridFormat.RESCALE_PIXELS.createValue();
            rescalePixels.setValue(false);
            coverage = reader.read(new GeneralParameterValue[] {rescalePixels});
            ImageWorker iw = new ImageWorker(coverage.getRenderedImage());
            double[] maximums = iw.getMaximums();
            // the max is 255
            assertArrayEquals(new double[] {6020, 6020, 6020, 1, 0, 10000}, maximums, 0d);
        } finally {
            if (coverage != null) {
                ImageUtilities.disposeImage(coverage.getRenderedImage());
                coverage.dispose(true);
            }
        }

        // do the same with rescaling
        try {
            ParameterValue<Boolean> rescalePixels = AbstractGridFormat.RESCALE_PIXELS.createValue();
            rescalePixels.setValue(true);
            coverage = reader.read(new GeneralParameterValue[] {rescalePixels});
            ImageWorker iw = new ImageWorker(coverage.getRenderedImage());
            double[] maximums = iw.getMaximums();
            // the max is 255
            assertArrayEquals(new double[] {0.602, 0.602, 0.602, 0.0001, 0, 1}, maximums, 0d);
        } finally {
            if (coverage != null) {
                ImageUtilities.disposeImage(coverage.getRenderedImage());
                coverage.dispose(true);
            }
        }
    }

