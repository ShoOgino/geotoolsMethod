    @Test
    public void testMetadataReferences() throws Exception {
        // create a geopacakge from a shapefile
        ShapefileDataStore shp = new ShapefileDataStore(setUpShapefile());
        FeatureEntry entry = new FeatureEntry();
        geopkg.add(entry, shp.getFeatureSource(), null);
        assertTableExists("bugsites");

        // grab the metadata extension and add a couple of metadata entries
        GeoPkgMetadataExtension ext = geopkg.getExtension(GeoPkgMetadataExtension.class);
        GeoPkgMetadata metadata =
                new GeoPkgMetadata(
                        GeoPkgMetadata.Scope.Dataset,
                        "http://geotools.org/geopackage",
                        "application/json",
                        "{ \"metadata\" : \"on\"");
        ext.addMetadata(metadata);
        GeoPkgMetadata parentMetadata =
                new GeoPkgMetadata(
                        GeoPkgMetadata.Scope.Dataset,
                        "http://geotools.org/geopackage",
                        "application/json",
                        "{ \"metadata\" : \"theBoss\"");
        ext.addMetadata(parentMetadata);

        // create references
        GeoPkgMetadataReference reference =
                new GeoPkgMetadataReference(
                        GeoPkgMetadataReference.Scope.Table,
                        "bugsites",
                        null,
                        null,
                        new Date(),
                        metadata,
                        parentMetadata);
        ext.addReference(reference);
        List<GeoPkgMetadataReference> references = ext.getReferences(metadata);
        assertEquals(1, references.size());
        GeoPkgMetadataReference readReference = references.get(0);
        assertEquals(reference, readReference);

        // update references
        reference.setColumn("cat");
        ext.updateReference(reference);
        GeoPkgMetadataReference updatedReference = ext.getReferences(metadata).get(0);
        assertEquals(reference, updatedReference);

        // clean up
        ext.removeReference(reference);
        assertEquals(0, ext.getReferences(metadata).size());
    }

