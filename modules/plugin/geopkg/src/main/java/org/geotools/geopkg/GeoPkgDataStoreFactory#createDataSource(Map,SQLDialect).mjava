    @Override
    protected DataSource createDataSource(Map params, SQLDialect dialect) throws IOException {
        SQLiteConfig config = new SQLiteConfig();
        config.setSharedCache(true);
        config.enableLoadExtension(true);
        String password = (String) PASSWD.lookUp(params);
        // support for encrypted databases has been ddded after 3.20.1, we'll have to
        // wait for a future release of sqlite-jdbc
        // if(password != null) {
        //     config.setPragma(SQLiteConfig.Pragma.PASSWORD, password);
        // }
        // TODO: add this and make configurable once we upgrade to a sqlitejdbc exposing mmap_size
        // config.setPragma(SQLiteConfig.Pragma.MMAP_SIZE, String.valueOf(1024 * 1024 * 1000));

        // use native "pool", which is actually not pooling anything (that's fast and
        // has less scalability overhead)
        SQLiteConnectionPoolDataSource ds = new SQLiteConnectionPoolDataSource(config);
        ds.setUrl(getJDBCUrl(params));

        return ds;
    }

