    /** Tests automatic building of all the mosaic and pyramid files */
    @Test
    public void testAutomaticBuild() throws IOException {
        final URL testFile = TestData.getResource(this, "goodpyramid/" + TEST_FILE);
        File sourceDir = URLs.urlToFile(testFile).getParentFile();
        File targetDir = File.createTempFile("pyramid", "tst", TestData.file(this, "."));
        targetDir.delete();
        targetDir.mkdir();
        try {
            prepareEmptyMosaic(sourceDir, targetDir);

            // now make sure we can actually rebuild the mosaic
            final AbstractGridFormat format = new ImagePyramidFormat();
            final Hints hints =
                    new Hints(
                            Hints.DEFAULT_COORDINATE_REFERENCE_SYSTEM, DefaultGeographicCRS.WGS84);
            assertTrue(((ImagePyramidFormat) format).accepts(targetDir, hints));
            final ImagePyramidReader reader =
                    (ImagePyramidReader) format.getReader(targetDir, hints);
            assertNotNull(reader);
        } finally {
            // cleanup
            FileUtils.deleteQuietly(targetDir);
        }
    }

