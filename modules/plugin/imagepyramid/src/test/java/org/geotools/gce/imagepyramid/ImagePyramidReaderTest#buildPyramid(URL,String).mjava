    /** */
    private void buildPyramid(final URL testFile, String targetName)
            throws IOException, FileNotFoundException {
        File sourceDir = URLs.urlToFile(testFile).getParentFile();
        File targetDir = File.createTempFile(targetName, "tst", TestData.file(this, "."));
        targetDir.delete();
        targetDir.mkdir();

        try {
            prepareEmptyMosaic(sourceDir, targetDir);

            // move the files so that it looks like a gdal_retile created directory
            File zeroDir = new File(targetDir, "0");
            assertTrue(zeroDir.isDirectory());
            FileUtils.copyDirectory(zeroDir, targetDir);
            FileUtils.deleteDirectory(zeroDir);

            // now make sure we can actually rebuild the mosaic
            final AbstractGridFormat format = new ImagePyramidFormat();
            final Hints hints =
                    new Hints(
                            Hints.DEFAULT_COORDINATE_REFERENCE_SYSTEM, DefaultGeographicCRS.WGS84);
            assertTrue(format.accepts(targetDir, hints));
            final ImagePyramidReader reader =
                    (ImagePyramidReader) format.getReader(targetDir, hints);
            assertNotNull(reader);
        } finally {
            // cleanup
            FileUtils.deleteQuietly(targetDir);
        }
    }

