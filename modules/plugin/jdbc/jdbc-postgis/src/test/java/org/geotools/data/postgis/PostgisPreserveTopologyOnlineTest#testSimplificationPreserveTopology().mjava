    /** Test PostGIS simplified geometries with topology preservation (GEOT-6663) */
    public void testSimplificationPreserveTopology() throws Exception {
        SimpleFeatureSource fs = dataStore.getFeatureSource(tname("simplify_polygon_topology"));

        if (fs.getSupportedHints().contains(Hints.GEOMETRY_SIMPLIFICATION) == false) return;

        Query query = new Query();
        Hints hints = new Hints(Hints.GEOMETRY_SIMPLIFICATION, 1.5);
        query.setHints(hints);

        SimpleFeatureCollection fColl = fs.getFeatures(query);
        Geometry simplified = null;
        try (SimpleFeatureIterator iterator = fColl.features()) {
            if (iterator.hasNext()) simplified = (Geometry) iterator.next().getDefaultGeometry();
        }

        // PostGIS 2.2+ should use ST_Simplify's preserveCollapsed flag
        assertNotNull("Simplified geometry is null", simplified);
        assertTrue(simplified instanceof Polygon);
        assertEquals(1, ((Polygon) simplified).getNumInteriorRing());
    }

