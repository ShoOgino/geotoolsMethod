    /**
     * Test for GEOS-5167. Checks that geometries are wrapped with ST_Envelope when used with
     * overlapping operator, when the encodeBBOXFilterAsEnvelope is true.
     *
     * @throws FilterToSQLException
     */
    @Test
    public void testEncodeBBOXFilterAsEnvelopeEnabled() throws FilterToSQLException {
        filterToSql.setEncodeBBOXFilterAsEnvelope(true);
        filterToSql.setFeatureType(testSchema);

        Intersects filter =
                ff.intersects(
                        ff.property("testGeometry"),
                        ff.literal(
                                gf.createPolygon(
                                        gf.createLinearRing(
                                                new Coordinate[] {
                                                    new Coordinate(0, 0),
                                                    new Coordinate(0, 2),
                                                    new Coordinate(2, 2),
                                                    new Coordinate(2, 0),
                                                    new Coordinate(0, 0)
                                                }))));
        filterToSql.encode(filter);
        assertTrue(writer.toString().toLowerCase().contains("st_envelope"));
    }

