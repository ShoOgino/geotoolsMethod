    private Class getExpressionTypeIncludingLiterals(Expression expression) {
        Class result = super.getExpressionType(expression);
        if (expression instanceof Literal) {
            result = ((Literal) expression).getValue().getClass();
        }
        return result;
    }

