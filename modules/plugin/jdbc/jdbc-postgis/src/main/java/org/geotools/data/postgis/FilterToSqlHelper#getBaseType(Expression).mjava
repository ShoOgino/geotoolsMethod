    private Class<?> getBaseType(Expression expr) {
        Class<?> type = delegate.getExpressionType(expr);
        if (type == null && expr instanceof Literal) {
            Object value = delegate.evaluateLiteral((Literal) expr, Object.class);
            if (value != null) {
                type = value.getClass();
            }
        }
        if (isArray(type)) {
            type = type.getComponentType();
        }
        return type;
    }

