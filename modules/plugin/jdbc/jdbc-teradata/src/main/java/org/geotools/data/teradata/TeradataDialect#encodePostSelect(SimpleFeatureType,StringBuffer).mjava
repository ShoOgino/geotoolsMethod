    @Override
    public void encodePostSelect(SimpleFeatureType featureType, StringBuffer sql) {
        // Since geometries are stored as LOB's in teradata reading a geometry value in TD requires
        // as second trip to the database. Since this is expensive we attempt to cast the geometry
        // into a 64K byte string which is the limit of what TD will include inline. For large
        // geometries we will have to check and fall back onto readin the Blob, but for smaller
        // geometries this will save us the second trip
        // see decodeGeometryValue()
        // CASE WHEN CHARACTERS("the_geom") > 16000 THEN NULL ELSE CAST("the_geom" AS
        // VARCHAR(16000)) END  as "the_geom_inline
        // Note: this only applies to TD 13 and up
        if (tdVersion > 12 && lobWorkaroundEnabled) {
            for (AttributeDescriptor att : featureType.getAttributeDescriptors()) {
                if (att instanceof GeometryDescriptor) {
                    sql.append(", CASE WHEN CHARACTERS(cast(");
                    encodeColumnName(att.getLocalName(), sql);
                    sql.append(" as clob)) > 30000 THEN NULL ELSE CAST (");
                    encodeColumnName(att.getLocalName(), sql);
                    // works but not ideal, assumes rest of attributes consume < 2000 characters in
                    // result set
                    sql.append(" as VARCHAR(30000)) END");
                    encodeColumnAlias(att.getLocalName() + "_inline", sql);
                }
            }
        }
    }

