    @Test
    public void NetCDFProjectedEnvelopeTest()
            throws NoSuchAuthorityCodeException, FactoryException, IOException, ParseException {
        File mosaic = new File(TestData.file(this, "."), "NetCDFProjection");
        if (mosaic.exists()) {
            FileUtils.deleteDirectory(mosaic);
        }
        assertTrue(mosaic.mkdirs());
        File file = TestData.file(this, "wind.nc");
        FileUtils.copyFileToDirectory(file, mosaic);
        file = new File(mosaic, "wind.nc");
        // Get format

        final NetCDFReader reader = new NetCDFReader(file, null);
        try {
            String[] names = reader.getGridCoverageNames();
            String coverageName = names[0];

            // subsetting the envelope
            final ParameterValue<GridGeometry2D> gg =
                    AbstractGridFormat.READ_GRIDGEOMETRY2D.createValue();
            final GeneralEnvelope originalEnvelope = reader.getOriginalEnvelope(coverageName);
            final CoordinateReferenceSystem epsg3857 = CRS.decode("EPSG:3857", true);
            final GeneralEnvelope projectedEnvelope = CRS.transform(originalEnvelope, epsg3857);

            gg.setValue(
                    new GridGeometry2D(
                            new GridEnvelope2D(new Rectangle(0, 0, 30, 30)), projectedEnvelope));

            GeneralParameterValue[] values = new GeneralParameterValue[] {gg};
            GridCoverage2D coverage = reader.read(coverageName, values);

            // reader doesn't perform reprojection. It simply transforms reprojected envelope
            // to native envelope so BBOX and CRS should be wgs84
            CoordinateReferenceSystem coverageCRS = coverage.getCoordinateReferenceSystem();
            final int code = CRS.lookupEpsgCode(coverageCRS, false);
            assertEquals(4326, code);
            Extent extent = coverageCRS.getDomainOfValidity();
            Collection<? extends GeographicExtent> geoElements = extent.getGeographicElements();
            GeographicExtent geographicExtent = geoElements.iterator().next();
            GeographicBoundingBoxImpl impl = (GeographicBoundingBoxImpl) geographicExtent;

            // Getting the coverage Envelope for coordinates check
            Envelope coverageEnvelope = coverage.getEnvelope();
            assertTrue(impl.getEastBoundLongitude() >= coverageEnvelope.getMaximum(0));
            assertTrue(impl.getWestBoundLongitude() <= coverageEnvelope.getMinimum(0));
            assertTrue(impl.getNorthBoundLatitude() >= coverageEnvelope.getMaximum(1));
            assertTrue(impl.getSouthBoundLatitude() <= coverageEnvelope.getMinimum(1));

        } catch (Throwable t) {
            throw new RuntimeException(t);
        } finally {
            if (reader != null) {
                try {
                    reader.dispose();
                } catch (Throwable t) {
                    // Does nothing
                }
            }
        }
    }

