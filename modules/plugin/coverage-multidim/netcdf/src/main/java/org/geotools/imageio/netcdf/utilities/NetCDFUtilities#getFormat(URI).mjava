    public static FileFormat getFormat(URI uri) throws IOException {
        // try binary
        try (InputStream input = uri.toURL().openStream()) {
            // Checking Magic Number
            byte[] b = new byte[GRIB_SEARCH_BYTES];
            int count = input.read(b);
            if (count < 3) {
                return FileFormat.NONE;
            }
            // CDF signature at start of file
            if ((b[0] == (byte) 0x43 && b[1] == (byte) 0x44 && b[2] == (byte) 0x46)) {
                return FileFormat.CDF;
            }
            // HDF signature at start of file
            if ((b[0] == (byte) 0x89 && b[1] == (byte) 0x48 && b[2] == (byte) 0x44)) {
                return FileFormat.HDF5;
            }
            // Search for GRIB signature in first count bytes (up to GRIB_SEARCH_BYTES)
            for (int i = 0; i < count - 3; i++) {
                if (b[i] == (byte) 0x47
                        && b[i + 1] == (byte) 0x52
                        && b[i + 2] == (byte) 0x49
                        && b[i + 3] == (byte) 0x42) {
                    return FileFormat.GRIB;
                }
            }
        }

        // try XML
        try (InputStream input = uri.toURL().openStream()) {
            StreamSource streamSource = null;
            XMLStreamReader reader = null;
            try {
                streamSource = new StreamSource(input);
                XMLInputFactory inputFactory = XMLInputFactory.newInstance();
                reader = inputFactory.createXMLStreamReader(streamSource);
                reader.nextTag();
                if ("netcdf".equals(reader.getName().getLocalPart())) {
                    return FileFormat.NCML;
                }
                if ("featureCollection".equals(reader.getName().getLocalPart())) {
                    return FileFormat.FC;
                }
            } catch (XMLStreamException | FactoryConfigurationError e) {

            } finally {
                if (reader != null) {
                    if (streamSource.getInputStream() != null) {
                        streamSource.getInputStream().close();
                    }
                    try {
                        reader.close();
                    } catch (XMLStreamException e) {
                    }
                }
            }
        }
        return FileFormat.NONE;
    }

