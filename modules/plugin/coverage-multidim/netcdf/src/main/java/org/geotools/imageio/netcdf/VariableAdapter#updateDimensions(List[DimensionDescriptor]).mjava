    /**
     * Update the dimensions to attributes mapping for this variable if needed. Default behaviour is
     * to get attributes from the name of the dimensions of the variable. In case the indexer.xml
     * contains an explicit schema with different attributes for time and elevation we need to remap
     * them and updates the dimensions mapping as well as the DimensionsDescriptors
     */
    private void updateDimensions(List<DimensionDescriptor> dimensionDescriptors)
            throws IOException {
        final Map<Name, String> mapping = reader.ancillaryFileManager.variablesMap;
        final Set<Name> keys = mapping.keySet();
        final String varName = getName();
        for (Name key : keys) {

            // Go to the current variable
            final String origName = mapping.get(key);
            if (origName.equalsIgnoreCase(varName)) {

                // Get the mapped coverage name (as an instance, NO2 for a GOME2 with var = 'z')
                final String coverageName = key.getLocalPart();
                final Coverage coverage =
                        reader.ancillaryFileManager.coveragesMapping.get(coverageName);
                final SchemaType schema = coverage.getSchema();
                if (schema != null) {
                    // look up the name
                    String schName = schema.getName();
                    final CoverageSlicesCatalog catalog = reader.getCatalog();
                    if (catalog != null) {
                        // Current assumption is that we have a typeName for each coverage but we
                        // should keep on working
                        // with shared schemas
                        // try with coveragename
                        SimpleFeatureType schemaType = null;
                        try {
                            if (schName != null) {
                                schemaType = catalog.getSchema(schName);
                            }
                        } catch (IOException e) {
                            // ok, we did not use the schema name, let's use the coverage name
                            schemaType = catalog.getSchema(coverageName);
                        }
                        if (schemaType != null) {
                            // Schema found: proceed with remapping attributes
                            updateMapping(schemaType, dimensionDescriptors);
                            break;
                        }
                        throw new IllegalStateException(
                                "Unable to find the table for this coverage: " + coverageName);
                    }
                }
                break;
            }
        }
    }

