    /**
     * Builds a datastore from a property file configuration, using GeoTools default convention as
     * well as ImageMosaic own one
     */
    public static DataStore getDataStore(Properties configuration)
            throws IOException, ClassNotFoundException, IllegalAccessException,
                    InstantiationException, NoSuchMethodException, InvocationTargetException {
        // first try out the default GeoTools approach
        final DataStore dataStore =
                DataStoreFinder.getDataStore(DataUtilities.toConnectionParameters(configuration));
        if (dataStore == null) {
            // use ImageMosaic bizarre own way
            final String spiClass = (String) configuration.get("SPI");
            DataStoreFactorySpi spi =
                    (DataStoreFactorySpi)
                            Class.forName(spiClass).getDeclaredConstructor().newInstance();
            Map<String, Serializable> datastoreParams =
                    Utils.filterDataStoreParams(configuration, spi);
            return spi.createDataStore(datastoreParams);
        }

        return null;
    }

