    /**
     * Update features imageIndex by referring them to a specific offset
     *
     * @param collection
     * @param offset
     * @throws IOException
     */
    private void updateFeaturesIndex(
            final ListFeatureCollection collection, final int offset, boolean isShared)
            throws IOException {
        try (SimpleFeatureIterator featuresIt = collection.features()) {
            while (featuresIt.hasNext()) {
                SimpleFeature feature = featuresIt.next();
                Integer index = (Integer) feature.getAttribute(INDEX);
                if (isShared) {
                    feature.setAttribute(LOCATION, file.getCanonicalPath());
                }
                feature.setAttribute(INDEX, index + offset);
            }
        }
    }

