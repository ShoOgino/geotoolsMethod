    protected PreparedStatement validateStatement(PreparedStatement stmt, String sql)
            throws SQLException {
        Connection conn = null;
        if (stmt != null) {
            try {
                conn = stmt.getConnection();
            } catch (SQLException sqle) {
                // mark this invalid
                stmt = null;
            }
        }
        if (conn != null && !factory.isConnectionValid(conn)) {
            stmt = null;
        }
        if (stmt == null) {
            stmt = factory.getConnection().prepareStatement(sql);
        }
        return stmt;
    }

