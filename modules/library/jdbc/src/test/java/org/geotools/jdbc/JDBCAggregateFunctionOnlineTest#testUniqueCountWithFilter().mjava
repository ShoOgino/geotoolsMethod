    public void testUniqueCountWithFilter() throws Exception {
        FilterFactory ff = dataStore.getFilterFactory();
        PropertyName p = ff.property(aname("stringProperty"));

        UniqueCountVisitor v = new UniqueCountVisitor(p);
        Filter f = ff.greater(ff.property(aname("doubleProperty")), ff.literal(1));
        Query q = new Query(tname("ft1"), f);
        dataStore.getFeatureSource(tname("ft1")).accepts(q, v, null);
        assertFalse(visited);
        Set result = v.getUnique();
        assertEquals(0, result.size());
        assertEquals(2, v.getResult().toInt());
    }

