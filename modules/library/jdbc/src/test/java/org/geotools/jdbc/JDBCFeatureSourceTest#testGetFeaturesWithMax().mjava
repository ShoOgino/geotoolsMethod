    public void testGetFeaturesWithMax() throws Exception {
        DefaultQuery q = new DefaultQuery(featureSource.getSchema().getTypeName());
        q.setMaxFeatures(2);
        SimpleFeatureCollection features = featureSource.getFeatures(q);
        
        // check size
        assertEquals(2, features.size());
        
        // check actual iteration
        Iterator<SimpleFeature> it = features.iterator();
        int count = 0;
        ReferencedEnvelope env = new ReferencedEnvelope(features.getSchema().getCoordinateReferenceSystem());
        while(it.hasNext()) {
            SimpleFeature f = it.next();
            env.expandToInclude(ReferencedEnvelope.reference(f.getBounds()));
            count++;
        }
        assertEquals(2, count);
        features.close(it);
        
        //assertEquals(env, features.getBounds());
        assertTrue(areReferencedEnvelopesEuqal(env, features.getBounds()));
    }

