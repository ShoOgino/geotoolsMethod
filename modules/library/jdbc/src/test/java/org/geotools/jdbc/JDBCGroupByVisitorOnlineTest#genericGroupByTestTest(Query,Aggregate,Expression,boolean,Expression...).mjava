    private List<Object[]> genericGroupByTestTest(
            Query query,
            Aggregate aggregateVisitor,
            Expression aggregateAttribute,
            boolean expectOptimized,
            Expression... groupByAttributes)
            throws IOException {
        ContentFeatureSource featureSource =
                dataStore.getFeatureSource(tname("buildings_group_by_tests"));

        GroupByVisitorBuilder visitorBuilder =
                new GroupByVisitorBuilder()
                        .withAggregateAttribute(aggregateAttribute)
                        .withAggregateVisitor(aggregateVisitor);
        for (Expression groupByAttribute : groupByAttributes) {
            visitorBuilder.withGroupByAttribute(groupByAttribute);
        }
        GroupByVisitor visitor = visitorBuilder.build();
        featureSource.accepts(query, visitor, null);
        assertEquals(expectOptimized, visitor.wasOptimized());
        assertEquals(!expectOptimized, visitor.wasVisited());
        List<Object[]> value = visitor.getResult().toList();
        assertNotNull(value);
        return value;
    }

