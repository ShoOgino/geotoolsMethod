    public void testAcceptsVisitor() throws Exception {
        class TotalVisitor implements FeatureVisitor {
            int total = 0;

            public void visit(Feature feature) {
                total++;
            }
        }
        TotalVisitor visitor = new TotalVisitor();

        // initial test on Transaction.AUTO_COMMIT
        int count = featureSource.getCount(Query.ALL);
        featureSource.accepts(Query.ALL, visitor, null);
        assertEquals(count, visitor.total);
        visitor.total = 0; // reset

        // test on a transaction
        JDBCFeatureStore ft1 = (JDBCFeatureStore) dataStore.getFeatureSource(tname("ft1"));
        try (Transaction transaction = new DefaultTransaction()) {
            ft1.setTransaction(transaction);
            try (Connection connection = ft1.getDataStore().getConnection(ft1.getState())) {
                assertFalse("connection established", connection.isClosed());

                ft1.accepts(Query.ALL, visitor, null);

                assertFalse("connection maintained", connection.isClosed());
            }
        }
    }

