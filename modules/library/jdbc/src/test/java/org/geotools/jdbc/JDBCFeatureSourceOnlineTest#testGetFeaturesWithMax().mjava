    public void testGetFeaturesWithMax() throws Exception {
        Query q = new Query(featureSource.getSchema().getTypeName());
        q.setMaxFeatures(2);
        SimpleFeatureCollection features = featureSource.getFeatures(q);
        
        // check size
        assertEquals(2, features.size());
        
        // check actual iteration
        SimpleFeatureIterator it = features.features();
        try {
            int count = 0;
            ReferencedEnvelope env = new ReferencedEnvelope(features.getSchema().getCoordinateReferenceSystem());
            while(it.hasNext()) {
                SimpleFeature f = it.next();
                env.expandToInclude(ReferencedEnvelope.reference(f.getBounds()));
                count++;
            }
            assertEquals(2, count);
            //assertEquals(env, features.getBounds());
            it.close();
            it=null;
            assertTrue(areReferencedEnvelopesEqual(env, features.getBounds()));
        } finally {
            if(it!=null)
                it.close();
        }        
    }

