    @Test
    public void testExpandVariables() throws Exception {
        SessionCommandsListener listener =
                new SessionCommandsListener(
                        "call startSession('${user}')", "call endSession('${user,joe}')");

        // check borrow
        EnvFunction.setLocalValue("user", "abcde");
        listener.onBorrow(store, conn);
        assertEquals(1, conn.commands.size());
        assertEquals("call startSession('abcde')", conn.commands.get(0));
        conn.commands.clear();

        // check release
        EnvFunction.clearLocalValues();
        listener.onRelease(store, conn);
        assertEquals(1, conn.commands.size());
        assertEquals("call endSession('joe')", conn.commands.get(0));
        conn.commands.clear();
    }

