    protected void encodeFunction( String function, Expression expression, Query query, StringBuffer sql , SimpleFeatureType featureType) {
        sql.append(getFunctioName(function)).append("(");
        AttributeDescriptor att = extractAggregateAttribute(expression, featureType);
        if ( att == null ) {
            sql.append( "*" );
        }
        else if (expression instanceof PropertyName){
            if ( att instanceof GeometryDescriptor ) {
                encodeGeometryColumn((GeometryDescriptor)att, sql,query.getHints());
            }
            else {
                dialect.encodeColumnName( att.getLocalName(), sql);
            }
        } else if(expression instanceof FunctionExpression) {
            dialect.encodeFunction(getFunctioName(((FunctionExpression)expression).getName()), att.getLocalName(), sql);
        } else {
            sql.append( "*" );
        }
        
        sql.append(")");
    }

