    FilterToSQL filter(SimpleFeatureType featureType, Filter filter, StringBuffer sql) throws IOException {
        
        try {
            // grab the full feature type, as we might be encoding a filter
            // that uses attributes that aren't returned in the results
            SimpleFeatureType fullSchema = getSchema(featureType.getTypeName());
            FilterToSQL toSQL = dialect instanceof PreparedStatementSQLDialect ? 
                createPreparedFilterToSQL(fullSchema) : createFilterToSQL(fullSchema);
            toSQL.setInline(true);
            sql.append(" ").append(toSQL.encodeToString(filter));
            return toSQL;
        } catch (FilterToSQLException e) {
            throw new RuntimeException(e);
        }
    }

