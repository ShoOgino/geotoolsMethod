    /*
     * helper to do a safe convesion of expression to a number
     */
    Number safeConvertToNumber(Expression expression, Class target) {
        Object evaluated = expression.evaluate(null);
        // don't try conversion for arrays, to avoid wrong arraytosingle conversion
        if (evaluated != null && evaluated.getClass().isArray()) {
            return null;
        }
        return (Number)
                Converters.convert(
                        evaluated, target, new Hints(ConverterFactory.SAFE_CONVERSION, true));
    }

