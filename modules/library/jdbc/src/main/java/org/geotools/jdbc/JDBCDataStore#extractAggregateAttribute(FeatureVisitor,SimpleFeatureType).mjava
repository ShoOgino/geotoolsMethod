    /**
     * Helper method that extract the attribute that will be used by the aggregate function.
     *
     * @param visitor     the feature visitor
     * @param featureType the feature type
     * @return the aggregate attribute or NULL if the visitor don't contains an aggregate attribute
     */
    protected AttributeDescriptor extractAggregateAttribute(FeatureVisitor visitor, SimpleFeatureType featureType) {
        // if is a group by visitor we need to use the internal aggregate visitor
        FeatureVisitor aggregateVisitor = isGroupByVisitor(visitor) ? ((GroupByVisitor) visitor).getAggregateVisitor() : visitor;
        Expression expression = getExpression(aggregateVisitor);
        if (expression == null) {
            // no aggregate attribute available, NULL will be returned
            LOGGER.info("Visitor " + visitor.getClass() + " has no aggregate attribute.");
            return null;
        }
        // we evaluate the expression and return the aggregate attribute
        return (AttributeDescriptor) expression.evaluate(featureType);
    }

