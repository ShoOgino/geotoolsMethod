    /**
     * Set all the key values (the ones that are known before insert) for a prepared statement.
     */
    public int setKeyValues(PreparedStatementSQLDialect dialect, PreparedStatement ps,
                            Connection cx, SimpleFeatureType featureType, SimpleFeature feature,
                            int curFieldPos)
            throws IOException, SQLException {
        final List<Object> keyValues = getNextValues(cx, feature);
        for (int i = 0; i < key.getColumns().size(); i++) {
            final PrimaryKeyColumn col = key.getColumns().get(i);
            final Object value = keyValues.get(i);
            if (value != NOT_SET_BEFORE_INSERT) {
                dialect.setValue(value, col.getType(), ps, curFieldPos++, cx);
            }
        }

        if (!isPostInsert()) {
            //report the feature id as user data since we cant set the fid.
            String fid = featureType.getTypeName() + "." + JDBCDataStore.encodeFID(keyValues);
            feature.getUserData().put("fid", fid);
        }

        return curFieldPos;
    }

