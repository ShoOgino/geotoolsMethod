    /**
     * Finds all implemtaions of DataStoreFactory which have registered using the services
     * mechanism, and that have the appropriate libraries on the classpath.
     * 
     * @return An iterator over all discovered datastores which have registered factories, and whose
     *         available method returns true.
     */
    public static synchronized Iterator getAvailableDataSources() {
        Set availableDS = new HashSet();
        Iterator it = getServiceRegistry().getServiceProviders(DataSourceFactorySpi.class, null, null);
        DataSourceFactorySpi dsFactory;
        while (it.hasNext()) {
            dsFactory = (DataSourceFactorySpi) it.next();

            if (dsFactory.isAvailable()) {
                availableDS.add(dsFactory);
            }
        }

        return availableDS.iterator();
    }

