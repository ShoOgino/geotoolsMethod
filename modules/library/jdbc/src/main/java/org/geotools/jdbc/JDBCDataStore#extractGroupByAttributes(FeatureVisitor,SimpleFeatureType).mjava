    /**
     * Helper method that extracts a list of group by attributes from a group by visitor.
     * If the visitor is not a group by visitor an empty list will be returned.
     *
     * @param visitor     the feature visitor
     * @param featureType the feature type
     * @return the list of the group by attributes or an empty list
     */
    protected List<AttributeDescriptor> extractGroupByAttributes(FeatureVisitor visitor, SimpleFeatureType featureType) {
        // if is a group by visitor we get the list of attributes expressions otherwise we get an empty list
        List<Expression> expressions = isGroupByVisitor(visitor) ?
                ((GroupByVisitor) visitor).getGroupByAttributes() : new ArrayList<>();
        // we convert the list of attributes expressions to a list of attributes descriptors
        return expressions.stream()
                .map(expression -> (AttributeDescriptor) expression.evaluate(featureType))
                .collect(Collectors.toList());
    }

