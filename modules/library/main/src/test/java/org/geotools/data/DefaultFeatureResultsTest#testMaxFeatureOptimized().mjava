    @Test
    public void testMaxFeatureOptimized() throws Exception {
        Query q = new Query("roads");
        q.setMaxFeatures(10);

        // mock up the feature source so that it'll return a count of 20
        SimpleFeatureType type =
                DataUtilities.createType("roads", "_=the_geom:Point,FID:String,NAME:String");
        SimpleFeatureSource fs = createMock(SimpleFeatureSource.class);
        expect(fs.getSchema()).andReturn(type).anyTimes();
        expect(fs.getCount(q)).andReturn(20);
        replay(fs);

        DefaultFeatureResults results = new DefaultFeatureResults(fs, q);
        Assert.assertEquals(10, results.size());
    }

