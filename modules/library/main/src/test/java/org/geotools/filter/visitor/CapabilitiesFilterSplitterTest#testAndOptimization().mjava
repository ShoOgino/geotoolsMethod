    @Test
    public void testAndOptimization() throws Exception {
        Capabilities caps = new Capabilities();
        // no logical operator capabilities
        caps.addAll(Capabilities.SIMPLE_COMPARISONS_OPENGIS);

        visitor = newVisitor(caps);

        // try with two filters
        Filter f1 = ff.greater(ff.property("foo"), ff.literal(42));
        Filter f2 = ff.less(ff.property("bar"), ff.literal(21));

        Filter andFilter = ff.and(f1, f2);

        // visit filter
        andFilter.accept(visitor, null);

        // test
        assertEquals(f1, visitor.getFilterPre());
        assertEquals(f2, visitor.getFilterPost());

        // try with a third filter
        Filter f3 = ff.greater(ff.property("height"), ff.literal(84));

        andFilter = ff.and(Arrays.asList(new Filter[] {f1, f2, f3}));

        // visit filter
        andFilter.accept(visitor, null);

        // test
        assertEquals(f1, visitor.getFilterPre());
        assertEquals(ff.and(f2, f3), visitor.getFilterPost());
    }

