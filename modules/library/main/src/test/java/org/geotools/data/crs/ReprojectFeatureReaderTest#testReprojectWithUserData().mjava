    @Test
    public void testReprojectWithUserData() throws Exception {
        // create a feature collection wit a single feature
        SimpleFeatureType featureType =
                DataUtilities.createType("feature", "id:string,geometry:Point:srid=4326");
        SimpleFeature feature = DataUtilities.createFeature(featureType, "1|POINT(1 2)");
        ListFeatureCollection features = new ListFeatureCollection(featureType);
        features.add(feature);
        // add some user data to the feature
        feature.getUserData().put("someKey", "someValue");
        // instantiate the reproject reader
        CoordinateReferenceSystem sphericalMercator = CRS.decode("EPSG:3857");
        FeatureReader<SimpleFeatureType, SimpleFeature> reader =
                DataUtilities.reader((SimpleFeatureCollection) features);
        int featuresCount = 0;
        try (ReprojectFeatureReader reprojected =
                new ReprojectFeatureReader(reader, sphericalMercator)) {
            // check that the feature was correctly reprojected
            SimpleFeature reprojectedFeature = reprojected.next();
            assertThat(reprojectedFeature, notNullValue());
            Point geometry = (Point) reprojectedFeature.getDefaultGeometry();
            checkDoubleValue(geometry.getX(), 222638.9816, 0.0001);
            checkDoubleValue(geometry.getY(), 111325.1429, 0.0001);
            // check that the user data was preserved
            assertThat(reprojectedFeature.getUserData().get("someKey"), is("someValue"));
            // increment the features counter
            featuresCount++;
        }
        // check that we iterate over the feature
        assertThat(featuresCount, is(1));
    }

