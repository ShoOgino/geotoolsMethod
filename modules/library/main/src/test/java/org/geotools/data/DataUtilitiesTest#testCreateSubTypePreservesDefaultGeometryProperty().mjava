    @Test
    public void testCreateSubTypePreservesDefaultGeometryProperty() throws Exception {
        SimpleFeatureTypeBuilder tb = new SimpleFeatureTypeBuilder();
        tb.setName("test");
        tb.add("name", String.class);
        tb.add("the_geom1", Point.class, 4326);
        tb.add("the_geom2", Point.class, 4326);
        tb.add("the_geom3", Point.class, 4326);
        tb.setDefaultGeometry("the_geom2");
        SimpleFeatureType before = tb.buildFeatureType();
        SimpleFeatureType after =
                DataUtilities.createSubType(before, "name", "the_geom1", "the_geom3");
        Assert.assertEquals(3, after.getAttributeCount());
        Assert.assertEquals("the_geom1", after.getGeometryDescriptor().getLocalName());

        after =
                DataUtilities.createSubType(
                        before,
                        new String[] {"name", "the_geom1", "the_geom3"},
                        DefaultGeographicCRS.WGS84);
        Assert.assertEquals(3, after.getAttributeCount());
        Assert.assertEquals("the_geom1", after.getGeometryDescriptor().getLocalName());

        after = DataUtilities.createSubType(before, "name", "the_geom1", "the_geom2");
        Assert.assertEquals(3, after.getAttributeCount());
        Assert.assertEquals("the_geom2", after.getGeometryDescriptor().getLocalName());

        after =
                DataUtilities.createSubType(
                        before,
                        new String[] {"name", "the_geom1", "the_geom2"},
                        DefaultGeographicCRS.WGS84);
        Assert.assertEquals(3, after.getAttributeCount());
        Assert.assertEquals("the_geom2", after.getGeometryDescriptor().getLocalName());
    }

