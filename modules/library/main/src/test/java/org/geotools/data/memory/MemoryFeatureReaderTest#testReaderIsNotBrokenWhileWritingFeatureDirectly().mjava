    @Test
    public void testReaderIsNotBrokenWhileWritingFeatureDirectly() throws IOException {
        // a write should not "destroy" readers
        int expectedFeatureCount = roadFeatures.length;
        int currentFeatureCount = 0;

        FeatureReader<SimpleFeatureType, SimpleFeature> featureReader =
                memoryDataStore.getFeatureReader(
                        new Query(roadType.getTypeName(), Filter.INCLUDE), transaction);

        // start iterating through content
        if (featureReader.hasNext()) {
            featureReader.next();
            currentFeatureCount++;
        }
        SimpleFeature newFeature = SimpleFeatureBuilder.template(roadType, null);

        memoryDataStore.addFeature(newFeature);

        assertReaderHasFeatureCount(expectedFeatureCount, currentFeatureCount, featureReader);
    }

