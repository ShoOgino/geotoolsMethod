    /**
     * Record a modification to the indicated fid
     * 
     * @param fid
     * @param f replacement feature; null to indicate remove
     */
	public void modify(String fid, SimpleFeature f) {
		synchronized (mutex) {
			SimpleFeature old;
            if( addedFeatures.containsKey(fid) ){
            	old=(SimpleFeature) addedFeatures.get(fid);
                addedFeatures.put(fid, f);
            }else{
            	old=(SimpleFeature) modifiedFeatures.get(fid);
                modifiedFeatures.put(fid, f);
            }
            if(old != null) {
            	spatialIndex.remove(ReferencedEnvelope.reference(old.getBounds()), old);
            }
            addToSpatialIndex(f);
		}
	}

