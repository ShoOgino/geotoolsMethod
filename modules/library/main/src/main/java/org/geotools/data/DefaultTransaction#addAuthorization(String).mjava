    /**
     * Provides an authorization ID allowing access to locked Features.
     *
     * <p>Remember authorizations are cleared after every commit/rollback.
     *
     * @param authID Provided Authorization ID
     * @throws IOException Encountered problems maintaing Transaction State
     * @throws DataSourceException See IOException
     * @see org.geotools.data.Transaction#setAuthorization(java.lang.String)
     */
    @Override
    public void addAuthorization(String authID) throws IOException {
        if (authorizations == null) {
            throw new IllegalStateException("Transaction has been closed");
        }
        int problemCount = 0;
        IOException io = null;
        State state;
        authorizations.add(authID);

        for (Object o : stateLookup.values()) {
            state = (State) o;

            try {
                state.addAuthorization(authID);
            } catch (IOException e) {
                problemCount++;
                io = e;
            }
        }

        if (io != null) {
            if (problemCount == 1) {
                throw io;
            }
            throw new DataSourceException(
                    "setAuthorization encountered " + problemCount + " problems - the first was",
                    io);
        }
    }

