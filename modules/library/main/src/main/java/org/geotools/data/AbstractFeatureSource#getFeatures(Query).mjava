    /**
     * Provides an interface to for the Results of a Query.
     *
     * <p>
     * Various queries can be made against the results, the most basic being to retrieve Features.
     * </p>
     *
     * @param query
     *
     *
     * @see org.geotools.data.FeatureSource#getFeatures(org.geotools.data.Query)
     */
    public SimpleFeatureCollection getFeatures(Query query) throws IOException {
    	SimpleFeatureType schema = getSchema();        
        String typeName = schema.getTypeName();
        
        if( query.getTypeName() == null ){ // typeName unspecified we will "any" use a default
            DefaultQuery defaultQuery = new DefaultQuery(query);
            defaultQuery.setTypeName( typeName );
        }
        else if ( !typeName.equals( query.getTypeName() ) ){
            return new EmptyFeatureCollection( schema );
        }
        
        final QueryCapabilities queryCapabilities = getQueryCapabilities();
        if(!queryCapabilities.supportsSorting(query.getSortBy())){
            throw new DataSourceException("DataStore cannot provide the requested sort order");
        }
        
        SimpleFeatureCollection collection = new DefaultFeatureResults(this, query);
        if( collection.getSchema().getGeometryDescriptor() == null ){
            return collection; // no geometry no reprojection needed
        }
        
//        if( false ){ // we need to have our CRS forced
//            if ( query.getCoordinateSystem() != null ){
//                try {
//                    collection = new ForceCoordinateSystemFeatureResults(collection, query.getCoordinateSystem() );
//                } catch (SchemaException e) {
//                    throw new IOException( "Could not force CRS "+query.getCoordinateSystem() ); 
//                }
//            }
//        }
//        if( false ){ // we need our data reprojected
//            if ( query.getCoordinateSystemReproject() != null){
//                try {
//                    collection = new ReprojectFeatureResults(collection, query.getCoordinateSystemReproject() );
//                } catch (Exception e) {
//                    throw new IOException( "Could not reproject to "+query.getCoordinateSystemReproject() );
//                }
//            }            
//        }
        return collection;
    }

