    @SuppressWarnings("unchecked")
    public Iterator<SimpleFeature> openIterator() {
        if (collection instanceof Collection) {
            Iterator<SimpleFeature> it = ((Collection<SimpleFeature>) collection).iterator();
            return new FilteredIterator<SimpleFeature>(it, filter());
        } else if (collection instanceof AbstractFeatureCollection) {
            Iterator<SimpleFeature> iterator = ((AbstractFeatureCollection) collection).iterator();
            return new FilteredIterator<SimpleFeature>(iterator, filter());
        } else if (collection instanceof AbstractFeatureCollection) {
            Iterator<SimpleFeature> iterator = ((AdaptorFeatureCollection) collection).iterator();
            return new FilteredIterator<SimpleFeature>(iterator, filter());
        } else {
            // JG because we have an implementation of features we should
            // choose a different base class that does not require an Iterator
            throw new UnsupportedOperationException();
        }
    }

