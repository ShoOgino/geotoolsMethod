    /**
     * Returns a feature reader for the specified query and transaction.
     *
     * <p>This method is not intended to be overridden and is marked final. This implementation
     * delegates to {@link FeatureCollection} and wraps an iterator in a {@link FeatureReader}.
     */
    @Override
    public FeatureReader<SimpleFeatureType, SimpleFeature> getFeatureReader(
            Query query, Transaction tx) throws IOException {

        if (query.getTypeName() == null) {
            throw new IllegalArgumentException("Query does not specify type.");
        }

        return getFeatureSource(query.getTypeName(), tx).getReader(query);
    }

