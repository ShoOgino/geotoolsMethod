        private void applyZValues(
                CoordinateSequence cs, int idx, CoordinateSequence csOrig, int origIdx) {

            if (!cs.hasZ()) return;

            double lx1 = cs.getOrdinate(idx, 0);
            double ly1 = cs.getOrdinate(idx, 1);
            double lz1;

            double ox1 = csOrig.getX(origIdx);
            double oy1 = csOrig.getY(origIdx);
            double oz1 = csOrig.getZ(origIdx);
            double ox2 = csOrig.getX(origIdx + 1);
            double oy2 = csOrig.getY(origIdx + 1);
            double oz2 = csOrig.getZ(origIdx + 1);

            if (lx1 == ox1 && ly1 == oy1) {
                lz1 = oz1;
            } else {
                double d1 = distance(ox1, oy1, lx1, ly1);
                double d = distance(ox1, oy1, ox2, oy2);
                lz1 = oz1 + (oz2 - oz1) * (d1 / d);
            }

            cs.setOrdinate(idx, 2, lz1);
        }

