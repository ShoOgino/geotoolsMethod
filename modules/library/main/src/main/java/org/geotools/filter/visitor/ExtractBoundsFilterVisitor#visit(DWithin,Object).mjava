    public Object visit(DWithin filter, Object data) {
        ReferencedEnvelope bbox = bbox(data);

        // we have to take the reference geometry bbox and
        // expand it by the distance.
        // We ignore the unit of measure for the moment
        Literal geometry = null;
        if (filter.getExpression1() instanceof PropertyName
                && filter.getExpression2() instanceof Literal) {
            geometry = (Literal) filter.getExpression2();
        }
        if (filter.getExpression2() instanceof PropertyName
                && filter.getExpression1() instanceof Literal) {
            geometry = (Literal) filter.getExpression2();
        }

        // we cannot desume a bbox from this filter
        if (geometry == null) {
            return infinity();
        }

        Geometry geom = geometry.evaluate(null, Geometry.class);
        if (geom == null) {
            return infinity();
        }

        Envelope env = geom.getEnvelopeInternal();
        env.expandBy(filter.getDistance());

        if (bbox != null) {
            bbox.expandToInclude(env);
            return bbox;
        } else {
            return bbox(env);
        }
    }

