    /** @see org.geotools.data.FeatureReader#next() */
    @Override
    public SimpleFeature next()
            throws IOException, IllegalAttributeException, NoSuchElementException {
        if (reader == null) {
            throw new IOException("FeatureReader has been closed");
        }

        SimpleFeature next = reader.next();
        String id = next.getID();

        String xpath;

        for (AttributeDescriptor type : types) {
            xpath = type.getLocalName();
            if (clone) builder.add(DataUtilities.duplicate(next.getAttribute(xpath)));
            else builder.add(next.getAttribute(xpath));
        }

        SimpleFeature feature = builder.buildFeature(id);
        if (next.hasUserData()) {
            feature.getUserData().putAll(next.getUserData());
        }
        return feature;
    }

