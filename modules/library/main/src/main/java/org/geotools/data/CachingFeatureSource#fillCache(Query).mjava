    private void fillCache(Query query) throws IOException {
        Query cloned = new Query(query);
        cloned.getHints().remove(Hints.GEOMETRY_DISTANCE);

        FeatureCollection features = wrapped.getFeatures(cloned);
        FeatureIterator fi = features.features();
        index = null;
        STRtree newIndex = new STRtree();
        while (fi.hasNext()) {
            // consider turning all geometries into packed ones, to save space
            Feature f = fi.next();
            newIndex.insert(ReferencedEnvelope.reference(f.getBounds()), f);
        }
        fi.close();
        index = newIndex;
        cachedQuery = query;
        cachedBounds = getEnvelope(query.getFilter());
        dirty = false;
    }

