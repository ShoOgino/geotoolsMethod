    @Override
    public final boolean evaluate(Object feature) {

        Object object1 = getGeometries(getExpression1(), feature);
        Object object2 = getGeometries(getExpression2(), feature);

        if (object1 == null || object2 == null) {
            // default behaviour: if the geometry that is to be filtered is not
            // there we default to not returning anything
            return false;
        }

        if (!(object1 instanceof Collection) && !(object2 instanceof Collection)) {
            return evaluateInternal((Geometry) object1, (Geometry) object2);
        }

        @SuppressWarnings("unchecked")
        Collection<Geometry> leftValues =
                object1 instanceof Collection
                        ? (Collection<Geometry>) object1
                        : Collections.singletonList((Geometry) object1);
        @SuppressWarnings("unchecked")
        Collection<Geometry> rightValues =
                object2 instanceof Collection
                        ? (Collection<Geometry>) object2
                        : Collections.singletonList((Geometry) object2);

        int count = 0;
        for (Geometry leftValue : leftValues) {
            for (Geometry rightValue : rightValues) {

                boolean temp = evaluateInternal(leftValue, rightValue);
                if (temp) {
                    count++;
                }

                switch (matchAction) {
                    case ONE:
                        if (count > 1) return false;
                        break;
                    case ALL:
                        if (!temp) return false;
                        break;
                    case ANY:
                        if (temp) return true;
                        break;
                }
            }
        }

        switch (matchAction) {
            case ONE:
                return (count == 1);
            case ALL:
                return true;
            case ANY:
                return false;
            default:
                return false;
        }
    }

