    /** @see org.geotools.filter.FilterVisitor#visit(org.geotools.filter.FunctionExpression) */
    @Override
    public Object visit(Function function, Object notUsed) {
        if (!fcs.fullySupports(function)) {
            postStack.push(function);
            return null;
        }

        if (function.getName() == null) {
            postStack.push(function);
            return null;
        }

        final int postSize = postStack.size();
        final int preSize = preStack.size();

        final List<Expression> parameters = function.getParameters();
        for (Expression param : parameters) {
            param.accept(this, null);

            if (postSize < postStack.size()) {
                while (preSize < preStack.size()) {
                    preStack.pop();
                }
                postStack.pop();
                postStack.push(function);

                return null;
            }
        }
        while (preSize < preStack.size()) preStack.pop();
        preStack.push(function);
        return null;
    }

