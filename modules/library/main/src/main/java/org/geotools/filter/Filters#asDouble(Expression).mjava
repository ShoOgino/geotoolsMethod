    /**
     * Obtain the provided Expression as a double.
     *
     * @param expr
     * @return int value of first Number, or Double.NaN
     */
    public static double asDouble(Expression expr) {
        if (expr == null) {
            return Double.NaN;
        }
        try {
            Double number = expr.evaluate(null, Double.class);
            if (number == null) {
                return Double.NaN;
            }
            return number.doubleValue();
        } catch (NullPointerException npe) {
            // must be a more complicated expression than a literal
            return Double.NaN;
        }
    }

