    protected boolean prepareBuilderForNextFeature(SimpleFeature f) {
        boolean clippedOut = false;
        for (AttributeDescriptor ad : f.getFeatureType().getAttributeDescriptors()) {
            Object attribute = f.getAttribute(ad.getName());
            if (ad instanceof GeometryDescriptor) {
                Class target = ad.getType().getBinding();
                attribute =
                        clipGeometry(
                                (Geometry) attribute,
                                target,
                                ((GeometryDescriptor) ad).getCoordinateReferenceSystem());
                if (attribute == null && f.getFeatureType().getGeometryDescriptor() == ad) {
                    // the feature has been clipped out
                    fb.reset();
                    clippedOut = true;
                    break;
                }
            }
            fb.add(attribute);
        }
        return clippedOut;
    }

