        /**
         * Commit pending write operations.  After setting a mark, this method
         * will commit the pending writes.
         *
         * @see #mark()
         * @throws IllegalStateException if no mark is set
         */
        protected void commit() {
            if (backend != bufferedBackend) throw new IllegalStateException("Can't commit without a mark");
            for (Action a : pending) {
                a.commit();
            }
            pending.clear();
            backend = directBackend;
        }

