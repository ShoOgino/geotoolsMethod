    public Object evaluate(Object feature) {
        LineString ls;

        try { // attempt to get value and perform conversion
            ls = (LineString) getExpression(0).evaluate(feature, LineString.class);
        } catch (Exception e) {
            // probably a type error
            throw new IllegalArgumentException(
                    "Filter Function problem for function endPoint argument #0 - expected type Geometry");
        }
        if (ls == null || ls.getNumPoints() == 1) {
            return null;
        }

        CoordinateSequence cs = ls.getCoordinateSequence();

        double dx = (cs.getX(cs.size() - 1) - cs.getX(cs.size() - 2));
        double dy = (cs.getY(cs.size() - 1) - cs.getY(cs.size() - 2));
        return -Math.toDegrees(Math.atan2(dy, dx));
    }

