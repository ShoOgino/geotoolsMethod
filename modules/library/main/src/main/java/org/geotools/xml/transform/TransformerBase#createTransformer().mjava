    /**
     * Create a Transformer which is initialized with the settings of this
     * TransformerBase.
     */
    public Transformer createTransformer() throws TransformerException {
        TransformerFactory tFactory = TransformerFactory.newInstance();
        if (indentation > -1) {
        	try {
        		tFactory.setAttribute("indent-number", new Integer(indentation));
        	} catch (IllegalArgumentException e) {
        		//throw away (java 1.4 doesn't support this method, but java 1.5 requires it)
        	}
        }

        Transformer transformer = tFactory.newTransformer();

        if (indentation > -1) {
        	transformer.setOutputProperty(OutputKeys.INDENT, "yes");
            transformer.setOutputProperty("{http://xml.apache.org/xslt}indent-amount", Integer.toString(indentation));
        } else {
            transformer.setOutputProperty(OutputKeys.INDENT, "no");
        }

        if (xmlDecl) {
            transformer.setOutputProperty(OutputKeys.OMIT_XML_DECLARATION, "yes");
        } else {
            transformer.setOutputProperty(OutputKeys.OMIT_XML_DECLARATION, "no");
        }

	transformer.setOutputProperty(OutputKeys.ENCODING, charset.name());

        return transformer;
    }

