    /**
     * Reads in SimpleFeature that has been encoded into a line of text.
     *
     * <p>Example:
     *
     * <pre>
     * SimpleFeatureType featureType =
     *    DataUtilities.createType("FLAG","id:Integer|name:String|geom:Geometry:4326");
     *
     * SimpleFeature feature =
     *    DataUtilities.createFeature( featureType, "fid1=1|Jody Garnett\\nSteering Committee|POINT(1,2)" );
     * </pre>
     *
     * This format is used by the PropertyDataStore tutorials. It amounts to:
     *
     * <ul>
     *   <li>
     *   <li>Encoding of <i>FeatureId</i> followed by the attributes
     *   <li>Attributes are seperated using the bar character
     *   <li>Geometry is handled using {@link WKTReader2}
     *   <li>Support for common escaped characters
     *   <li>Multi-line support using escaped line-feed characters
     *       <ul>
     *
     * @return SimpleFeature defined by the provided line of text
     */
    public static SimpleFeature createFeature(SimpleFeatureType featureType, String line) {
        String fid;

        int fidSplit = line.indexOf('=');
        int barSplit = line.indexOf('|');
        if (fidSplit == -1 || (barSplit != -1 && barSplit < fidSplit)) {
            fid = null; // we need to generate a feature id
        } else {
            fid = line.substring(0, fidSplit);
        }
        String data = line.substring(fidSplit + 1);
        String[] text = splitIntoText(data, featureType);
        Object[] values = new Object[text.length];
        for (int i = 0; i < text.length; i++) {
            AttributeDescriptor descriptor = featureType.getDescriptor(i);
            Object value = createValue(descriptor, text[i]);
            values[i] = value;
        }
        SimpleFeature feature = SimpleFeatureBuilder.build(featureType, values, fid);

        return feature;
    }

