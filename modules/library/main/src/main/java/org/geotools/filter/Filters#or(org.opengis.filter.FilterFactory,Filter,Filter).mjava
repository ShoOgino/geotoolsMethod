    /**
     * Safe version of FilterFactory *or* that is willing to combine filter1 and filter2 correctly
     * in the even either of them is already an Or filter.
     *
     * @param ff
     * @param filter1
     * @param filter2
     * @return
     */
    public static Filter or(org.opengis.filter.FilterFactory ff, Filter filter1, Filter filter2) {
        ArrayList<Filter> list = new ArrayList<Filter>();
        if (filter1 == null) {
            // ignore
        } else if (filter1 instanceof Or) {
            Or some = (Or) filter1;
            list.addAll(some.getChildren());
        } else {
            list.add(filter1);
        }

        if (filter2 == null) {
            // ignore
        } else if (filter2 instanceof Or) {
            Or more = (Or) filter2;
            list.addAll(more.getChildren());
        } else {
            list.add(filter2);
        }

        if (list.size() == 0) {
            return Filter.EXCLUDE;
        } else if (list.size() == 1) {
            return list.get(0);
        } else {
            return ff.or(list);
        }
    }

