    /**
     * Visitor function, which looks at each feature and finds the value of the attribute given
     * attribute nearest to the given comparison value.
     * 
     * @param feature the feature to be visited
     */
    @SuppressWarnings("unchecked")
    public void visit(org.opengis.feature.Feature feature) {
        // bail out immediately if we have already found an exact match
        if (visited) {
            return;
        }
        
        if(attributeClass == null) {
            PropertyDescriptor desc = (PropertyDescriptor) expr.evaluate(feature.getType());
            attributeClass = desc.getType().getBinding();
            if(accumulator == null) {
                accumulator = getAccumulator(attributeClass);
            }
        }

        // extract the value
        Object attribValue = expr.evaluate(feature);
        if (attribValue == null) {
            return;
        } else {
            visited |= accumulator.visit(attribValue);
        }
    }

