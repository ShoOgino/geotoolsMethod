    protected Envelope extractBboxForSpatialIndexQuery(BinarySpatialOperator filter) {
        org.opengis.filter.expression.Expression leftGeom = filter.getExpression1();
        org.opengis.filter.expression.Expression rightGeom = filter.getExpression2();

        Object g;
        if (leftGeom instanceof org.opengis.filter.expression.Literal) {
            g = ((org.opengis.filter.expression.Literal) leftGeom).getValue();
        } else {
            g = ((org.opengis.filter.expression.Literal) rightGeom).getValue();
        }

        Envelope envelope = null;
        if (g instanceof Geometry) {
            envelope = ((Geometry) g).getEnvelopeInternal();
        } else if (g instanceof Envelope) {
            envelope = (Envelope) g;
        }
        return envelope;
    }

