    public Object visit(BBOX filter, Object extraData) {

        // grab the original envelope data
        BoundingBox boundaries = filter.getBounds();
        // parse the srs, it might be a code or a WKT definition
        CoordinateReferenceSystem crs = boundaries.getCoordinateReferenceSystem();
        
        // if no srs is specified we can't transform anyways
        if (crs == null)
            return super.visit(filter, extraData);

        // grab the property data
        PropertyName propertyName = null;
        // get the expression as is to preserve namespace context
        if (filter.getExpression1() instanceof PropertyName) {
            propertyName = (PropertyName) filter.getExpression1();
        } else if (filter.getExpression2() instanceof PropertyName) {
            propertyName = (PropertyName) filter.getExpression2();
        }
        CoordinateReferenceSystem targetCrs = findPropertyCRS(propertyName);

        // if there is a mismatch, reproject and replace
        if (crs != null && targetCrs != null && !CRS.equalsIgnoreMetadata(crs, targetCrs)) {
             ReferencedEnvelope envelope = ReferencedEnvelope.reference(boundaries);
             try {
				envelope = envelope.transform(targetCrs, true);
			} catch (TransformException e) {
				throw new RuntimeException (e);
			} catch (FactoryException e) {
				throw new RuntimeException (e);
			}
             boundaries = envelope;                
        }

        return getFactory(extraData).bbox(propertyName, boundaries);

    }

