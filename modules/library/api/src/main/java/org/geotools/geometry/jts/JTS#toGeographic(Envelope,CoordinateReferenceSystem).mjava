    /**
     * Transforms the envelope from its current crs to WGS84 coordinate reference system. If the
     * specified envelope is already in WGS84, then it is returned unchanged.
     * 
     * @param envelope
     *            The envelope to transform.
     * @param crs
     *            The CRS the envelope is currently in.
     * @return The envelope transformed to be in WGS84 CRS.
     * @throws TransformException
     *             If at least one coordinate can't be transformed.
     */
    public static Envelope toGeographic(final Envelope envelope, final CoordinateReferenceSystem crs)
            throws TransformException {
        if (CRS.equalsIgnoreMetadata(crs, DefaultGeographicCRS.WGS84)) {
            if( envelope instanceof ReferencedEnvelope){
                return envelope;
            }
            return ReferencedEnvelope.reference( envelope,  DefaultGeographicCRS.WGS84 );
        }
        ReferencedEnvelope initial = ReferencedEnvelope.reference( envelope, crs );
        return toGeographic( initial );
    }

