        /**
         * Lookup Param in a user supplied map.
         *
         * <p>Type conversion will occur if required, this may result in an IOException. An
         * IOException will be throw in the Param is required and the Map does not contain the Map.
         *
         * <p>The handle method is used to process the user's value.
         *
         * @param map Map of user input
         * @return Parameter as specified in map
         * @throws IOException if parse could not handle value
         */
        public Object lookUp(Map<String, ?> map) throws IOException {
            if (!map.containsKey(key)) {
                if (required) {
                    throw new IOException("Parameter " + key + " is required:" + description);
                } else {
                    return null;
                }
            }

            Object value = map.get(key);

            if (value == null) {
                return null;
            }

            if (value instanceof String && (type != String.class)) {
                value = handle((String) value);
            }

            if (value == null) {
                return null;
            }

            if (!type.isInstance(value)) {
                throw new IOException(
                        type.getName()
                                + " required for parameter "
                                + key
                                + ": not "
                                + value.getClass().getName());
            }

            return value;
        }

