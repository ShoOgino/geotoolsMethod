    /**
     * Cast to a ReferencedEnvelope (used to ensure that an Envelope if a ReferencedEnvelope).
     * Supporting 2d as well as 3d envelopes (returning the right class).
     * 
     * @param env The opgenis Envelope object
     * @return ReferencedEnvelope, ReferencedEnvelope3D if it is 3d,<br>
     *         results in a null/an empty envelope, if input envelope was a null/an empty envelope
     *         (by JTS Envelope definition: getMaximum(0) < getMinimum(0))
     */
    public static ReferencedEnvelope reference(org.opengis.geometry.Envelope env) {
    
        if (env == null) {
            return null;
        }
    
        if (env instanceof ReferencedEnvelope3D) {
            return (ReferencedEnvelope3D) env;
        }
    
        if (env instanceof ReferencedEnvelope) {
            return (ReferencedEnvelope) env;
        }
    
        if (env.getDimension() >= 3) {
            // emptiness test according to com.vividsolutions.jts.geom.Envelope
            if(env.getMaximum(0) < env.getMinimum(0)) {
                return new ReferencedEnvelope3D(env.getCoordinateReferenceSystem());
            } else {
                return new ReferencedEnvelope3D(env);
            }
        }
    
        // emptiness test according to com.vividsolutions.jts.geom.Envelope
        if(env.getMaximum(0) < env.getMinimum(0))
            return new ReferencedEnvelope(env.getCoordinateReferenceSystem());
        
        return new ReferencedEnvelope(env);
    }

