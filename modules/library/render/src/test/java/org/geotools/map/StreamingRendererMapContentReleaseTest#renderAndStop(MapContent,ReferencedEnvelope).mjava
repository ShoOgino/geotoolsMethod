    private void renderAndStop(MapContent content, ReferencedEnvelope bounds) {
        StreamingRenderer renderer = new StreamingRenderer();
        renderer.setMapContent(content);

        // stop rendering after 10 features
        renderer.addRenderListener(
                new RenderListener() {
                    int count = 0;

                    @Override
                    public void featureRenderer(SimpleFeature feature) {
                        count++;
                        if (count > 10) {
                            renderer.stopRendering();
                        }
                    }

                    @Override
                    public void errorOccurred(Exception e) {}
                });

        Rectangle area = new Rectangle(0, 0, 2000, 2000);
        BufferedImage img = new BufferedImage(area.width, area.height, BufferedImage.TYPE_INT_ARGB);
        renderer.paint((Graphics2D) img.getGraphics(), area, bounds);
    }

