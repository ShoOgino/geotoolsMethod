    /**
     * This tests a fix to handle Geographic CRSes (such as NAD83) whose domain of validity crosses
     * the Date Line. Previously this would cause a failure.
     */
    @Test
    public void testNAD83() throws Exception {
        CoordinateReferenceSystem nad83 = CRS.decode("EPSG:4269", true);
        ReferencedEnvelope re =
                new ReferencedEnvelope(new Envelope(-121.1, -121.0, 46.7, 46.8), nad83);
        double scale = RendererUtilities.calculateScale(re, 750, 600, 75);
        Assert.assertEquals(41470, scale, 1d);
    }

