    @Test
    public void testPaintBandSelectionNonSupportingReader() throws Exception {
        File coverageFile = TestData.copy(this, "geotiff/worldPalette.tiff");
        assertTrue(coverageFile.exists());
        GridCoverage2DReader reader = new GeoTiffReader(coverageFile);

        RasterSymbolizer rasterSymbolizer = buildChannelSelectingSymbolizer(1);
        BufferedImage bi = new BufferedImage(100, 100, BufferedImage.TYPE_3BYTE_BGR);
        GridCoverageRenderer renderer =
                new GridCoverageRenderer(
                        DefaultGeographicCRS.WGS84,
                        ReferencedEnvelope.reference(reader.getOriginalEnvelope()),
                        new Rectangle(0, 0, 100, 100),
                        null);
        Graphics2D graphics = (Graphics2D) bi.getGraphics();
        renderer.paint(
                graphics,
                reader,
                null,
                rasterSymbolizer,
                Interpolation.getInstance(Interpolation.INTERP_NEAREST),
                Color.BLACK);
        graphics.dispose();

        // check we got a gray image
        final double[] minimums = new ImageWorker(bi).getMaximums();
        final double[] maximums = new ImageWorker(bi).getMaximums();
        assertThat(maximums[0], equalTo(maximums[1]));
        assertThat(maximums[1], equalTo(maximums[2]));
        assertThat(minimums[0], equalTo(minimums[1]));
        assertThat(minimums[1], equalTo(minimums[2]));
    }

