    public void testDuplicateAndMemoize() {
        MemoryFilterOptimizer optimizer =
                new MemoryFilterOptimizer(
                        roadType, new HashSet<>(Arrays.asList(equalName, equalId)));

        final And copy = (And) and.accept(optimizer, null);
        // this time they are not memoized, but property accesses should be indexed now
        List<Filter> children = copy.getChildren();
        PropertyIsEqualTo equalNameCopy = (PropertyIsEqualTo) children.get(0);
        PropertyIsEqualTo equalIdCopy = (PropertyIsEqualTo) children.get(1);

        assertTrue(Proxy.isProxyClass(equalNameCopy.getClass()));
        assertTrue(Proxy.isProxyClass(equalIdCopy.getClass()));

        checkPropertiesIndexed(equalNameCopy, equalIdCopy);
    }

