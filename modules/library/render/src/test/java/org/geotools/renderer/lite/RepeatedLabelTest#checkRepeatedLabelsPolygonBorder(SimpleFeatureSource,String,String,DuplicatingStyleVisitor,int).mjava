    private void checkRepeatedLabelsPolygonBorder(SimpleFeatureSource features, String styleName, String testImageSuffix, DuplicatingStyleVisitor styleVisitor, int tolerance) throws Exception {
        Style style = RendererBaseTest.loadStyle(this, styleName + ".sld");
        if(styleVisitor != null) {
            style.accept(styleVisitor);
            style = (Style) styleVisitor.getCopy();
        }

        MapContent mc = new MapContent();
        mc.addLayer(new FeatureLayer(features, style));
        ReferencedEnvelope bounds = features.getBounds();
        bounds.expandBy(bounds.getWidth() / 10);
        mc.getViewport().setBounds(bounds);

        StreamingRenderer renderer = new StreamingRenderer();
        renderer.setMapContent(mc);
        renderer.setJava2DHints(new RenderingHints(KEY_ANTIALIASING, VALUE_ANTIALIAS_ON));
        renderer.setMapContent(mc);

        BufferedImage image = RendererBaseTest.renderImage(renderer, bounds, null, 500, 500);
        File expected = new File("src/test/resources/org/geotools/renderer/lite/test-data/" + styleName + "-" + testImageSuffix + ".png");
        ImageAssert.assertEquals(expected, image, tolerance);
    }

