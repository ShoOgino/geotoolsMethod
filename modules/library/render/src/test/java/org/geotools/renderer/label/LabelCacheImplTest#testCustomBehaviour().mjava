    @Test
    public void testCustomBehaviour() throws TransformException, FactoryException {
        final List<String> labels = new ArrayList<String>();
        Graphics2D graphics = Mockito.mock(Graphics2D.class);
        LabelCacheImpl myCache =
                new LabelCacheImpl() {
                    @Override
                    int paintLabel(
                            Graphics2D graphics,
                            Rectangle displayArea,
                            LabelIndex glyphs,
                            int paintedLineLabels,
                            LabelPainter painter,
                            LabelCacheItem labelItem) {
                        labels.add(labelItem.getLabel());
                        return super.paintLabel(
                                graphics,
                                displayArea,
                                glyphs,
                                paintedLineLabels,
                                painter,
                                labelItem);
                    }
                };
        TextSymbolizer ts = sb.createTextSymbolizer(Color.BLACK, (Font) null, "name");
        SimpleFeature f1 = createFeature("label1", L1);
        myCache.enableLayer(LAYER_ID);
        myCache.put(
                LAYER_ID,
                ts,
                f1,
                new LiteShape2((Geometry) f1.getDefaultGeometry(), null, null, false),
                ALL_SCALES);

        myCache.endLayer(LAYER_ID, graphics, new Rectangle(0, 0, 256, 256));
        myCache.end(graphics, new Rectangle(0, 0, 256, 256));
        assertEquals(1, labels.size());
    }

