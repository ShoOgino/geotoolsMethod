    /**
     * Test transparency is preserved when applying an RGB ChannelSelect and ContrastEnhancement
     * style to an imageMosaic with Transparent Footprint setting.
     */
    @Test
    public void testTransparentFootprintWithContrastEnhancementInChannelSelect()
            throws IOException, NoSuchAuthorityCodeException, FactoryException {
        File mosaicDirectory = prepareDirectory("footprintCECS");
        GridCoverage2D gc = readCoverage(mosaicDirectory, FootprintBehavior.Transparent, null);

        RenderedImage ri = gc.getRenderedImage();
        RenderedOp extrema = ExtremaDescriptor.create(ri, null, 1, 1, false, 1, null);
        double[] minimum = (double[]) extrema.getProperty("minimum");
        double[] maximum = (double[]) extrema.getProperty("maximum");

        // read values, not stretched, alpha is present
        assertArrayEquals(new double[] {0, 0, 0, 0}, minimum, 1E-6);
        assertArrayEquals(new double[] {54, 54, 54, 255}, maximum, 1E-6);

        GridCoverage2D output = (GridCoverage2D) symbolizeRaster(gc, "ce_cs.sld");
        ri = output.getRenderedImage();

        // Assert the alpha band has been preserved, even with a CS+CE SLD in place
        assertHasAlpha(ri);

        extrema = ExtremaDescriptor.create(ri, null, 1, 1, false, 1, null);
        minimum = (double[]) extrema.getProperty("minimum");
        maximum = (double[]) extrema.getProperty("maximum");

        // values are stretched
        assertArrayEquals(new double[] {0, 0, 0, 0}, minimum, 1E-6);
        assertArrayEquals(new double[] {255, 255, 255, 255}, maximum, 1E-6);

        disposeCoverage(output);
        ImageUtilities.disposePlanarImageChain(extrema);
    }

