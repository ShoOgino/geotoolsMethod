    private void testImage(GeoTiffReader reader, ReferencedEnvelope vaiEnvelope, String fileName)
            throws TransformException, NoninvertibleTransformException, FactoryException,
                    IOException {
        ReferencedEnvelope mapExtent = vaiEnvelope;
        Rectangle screenSize =
                new Rectangle(400, (int) (mapExtent.getHeight() / mapExtent.getWidth() * 400));
        AffineTransform w2s = RendererUtilities.worldToScreenTransform(mapExtent, screenSize);
        GridCoverageRenderer renderer =
                new GridCoverageRenderer(
                        mapExtent.getCoordinateReferenceSystem(), mapExtent, screenSize, w2s);

        RasterSymbolizer rasterSymbolizer = buildRadardStyle();

        RenderedImage image =
                renderer.renderImage(
                        reader,
                        null,
                        rasterSymbolizer,
                        Interpolation.getInstance(Interpolation.INTERP_NEAREST),
                        Color.BLACK,
                        256,
                        256);
        assertNotNull(image);
        // RenderedImageBrowser.showChain(image, true, true, "foo", true);
        File reference =
                new File(
                        "src/test/resources/org/geotools/renderer/lite/gridcoverage2d/" + fileName);
        ImageAssert.assertEquals(reference, image, 20);
    }

