    @Test
    public void testFontRangeWithUnrenderableCharsInMiddle() {
        LabelSplitter splitter = new LabelSplitter();

        String startText = "Some text ";
        // Represents two characters, namely the Ethiopic Syllable 'Na'
        // and Old South Arabian Letter 'Nun'.
        String naNun = "\u1290\ud802\ude6c";
        String endText = " here";
        String text = startText + naNun + endText;

        Font font = FontCache.getDefaultInstance().getFont("Bitstream Vera Sans");
        Font[] fonts = {font, font, font, font, font, font};

        List<FontRange> ranges = splitter.buildFontRanges(text, fonts);
        assertEquals(3, ranges.size());

        FontRange startRange = ranges.get(0);
        assertEquals(0, startRange.startChar);
        assertEquals(10, startRange.endChar);
        assertEquals(font, startRange.font);
        assertEquals(startText, startRange.text);

        FontRange middleRange = ranges.get(1);
        assertEquals(10, middleRange.startChar);
        assertEquals(13, middleRange.endChar);
        assertEquals(font, middleRange.font);
        assertEquals(naNun, middleRange.text);

        FontRange endRange = ranges.get(2);
        assertEquals(13, endRange.startChar);
        assertEquals(18, endRange.endChar);
        assertEquals(font, endRange.font);
        assertEquals(endText, endRange.text);
    }

