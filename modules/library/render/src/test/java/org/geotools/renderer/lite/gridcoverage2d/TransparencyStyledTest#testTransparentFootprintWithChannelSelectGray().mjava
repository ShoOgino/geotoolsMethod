    /**
     * Test transparency is preserved when applying a ChannelSelect (Gray) style to an imageMosaic
     * with Transparent Footprint setting.
     */
    @Test
    public void testTransparentFootprintWithChannelSelectGray()
            throws IOException, NoSuchAuthorityCodeException, FactoryException {
        File mosaicDirectory = prepareDirectory("footprintCSGray");
        GridCoverage2D gc = readCoverage(mosaicDirectory, FootprintBehavior.Transparent, null);

        GridCoverage2D output = (GridCoverage2D) symbolizeRaster(gc, "graychannel.sld");
        RenderedImage ri = output.getRenderedImage();

        // Assert the alpha band has been preserved, even with a ChannelSelect SLD in place
        ColorModel cm = ri.getColorModel();
        assertTrue(cm.hasAlpha());
        assertEquals(2, cm.getNumComponents());

        // Make sure the topleft pixel is transparent
        Raster rasterPixel = ri.getData(new Rectangle(0, 0, 1, 1));
        assertEquals(0, rasterPixel.getSample(0, 0, 1));

        disposeCoverage(output);
    }

