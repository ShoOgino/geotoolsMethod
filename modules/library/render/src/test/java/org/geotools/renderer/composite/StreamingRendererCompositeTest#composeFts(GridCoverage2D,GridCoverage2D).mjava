    private BufferedImage composeFts(GridCoverage2D first, GridCoverage2D second) {
        // build the map content
        MapContent mc = new MapContent();
        StyleBuilder sb = new StyleBuilder();
        Style baseStyle = sb.createStyle(sb.createRasterSymbolizer());
        mc.addLayer(new GridCoverageLayer(first, baseStyle));
        FeatureTypeStyle compositeFts = sb.createFeatureTypeStyle(sb.createRasterSymbolizer());
        compositeFts.getOptions().put(FeatureTypeStyle.COMPOSITE, composite);
        Style compositeStyle = sb.createStyle();
        compositeStyle.featureTypeStyles().add(compositeFts);
        mc.addLayer(new GridCoverageLayer(second, compositeStyle));

        // prepare the graphics for the streaming renderer and paint
        RenderedImage referenceImage = first.getRenderedImage();
        BufferedImage blended =
                new BufferedImage(
                        referenceImage.getWidth(),
                        referenceImage.getWidth(),
                        BufferedImage.TYPE_4BYTE_ABGR);
        Graphics2D graphics = blended.createGraphics();
        StreamingRenderer sr = new StreamingRenderer();
        sr.setMapContent(mc);
        sr.paint(
                graphics,
                new Rectangle(0, 0, referenceImage.getWidth(), referenceImage.getHeight()),
                ReferencedEnvelope.reference(first.getEnvelope()));
        graphics.dispose();
        mc.dispose();
        return blended;
    }

