    /**
     * @param rf
     * @param feature
     * @param fts
     * @param layerId
     */
    void processFeature(RenderableFeature rf, LiteFeatureTypeStyle fts) {
        try {
            // init the renderable feature for this fts
            rf.inMemoryGeneralization = fts.inMemoryGeneralization;
            rf.projectionHandler = fts.projectionHandler;
            rf.setScreenMap(fts.screenMap);
            rf.layer = fts.layer;
            rf.metaBuffer = fts.metaBuffer;

            // can the rules
            boolean doElse = true;
            Rule[] elseRuleList = fts.elseRules;
            Rule[] ruleList = fts.ruleList;
            Rule r;
            Filter filter;
            Graphics2D graphics = fts.graphics;
            // applicable rules
            final int length = ruleList.length;
            int paintCommands = 0;
            for (int t = 0; t < length; t++) {
                r = ruleList[t];
                filter = r.getFilter();

                if (filter == null || filter.evaluate(rf.feature)) {
                    doElse = false;
                    paintCommands += processSymbolizers(graphics, rf, r.symbolizers());

                    // bail out if we are in match first mode
                    if (fts.matchFirst) {
                        break;
                    }
                }
            }

            if (doElse) {
                final int elseLength = elseRuleList.length;
                for (int tt = 0; tt < elseLength; tt++) {
                    r = elseRuleList[tt];

                    paintCommands += processSymbolizers(graphics, rf, r.symbolizers());
                }
            }

            // only emit a feature drawn event if we actually painted something with it,
            // if it has been clipped out or eliminated by the screenmap we won't emit the event
            // instead
            if (paintCommands > 0) {
                requests.put(new FeatureRenderedRequest(rf.feature));
            }

        } catch (Throwable tr) {
            fireErrorEvent(tr);
        }
    }

