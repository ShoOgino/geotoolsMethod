    private Geometry getGeometryBounds(
            Icon icon, Mark mark, Shape shape, double markSize, Object feature) {
        Geometry bounds;
        if (icon != null) {
            bounds = new GeometryBuilder().box(0, 0, icon.getIconWidth(), icon.getIconHeight());
        } else {
            // the shape can be very complicated, go for the MBR. Wanted to use ShapeReader, but it
            // blindly assumes the shape is a polygon, while it may not be. Building a multipoint
            // instead
            AffineTransform at = AffineTransform.getScaleInstance(markSize, -markSize);
            Shape ts = at.createTransformedShape(shape);
            Geometry shapeGeometry = JTS.toGeometry(ts);
            bounds = new MinimumDiameter(shapeGeometry).getMinimumRectangle();
        }
        // grow by the stroke size, if this is a mark
        if (icon == null && mark != null) {
            Stroke stroke = factory.getStroke(mark.getStroke(), feature);
            if (stroke instanceof BasicStroke) {
                float width = ((BasicStroke) stroke).getLineWidth() / 2 + 1;
                if (width > 0) {
                    Geometry buffered = bounds.buffer(width);
                    bounds = new MinimumDiameter(buffered).getMinimumRectangle();
                }
            }
        }
        return bounds;
    }

