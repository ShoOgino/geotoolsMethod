    /**
     * This method performs the computation using the methods suggested by the OGC SLD
     * specification, page 26.
     *
     * @param crs the coordinate reference system. Used to check if we are operating in degrees or
     *     meters.
     * @param worldToScreen the transformation mapping world coordinates to screen coordinates.
     *     Might specify a rotation in addition to translation and scaling.
     * @return
     */
    public static double calculateOGCScaleAffine(
            CoordinateReferenceSystem crs, AffineTransform worldToScreen, Map hints) {
        double scale = XAffineTransform.getScale(worldToScreen);
        // if it's geodetic, we're dealing with lat/lon unit measures
        if (crs instanceof GeographicCRS) {
            return (OGC_DEGREE_TO_METERS * getDpi(hints)) / (scale * 0.0254);
        } else {
            return (getDpi(hints)) / (scale * 0.0254);
        }
    }

