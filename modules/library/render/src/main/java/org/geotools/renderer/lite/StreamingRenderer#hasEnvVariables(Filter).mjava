    private boolean hasEnvVariables(Filter filter) {
        if (filter == null) {
            return false;
        }
        DefaultFilterVisitor envFunctionChecker =
                new DefaultFilterVisitor() {
                    @Override
                    public Object visit(Function expression, Object data) {
                        if (Boolean.TRUE.equals(super.visit(expression, data))) {
                            return true;
                        } else {
                            return expression instanceof EnvFunction;
                        }
                    }
                };
        return Boolean.TRUE.equals(filter.accept(envFunctionChecker, null));
    }

