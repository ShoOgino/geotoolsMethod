    static double position(double x, double width, double dx, double span) {
        double ratio = dx / width;

        if (ratio < 0.3) {
            // left alignment
            return x + dx;
        } else if (ratio > 0.7) {
            // right alignment
            return x + dx - span;
        } else {
            // center alignment
            return x + dx - span / 2.0;
        }
    }

