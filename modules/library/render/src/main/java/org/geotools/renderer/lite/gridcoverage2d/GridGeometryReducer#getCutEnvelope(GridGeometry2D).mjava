    /**
     * Builds a cut envelope for the Crop operation. Since the crop internals will add back the
     * pixels we just removed due to numerical issues, we keep the envelope a bit on the safe side
     *
     * @param reduced
     * @return
     */
    public GeneralEnvelope getCutEnvelope(GridGeometry2D reduced) {
        GeneralEnvelope result;
        MathTransform2D mt = reduced.getGridToCRS2D();
        if (mt instanceof AffineTransform2D) {
            AffineTransform2D at = (AffineTransform2D) mt;
            double scaleX = Math.abs(at.getScaleX());
            double scaleY = Math.abs(at.getScaleY());
            double step = ((scaleX + scaleY) / 2.) / 10.;

            Envelope2D envelope = reduced.getEnvelope2D();
            result = new GeneralEnvelope(envelope.getCoordinateReferenceSystem());
            result.setEnvelope(
                    envelope.getMinX() + step,
                    envelope.getMinY() + step,
                    envelope.getMaxX() - step,
                    envelope.getMaxY() - step);
        } else {
            // general transform, keep it as is
            result = new GeneralEnvelope(reduced.getEnvelope());
        }

        return result;
    }

