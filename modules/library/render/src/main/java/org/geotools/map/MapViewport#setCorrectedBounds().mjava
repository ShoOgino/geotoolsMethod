    /**
     * Calculates the actual display area in world coordinates based on the
     * viewport's screen area and transforms. The resulting envelope, which will
     * have the same aspect ratio as the screen area, is then stored in the
     * {@code bounds} field.
     */
    private void setCorrectedBounds() {
        if (!screenArea.isEmpty()) {
            Point2D p0 = new Point2D.Double(screenArea.getMinX(), screenArea.getMinY());
            Point2D p1 = new Point2D.Double(screenArea.getMaxX(), screenArea.getMaxY());
            screenToWorld.transform(p0, p0);
            screenToWorld.transform(p1, p1);

            bounds = new ReferencedEnvelope(
                    Math.min(p0.getX(), p1.getX()),
                    Math.max(p0.getX(), p1.getX()),
                    Math.min(p0.getY(), p1.getY()),
                    Math.max(p0.getY(), p1.getY()),
                    bounds.getCoordinateReferenceSystem());
        }
    }

