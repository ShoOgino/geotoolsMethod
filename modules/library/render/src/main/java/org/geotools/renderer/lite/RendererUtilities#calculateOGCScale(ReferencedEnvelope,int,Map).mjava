    /**
     * This method performs the computation using the methods suggested by the OGC SLD specification, page 26.
     * @param envelope
     * @param imageWidth
     * @return
     */
    public static double calculateOGCScale(ReferencedEnvelope envelope, int imageWidth, Map hints) {
        // if it's geodetic, we're dealing with lat/lon unit measures
        if(envelope.getCoordinateReferenceSystem() instanceof GeographicCRS) {
            return (envelope.getWidth() * OGC_DEGREE_TO_METERS) / (imageWidth / getDpi(hints) * 0.0254);
        } else {
            return envelope.getWidth() / (imageWidth / getDpi(hints) * 0.0254);
        }
    }

