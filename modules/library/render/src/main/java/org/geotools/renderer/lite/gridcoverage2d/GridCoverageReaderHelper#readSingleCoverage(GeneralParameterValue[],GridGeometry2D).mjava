    /**
     * Reads a single coverage given the specified read parameters and the grid geometry
     *
     * @param readParams (might be null)
     * @param gg
     * @return
     * @throws IOException
     */
    GridCoverage2D readSingleCoverage(GeneralParameterValue[] readParams, GridGeometry2D gg)
            throws IOException {
        // setup the grid geometry param that will be passed to the reader
        final Parameter<GridGeometry2D> readGGParam =
                (Parameter<GridGeometry2D>) AbstractGridFormat.READ_GRIDGEOMETRY2D.createValue();
        readGGParam.setValue(new GridGeometry2D(gg));

        // then I try to get read parameters associated with this
        // coverage if there are any.
        GridCoverage2D coverage = null;
        if (readParams != null) {
            // //
            //
            // Getting parameters to control how to read this coverage.
            // Remember to check to actually have them before forwarding
            // them to the reader.
            //
            // //
            final int length = readParams.length;
            if (length > 0) {
                // we have a valid number of parameters, let's check if
                // also have a READ_GRIDGEOMETRY2D. In such case we just
                // override it with the one we just build for this
                // request.
                final String name = AbstractGridFormat.READ_GRIDGEOMETRY2D.getName().toString();
                int i = 0;
                for (; i < length; i++) {
                    if (readParams[i].getDescriptor().getName().toString().equalsIgnoreCase(name))
                        break;
                }
                // did we find anything?
                if (i < length) {
                    // we found another READ_GRIDGEOMETRY2D, let's override it.
                    readParams[i] = readGGParam;
                    coverage = reader.read(readParams);
                } else {
                    // add the correct read geometry to the supplied
                    // params since we did not find anything
                    GeneralParameterValue[] readParams2 = new GeneralParameterValue[length + 1];
                    System.arraycopy(readParams, 0, readParams2, 0, length);
                    readParams2[length] = readGGParam;
                    coverage = reader.read(readParams2);
                }
            } else
                // we have no parameters hence we just use the read grid
                // geometry to get a coverage
                coverage = reader.read(new GeneralParameterValue[] {readGGParam});
        } else if (gg != null) {
            coverage = reader.read(new GeneralParameterValue[] {readGGParam});
        } else {
            coverage = reader.read(null);
        }

        // try to crop on the requested area

        return coverage;
    }

