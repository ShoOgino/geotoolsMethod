    private double evalToDouble(Expression exp, Object f, double fallback) {
        if (exp == null) {
            return fallback;
        }
        Double d = exp.evaluate(f, Double.class);
        if (d != null && !Double.isNaN(d)) {
            return d.doubleValue();
        }
        return fallback;
    }

