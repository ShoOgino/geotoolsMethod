    /** Builds a SortKey Comparator from a SortBy array */
    static Comparator buildComparator(SortBy[] sortBy) {
        // sanity check
        if (sortBy == SortBy.UNSORTED || sortBy == null) {
            throw new IllegalArgumentException("Expected to get a sort, but found none");
        }

        // build a list of comparators
        List<java.util.Comparator<?>> comparators = new ArrayList<>();
        for (SortBy sb : sortBy) {
            if (sb.getSortOrder() == SortOrder.ASCENDING) {
                comparators.add(FORWARD_COMPARATOR);
            } else {
                comparators.add(REVERSE_COMPARATOR);
            }
        }

        @SuppressWarnings("unchecked")
        java.util.Comparator<Object>[] componentComparators =
                comparators.toArray(new java.util.Comparator[comparators.size()]);
        return new Comparator(componentComparators);
    }

