    /** */
    private GridCoverage2D affine(
            GridCoverage2D input, double[] bkgValues, RasterSymbolizer symbolizer) {
        // NOTICE that at this stage the image we get should be 8 bits, either RGB, RGBA, Gray,
        // GrayA either multiband or indexed. It could also be 16 bits indexed!!!!

        Hints localHints = new Hints();
        localHints.putAll(hints);
        if (symbolizer != null && symbolizer.getColorMap() != null) {
            localHints.put(JAI.KEY_REPLACE_INDEX_COLOR_MODEL, false);
        }
        // Preserve the sample dimensions names when no symbolizer get used
        // Styles using GridCoverage's named properties may not find them if renamed
        final boolean useInputSampleDimensions = symbolizer == null;
        GridCoverage2D gc =
                GridCoverageRendererUtilities.affine(
                        input,
                        interpolation,
                        finalWorldToGrid,
                        bkgValues,
                        useInputSampleDimensions,
                        gridCoverageFactory,
                        localHints);
        if (DEBUG && gc != null && gc.getRenderedImage() != null) {
            writeRenderedImage(gc.getRenderedImage(), "postAffine");
        }
        return gc;
    }

