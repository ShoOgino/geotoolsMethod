        public DiskMarkFeatureIterator(List<Feature> features, FeatureIterator fi,
                SimpleFeatureType schema, ProgressListener listener) throws IOException {
            File file = File.createTempFile("z-ordered-", ".features");
            this.io = new SimpleFeatureIO(file, schema);

            // dump all the features in memory
            for (Feature feature : features) {
                if (listener.isCanceled()) {
                    break;
                }
                io.write((SimpleFeature) feature);
                featureCount++;
            }

            // dump all the subsequent ones
            while (fi.hasNext() && !listener.isCanceled()) {
                Feature feature = fi.next();
                io.write((SimpleFeature) feature);
                featureCount++;
            }
            // do not close the iterator, the caller does that

            // reset to the beginning of the file
            io.seek(0);
        }

