    @Test
    public void cache() throws Exception {
        // expect failure when downloading disabled
        {
            SchemaCache cache = new SchemaCache(CACHE_DIRECTORY, false);
            String location = cache.resolveLocation(SCHEMA_LOCATION);
            Assert.assertNull(location);
        }
        // should succeed if able to download
        {
            SchemaCache cache = new SchemaCache(CACHE_DIRECTORY, true);
            String location = cache.resolveLocation(SCHEMA_LOCATION);
            Assert.assertNotNull(location);
            Assert.assertTrue(location.startsWith("file:"));
            Assert.assertTrue(location.endsWith(SCHEMA_FILENAME));
            Assert.assertTrue(URLs.urlToFile((new URI(location)).toURL()).exists());
        }
        // now that schema is is in the cache, should succeed even if downloading is disabled
        {
            SchemaCache cache = new SchemaCache(CACHE_DIRECTORY, false);
            String location = cache.resolveLocation(SCHEMA_LOCATION);
            Assert.assertNotNull(location);
            Assert.assertTrue(location.startsWith("file:"));
            Assert.assertTrue(location.endsWith(SCHEMA_FILENAME));
            Assert.assertTrue(URLs.urlToFile((new URI(location)).toURL()).exists());
            // test that cache path is not canonical
            Assert.assertFalse(CACHE_DIRECTORY.toString()
                    .equals(CACHE_DIRECTORY.getCanonicalFile().toString()));
            // test that resolved location is canonical, despite cache directory not being canonical
            Assert.assertEquals(location, URLs.urlToFile((new URI(location)).toURL())
                    .getCanonicalFile().toURI().toString());
        }
    }

