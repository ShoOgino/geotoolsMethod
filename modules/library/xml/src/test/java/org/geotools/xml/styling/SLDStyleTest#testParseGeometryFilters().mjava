    /**
     * Verifies that geometry filters inside SLD documents are correctly parsed.
     *
     * @throws IOException boom
     */
    @Test
    public void testParseGeometryFilters() throws IOException {
        final String TYPE_NAME = "testType";
        final String GEOMETRY_ATTR = "Polygons";
        Style[] styles = getStyles("spatialFilter.xml");

        final int expectedStyleCount = 1;
        Assert.assertEquals(expectedStyleCount, styles.length);

        Style notDisjoint = styles[0];
        Assert.assertEquals(1, notDisjoint.featureTypeStyles().size());

        FeatureTypeStyle fts = notDisjoint.featureTypeStyles().get(0);
        Assert.assertEquals(TYPE_NAME, fts.featureTypeNames().iterator().next().getLocalPart());
        Assert.assertEquals(1, fts.rules().size());

        Filter filter = fts.rules().get(0).getFilter();
        Assert.assertTrue(filter instanceof Not);

        Filter spatialFilter = ((Not) filter).getFilter();
        Assert.assertTrue(spatialFilter instanceof Disjoint);

        Disjoint disjoint = (Disjoint) spatialFilter;
        Expression left = disjoint.getExpression1();
        Expression right = disjoint.getExpression2();

        Assert.assertTrue(left instanceof PropertyName);

        Assert.assertTrue(right instanceof Literal);
        Assert.assertTrue(right.evaluate(null) instanceof Geometry);

        Assert.assertEquals(GEOMETRY_ATTR, ((PropertyName) left).getPropertyName());
        Assert.assertTrue(right.evaluate(null) instanceof Polygon);

        Envelope bbox = ((Polygon) right.evaluate(null)).getEnvelopeInternal();
        Assert.assertEquals(-10D, bbox.getMinX(), 0);
        Assert.assertEquals(-10D, bbox.getMinY(), 0);
        Assert.assertEquals(10D, bbox.getMaxX(), 0);
        Assert.assertEquals(10D, bbox.getMaxY(), 0);
    }

