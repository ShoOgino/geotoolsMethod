    public void testStrictlyLegalFilter() throws Exception {
        FilterFactory2 factory = CommonFactoryFinder.getFilterFactory2(null);
        Filter nullFilter1 = factory.isNull(factory.property("att"));

        Filter nullFilter2 = factory.isNull(factory.property("name"));
        Filter compareFilter = factory.equals(factory.property("name"), factory.literal(3));

        Filter filter = factory.and(nullFilter2, nullFilter1);
        filter = factory.not(filter);
        filter = factory.or(filter, compareFilter);

        // Test Low compliance
        FilterEncodingPreProcessor visitor =
                new FilterEncodingPreProcessor(XMLHandlerHints.VALUE_FILTER_COMPLIANCE_LOW);
        filter.accept(visitor, null);

        assertEquals(filter, visitor.getFilter());
        assertEquals(createFidFilter(), visitor.getFidFilter());
        assertFalse(visitor.requiresPostProcessing());

        // Test Medium level compliance.
        visitor = new FilterEncodingPreProcessor(XMLHandlerHints.VALUE_FILTER_COMPLIANCE_MEDIUM);
        filter.accept(visitor, null);

        assertEquals(filter, visitor.getFilter());
        assertEquals(createFidFilter(), visitor.getFidFilter());
        assertFalse(visitor.requiresPostProcessing());

        // Test High level compliance
        visitor = new FilterEncodingPreProcessor(XMLHandlerHints.VALUE_FILTER_COMPLIANCE_HIGH);
        filter.accept(visitor, null);

        assertEquals(filter, visitor.getFilter());
        assertEquals(createFidFilter(), visitor.getFidFilter());
        assertFalse(visitor.requiresPostProcessing());
    }

