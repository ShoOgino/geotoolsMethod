    /**
     * Entry Point to Document writer.
     *
     * <p>Hints:
     *
     * <ul>
     *   <li>WRITE_SCHEMA - (Writer) will be used to write the schema
     *   <li>BASE_ELEMENT - (Element) mapping of value to element instance
     *   <li>USE_NEAREST - (Boolean) not implemented
     *   <li>SCHEMA_ORDER - (String[] or Schema[]) resolve ambiguity & import
     * </ul>
     *
     * @param value
     * @param schema
     * @param w
     * @param hints optional hints for writing
     * @throws OperationNotSupportedException
     * @throws IOException
     */
    public static void writeDocument(Object value, Schema schema, Writer w, Map hints)
            throws OperationNotSupportedException, IOException {
        if ((hints != null) && hints.containsKey(WRITE_SCHEMA)) {
            @SuppressWarnings("PMD.CloseResource")
            Writer w2 = (Writer) hints.get(WRITE_SCHEMA);
            writeSchema(schema, w2, hints);
        }

        WriterContentHandler wch =
                new WriterContentHandler(schema, w, hints); // should deal with xmlns declarations
        wch.startDocument();

        writeFragment(value, wch);

        wch.endDocument();
        w.flush();
    }

