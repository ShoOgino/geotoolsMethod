    /*
     * Convenience method to create an instance of a SAXParser if it is null.
     */
    private static SAXParser getParser(boolean parseExternalEntities) throws SAXException {
        SAXParserFactory spf = SAXParserFactory.newInstance();
        spf.setNamespaceAware(true);
        spf.setValidating(false);

        try {
            if(!parseExternalEntities) {
                // The following configuration prevents XML External Entity Injection (XXE) attacks
                // See for more information:
                // https://www.owasp.org/index.php/XML_External_Entity_(XXE)_Processing
                spf.setFeature("http://xml.org/sax/features/external-general-entities", false);
                spf.setFeature("http://xml.org/sax/features/external-parameter-entities", false);
            }

            SAXParser sp = spf.newSAXParser();
            return sp;
        } catch (ParserConfigurationException e) {
            throw new SAXException(e);
        }
    }

