    /**
     * Adds a collection of features to the store.
     * <p>
     * This method operates by getting an appending feature writer and writing 
     * all the features in <tt>collection</tt> to it. Directly after a feature 
     * is written its id is obtained and added to the returned set.
     * </p>
     */
    public List<FeatureId> addFeatures(Collection collection)
        throws IOException {
        
        // gather up id's
    	List<FeatureId> ids = new ArrayList<FeatureId>(collection.size());

    	FeatureWriter<SimpleFeatureType, SimpleFeature> writer = getWriterAppend();
        try {
            for ( Iterator f = collection.iterator(); f.hasNext(); ) {
                FeatureId id = addFeature((SimpleFeature) f.next(), writer);
                ids.add( id );
            }
        } finally {
            writer.close();
        }
        
        return ids;
    }

