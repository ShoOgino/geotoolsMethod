    /**
     * A replacement for {@link File#toURL()} and <code>File.toURI().toURL()</code>.
     * <p>
     * {@link File#toURL()} does not percent-encode characters and <code>File.toURI().toURL()</code> does not percent-encode non-ASCII characters.
     * This method ensures that URL characters are correctly percent-encoded, and works around the reported misbehaviour of some Java implementations
     * on Mac.
     * 
     * @param file
     * @return URL
     */
    public static URL fileToUrl(File file) {
        try {
            // URI.toString() and thus URI.toURL() do not
            // percent-encode non-ASCII characters [GEOT-5737]
            String string = file.toURI().toASCIIString();
            if (string.contains("+")) {
                // this represents an invalid URL created using either
                // file.toURL(); or
                // file.toURI().toURL() on a specific version of Java 5 on Mac
                string = string.replace("+", "%2B");
            }
            if (string.contains(" ")) {
                // this represents an invalid URL created using either
                // file.toURL(); or
                // file.toURI().toURL() on a specific version of Java 5 on Mac
                string = string.replace(" ", "%20");
            }
            return new URL(string);
        } catch (MalformedURLException e) {
            return null;
        }
    }

