    /** Returns the smallest class capable to hold the specified value. */
    public static Class<? extends Number> getFinestClass(final double value) {
        final long lg = (long) value;
        if (value == lg) {
            if (lg >= Byte.MIN_VALUE && lg <= Byte.MAX_VALUE) return Byte.class;
            if (lg >= Short.MIN_VALUE && lg <= Short.MAX_VALUE) return Short.class;
            if (lg >= Integer.MIN_VALUE && lg <= Integer.MAX_VALUE) return Integer.class;
            if (lg >= Long.MIN_VALUE && lg <= Long.MAX_VALUE) return Long.class;
        }
        final float fv = (float) value;
        if (value == (double) fv) {
            return Float.class;
        }
        return Double.class;
    }

