    /**
     * Adds a string for the given locale.
     *
     * @param locale The locale for the {@code string} value, or {@code null}.
     * @param string The localized string.
     * @throws IllegalArgumentException if a different string value was already set for the given
     *     locale.
     */
    public synchronized void add(final Locale locale, final String string)
            throws IllegalArgumentException {
        if (string != null) {
            switch (localMap.size()) {
                case 0:
                    {
                        localMap = Collections.singletonMap(locale, string);
                        defaultValue = null; // Will be recomputed when first needed.
                        return;
                    }
                case 1:
                    {
                        localMap = new HashMap<Locale, String>(localMap);
                        break;
                    }
            }
            String old = localMap.get(locale);
            if (old != null) {
                if (string.equals(old)) {
                    return;
                }
                // TODO: provide a localized message "String value already set for locale ...".
                throw new IllegalArgumentException();
            }
            localMap.put(locale, string);
            defaultValue = null; // Will be recomputed when first needed.
        }
    }

