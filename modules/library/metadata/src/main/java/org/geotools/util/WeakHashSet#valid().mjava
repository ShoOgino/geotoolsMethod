    /**
     * Checks if this {@code WeakHashSet} is valid. This method counts the number of elements and
     * compare it to {@link #count}. If the check fails, the number of elements is corrected (if we
     * didn't, an {@link AssertionError} would be thrown for every operations after the first error,
     * which make debugging more difficult). The set is otherwise unchanged, which should help to
     * get similar behaviour as if assertions hasn't been turned on.
     */
    private boolean valid() {
        int n = 0;
        for (Entry entry : table) {
            for (Entry e = entry; e != null; e = e.next) {
                n++;
            }
        }
        if (n != count) {
            count = n;
            return false;
        } else {
            return true;
        }
    }

