    /**
     * Registers the specified instance under all categories that are supertypes of the instance.
     *
     * @param instance The instance to register.
     */
    @SuppressWarnings("unchecked")
    public <T> void registerInstance(final T instance) {
        ensureArgumentNonNull("instance", instance);
        streamCategories()
                .filter(category -> category.isAssignableFrom(instance.getClass()))
                // the cast is correct because the filter above only leaves categories that are
                // supertypes of `instance`
                .map(category -> (InstanceRegistry<? super T>) instanceRegistry(category))
                .forEach(registry -> registry.register(instance));
    }

