    /**
     * Sorts the elements in the given array and return their ranks. See class description for
     * details.
     *
     * @param <T> The type of elements in the array to be sorted.
     * @param source The array of values to sort, or {@code null}.
     * @param target The array where to store sorted values, or {@code null} if none. May be the
     *     same array than {@code source}, in which case the sorting will be performed in place.
     * @return The value ranks, or {@code null} if {@code source} was null.
     * @see Arrays#sort(Object[])
     */
    public static <T extends Comparable<T>> int[] ranks(final T[] source, final T[] target) {
        if (source == null) {
            return null;
        }
        final Any[] entries = new Any[source.length];
        for (int i = 0; i < entries.length; i++) {
            entries[i] = new Any<T>(i, source[i]);
        }
        final int[] ranks = ranks(entries);
        if (target != null) {
            for (int i = Math.min(entries.length, target.length); --i >= 0; ) {
                @SuppressWarnings("unchecked")
                final Any<T> entry = (Any<T>) entries[i];
                target[i] = entry.value;
            }
        }
        return ranks;
    }

