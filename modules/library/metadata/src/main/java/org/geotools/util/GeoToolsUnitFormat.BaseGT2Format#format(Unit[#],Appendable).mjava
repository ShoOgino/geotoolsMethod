        public Appendable format(Unit<?> unit, Appendable appendable) throws IOException {
            String name = this.nameFor(unit);
            if (name != null) {
                return appendable.append(name);
            } else if (!(unit instanceof ProductUnit)) {
                throw new IllegalArgumentException("Cannot format given Object as a Unit");
            } else {
                ProductUnit<?> productUnit = (ProductUnit) unit;
                boolean start = true;

                int i;
                int pow;
                int root;
                for (i = 0; i < productUnit.getUnitCount(); ++i) {
                    pow = productUnit.getUnitPow(i);
                    if (!start) {
                        appendable.append('*');
                    }

                    name = this.nameFor(productUnit.getUnit(i));
                    root = productUnit.getUnitRoot(i);
                    this.append(appendable, name, pow, root);
                    start = false;
                }

                return appendable;
            }
        }

