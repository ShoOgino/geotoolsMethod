    /** Counts the number of non-null properties. */
    public int count(final Object metadata, final int max) {
        assert type.isInstance(metadata) : metadata;
        int count = 0;
        for (Method getter : getters) {
            if (!isEmpty(get(getter, metadata))) {
                if (++count >= max) {
                    break;
                }
            }
        }
        return count;
    }

