    @Test
    public void testLookupWithExtendedClasspath() {
        URL url = getClass().getResource("foo.jar");
        assertNotNull(url);
        
        FactoryRegistry reg = new FactoryCreator( DummyInterface.class );
        Stream<DummyInterface> factories = reg.getFactories(DummyInterface.class, false);
        assertFalse(factories.findAny().isPresent());

        URLClassLoader cl = new URLClassLoader(new URL[]{url});
        GeoTools.addClassLoader(cl);
        reg.scanForPlugins();

        Set<String> classes = reg
				.getFactories(DummyInterface.class, false)
				.map(factory -> factory.getClass().getName())
				.collect(toSet());

        assertEquals(2, classes.size());
        assertTrue(classes.contains("pkg.Foo"));
        assertTrue(classes.contains("org.geotools.factory.DummyInterfaceImpl"));
    }

