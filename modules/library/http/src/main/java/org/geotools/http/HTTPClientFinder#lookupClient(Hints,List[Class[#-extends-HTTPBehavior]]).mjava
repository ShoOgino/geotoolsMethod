    private static synchronized HTTPClient lookupClient(
            Hints hints, final List<Class<? extends HTTPBehavior>> behaviors) {
        if (hints == null) {
            throw new IllegalArgumentException("hints can't be null.");
        }
        if (behaviors == null) {
            throw new IllegalArgumentException("behaviors can't be null.");
        }

        if (System.getProperty("http.proxyHost") != null) {
            behaviors.add(HTTPProxy.class);
        }

        return getServiceRegistry()
                .getFactories(HTTPClientFactory.class, null, null)
                .filter((fact) -> matchHttpFactoryHints(fact, hints))
                .filter((fact) -> matchHttpClientHintsBehaviors(fact, hints, behaviors))
                .filter((fact) -> matchDefault(fact, hints, behaviors))
                .findFirst()
                .orElseThrow(
                        () ->
                                new HTTPFactoryException(
                                        "Couldn't create HTTP client.", hints, behaviors))
                .createClient(hints, behaviors);
    }

