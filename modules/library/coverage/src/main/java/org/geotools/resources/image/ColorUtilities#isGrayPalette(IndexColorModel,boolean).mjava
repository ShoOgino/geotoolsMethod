    /**
     * Tells us if a specific {@link IndexColorModel} contains only gray color
     * or not, ignoring alpha information.
     *
     * @param  icm {@link IndexColorModel} to be inspected.
     * @param  ignoreTransparents {@code true} if the RGB values of fully transparent pixels
     *         (the ones with an {@linkplain IndexColorModel#getAlpha(int) alpha} value of 0)
     *         should not be taken in account during the check for gray color.
     * @return {@code true} if the palette is grayscale, {@code false} otherwise.
     */
    public static boolean isGrayPalette(final IndexColorModel icm, boolean ignoreTransparents) {
        if (!icm.hasAlpha()) {
            // We will not check transparent pixels if there is none in the color model.
            ignoreTransparents = false;
        }
        final int mapSize = icm.getMapSize();
        for (int i=0; i<mapSize; i++) {
            if (ignoreTransparents) {
                // If this entry is transparent and we were asked
                // to check transparents pixels, let's leave.
                if (icm.getAlpha(i) == 0) {
                    continue;
                }
            }
            // Get the color for this pixel only if it is requested.
            // If gray, all components are the same.
            final int green = icm.getGreen(i);
            if (green != icm.getRed(i) || green != icm.getBlue(i)) {
                return false;
            }
        }
        return true;
    }

