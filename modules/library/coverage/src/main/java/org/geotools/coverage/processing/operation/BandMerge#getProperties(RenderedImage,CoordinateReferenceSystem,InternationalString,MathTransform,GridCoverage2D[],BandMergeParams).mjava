    @SuppressWarnings("unchecked")
    protected Map getProperties(
            RenderedImage data,
            CoordinateReferenceSystem crs,
            InternationalString name,
            MathTransform toCRS,
            GridCoverage2D[] sources,
            BandMergeParams parameters) {
        // Merge the coverage properties
        Map properties = new HashMap();

        for (GridCoverage2D cov : sources) {
            if (cov != null && cov.getProperties() != null) {
                properties.putAll(cov.getProperties());
            }
        }

        // Setting ROI and NoData if present
        if (JAIExt.isJAIExtOperation("BandMerge")) {
            ParameterBlockJAI pb = parameters.parameters;
            CoverageUtilities.setROIProperty(properties, (ROI) pb.getObjectParameter(3));
            CoverageUtilities.setNoDataProperty(properties, pb.getObjectParameter(1));
        }

        return properties;
    }

