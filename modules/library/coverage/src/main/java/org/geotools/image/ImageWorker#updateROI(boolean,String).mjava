    /**
     * Update the ROI by extracting it from the current image using the underlying property
     * generator (when specified)
     *
     * @param forceUpdate update the ROI no matter if the original roi was is null.
     * @param opName if not null, get the property from the underlying property generator
     */
    private void updateROI(boolean forceUpdate, String opName) {
        // getting the new ROI property
        if (forceUpdate || roi != null) {
            Object prop = null;
            if (opName != null) {
                // Extract the roi using a property generator
                PropertyGenerator gen =
                        getOperationDescriptor(opName)
                                .getPropertyGenerators(RenderedRegistryMode.MODE_NAME)[0];
                prop = gen.getProperty("roi", image);
            } else {
                // extract the roi from the image
                prop = image.getProperty("roi");
            }
            // Actual ROI update
            if (prop != null && prop instanceof ROI) {
                setROI((ROI) prop);
            } else {
                setROI(null);
            }
        }
    }

