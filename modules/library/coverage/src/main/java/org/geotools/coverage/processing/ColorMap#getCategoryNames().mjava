    /**
     * Returns all category names declared in this color map, in alphabetical order.
     * If the {@link #ANY_QUANTITATIVE_CATEGORY} special value is presents, it will
     * appears last.
     */
    private CharSequence[] getCategoryNames() {
        final Set<String> names;
        if (colorMap != null) {
            if (colorRanges != null) {
                names = new HashSet<String>(colorMap.keySet());
                names.addAll(colorRanges.keySet());
            } else {
                names = colorMap.keySet();
            }
        } else {
            if (colorRanges != null) {
                names = colorRanges.keySet();
            } else {
                names = Collections.emptySet();
            }
        }
        int count = names.size();
        final CharSequence[] asArray = names.toArray(new CharSequence[count]);
        for (int i=count; --i>=0;) {
            if (asArray[i] == null) {
                System.arraycopy(asArray, i+1, asArray, i, --count-i);
                asArray[count] = ANY_QUANTITATIVE_CATEGORY;
                // We could stop the loop here since we should not have any additional
                // null values. However we let the loop continue as a paranoiac check.
            }
        }
        Arrays.sort(asArray, 0, count);
        return asArray;
    }

