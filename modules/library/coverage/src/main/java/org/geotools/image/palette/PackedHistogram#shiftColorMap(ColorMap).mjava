    /**
     * Shifts every color in the map by one more bit and repacks the color map accordingly
     * 
     * @param colorMap
     */
    private void shiftColorMap(ColorMap colorMap) {
        ColorMap shifted = new ColorMap();
        for (ColorEntry entry : colorMap) {
            int color = entry.color;
            int count = entry.value;
            int alpha = shift(alpha(color), 1);
            int red = shift(red(color), 1);
            int green = shift(green(color), 1);
            int blue = shift(blue(color), 1);

            shifted.increment(red, green, blue, alpha, count);
        }

        assert countPixels(colorMap) == countPixels(shifted);

        colorMap.reset(shifted);
    }

