    /**
     * Updates the provided metatag to the GeoKey directory.
     *
     * @param keyID the GeoTiff metatag id
     * @param tag the TIFF tag to which this points to
     * @param count the new count value
     * @param offset the new offset value inside the tiff tag or 0 if the value is embeeded
     * @return the updated {@link GeoKeyEntry}.
     */
    private GeoKeyEntry updateGeoKeyEntry(int keyID, int tag, int count, int offset) {
        if (!isTiffUShort(keyID)) {
            throw new IllegalArgumentException("keyID is not a TIFF USHORT");
        }

        if (!isTiffUShort(tag)) {
            throw new IllegalArgumentException("tag is not a TIFF USHORT");
        }

        if (!isTiffUShort(count)) {
            throw new IllegalArgumentException("count is not a TIFF USHORT");
        }

        if (!isTiffUShort(offset)) {
            throw new IllegalArgumentException("offset is not a TIFF USHORT");
        }

        final GeoKeyEntry element = new GeoKeyEntry(keyID, tag, count, offset);
        // replacing
        final int valuesRemoved = geoTiffEntries.removeAll(keyID); // purge old values for this tag
        assert valuesRemoved == 1;
        geoTiffEntries.add(Integer.valueOf(keyID), element);
        return element;
    }

