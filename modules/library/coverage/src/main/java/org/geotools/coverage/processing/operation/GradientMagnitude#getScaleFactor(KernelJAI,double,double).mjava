    /**
     * Returns a scale factor for the supplied kernel. If {@code kernel} computes horizontal
     * grandient, this method returns {@code scaleX}. Otherwise, if {@code kernel} computes
     * vertical gradient, then this method returns {@code scaleY}. Otherwise, returns a geometric
     * combinaison of both.
     */
    private static double getScaleFactor(final KernelJAI kernel, double scaleX, double scaleY) {
        scaleX *= scaleX;
        scaleY *= scaleY;
        double factorX = getNormalizationFactorSquared(kernel, HORIZONTAL);
        double factorY = getNormalizationFactorSquared(kernel, VERTICAL);
        double factor2 = (factorX*scaleX + factorY*scaleY) / (factorX+factorY);
        return Math.sqrt(factor2);
    }

