    /**
     * Returns a bit count for an {@link IndexColorModel} mapping {@code mapSize} colors. It is
     * guaranteed that the following relation is hold:
     *
     * <p><center>
     *
     * <pre>(1 << getBitCount(mapSize)) >= mapSize</pre>
     *
     * </center>
     */
    public static int getBitCount(final int mapSize) {
        int max = mapSize - 1;
        if (max <= 1) {
            return 1;
        }
        int count = 0;
        do {
            count++;
            max >>= 1;
        } while (max != 0);
        assert (1 << count) >= mapSize : mapSize;
        assert (1 << (count - 1)) < mapSize : mapSize;
        return count;
    }

