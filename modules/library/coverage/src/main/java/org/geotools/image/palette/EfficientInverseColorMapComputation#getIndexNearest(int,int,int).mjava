    /**
     * This method is responsible for doing the actual lookup that given an rgb triple returns the
     * best, taking into account quantization, index in the forward color map.
     *
     * @param red component.
     * @param green component.
     * @param blue component.
     * @return the best, taking into account quantization, index in the forward color map for the
     *     provided triple.
     */
    public int getIndexNearest(int red, int green, int blue) {
        return mapBuf[
                        ((red << (2 * bits - truncationBits)) & redQuantizationMask)
                                + ((green << (1 * bits - truncationBits)) & greenQuantizationMask)
                                + ((blue >> (truncationBits)) & blueQuantizationMask)]
                & 0xFF;
    }

