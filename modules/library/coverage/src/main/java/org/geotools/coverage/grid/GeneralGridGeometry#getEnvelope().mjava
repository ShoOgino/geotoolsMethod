    /**
     * Returns the bounding box of "real world" coordinates for this grid geometry. This envelope is
     * the {@linkplain #getGridRange grid range} {@linkplain #getGridToCoordinateSystem transformed}
     * to the "real world" coordinate system.
     *
     * @return The bounding box in "real world" coordinates (never {@code null}).
     * @throws InvalidGridGeometryException if this grid geometry has no envelope (i.e. <code>
     *     {@linkplain #isDefined isDefined}({@linkplain #ENVELOPE_BITMASK})</code> returned {@code
     *     false}).
     * @see GridGeometry2D#getEnvelope2D
     */
    public Envelope getEnvelope() throws InvalidGridGeometryException {
        if (envelope != null && !envelope.isNull()) {
            assert isDefined(ENVELOPE_BITMASK);
            return envelope.clone();
        }
        assert !isDefined(ENVELOPE_BITMASK);
        throw new InvalidGridGeometryException(
                gridToCRS == null
                        ? ErrorKeys.UNSPECIFIED_TRANSFORM
                        : ErrorKeys.UNSPECIFIED_IMAGE_SIZE);
    }

