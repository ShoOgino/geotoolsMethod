    /**
     * Returns a compatible sample model. This implementation is nearly identical to default J2SE's
     * implementation, except that it construct a JAI color model instead of a J2SE one.
     */
    public SampleModel createCompatibleSampleModel(final int w, final int h) {
        switch (transferType) {
            default:
                {
                    return super.createCompatibleSampleModel(w, h);
                }
            case DataBuffer.TYPE_FLOAT: // fall through
            case DataBuffer.TYPE_DOUBLE:
                {
                    final int numComponents = getNumComponents();
                    final int[] bandOffsets = new int[numComponents];
                    for (int i = 0; i < numComponents; i++) {
                        bandOffsets[i] = i;
                    }
                    return new ComponentSampleModelJAI(
                            transferType, w, h, numComponents, w * numComponents, bandOffsets);
                }
        }
    }

