    /**
     * Returns {@code true} if the image colormodel must be expanded for the operation.
     * 
     * @param image The image to reproject.
     * @param hints The {@link Hints} used during the reprojection.
     */
    private static boolean isColorModelExpanded(final RenderedImage image, final Hints hints) {

        if (image.getColorModel() instanceof IndexColorModel) {
            if (hints != null && hints.containsKey(JAI.KEY_REPLACE_INDEX_COLOR_MODEL)) {
                Boolean replace = (Boolean) hints.get(JAI.KEY_REPLACE_INDEX_COLOR_MODEL);
                if (replace != null) {
                    return replace;
                }
            }
        }
        return false;
    }

