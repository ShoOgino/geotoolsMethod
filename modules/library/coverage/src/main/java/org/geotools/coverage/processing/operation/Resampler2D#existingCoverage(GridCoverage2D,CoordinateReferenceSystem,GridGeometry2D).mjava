    /*
     * If the source coverage is already the result of a previous "Resample" operation,
     * go up in the chain and check if a previously computed image could fits (i.e. the
     * requested resampling may be the inverse of a previous resampling).
     */
    private static GridCoverage2D existingCoverage(GridCoverage2D coverage,
              CoordinateReferenceSystem targetCRS, GridGeometry2D targetGG)
    {
        // NoData and ROI must be handled
        ROI roiProp = CoverageUtilities.getROIProperty(coverage);
        Object nodataProp = CoverageUtilities.getNoDataProperty(coverage);
        boolean hasROI = (roiProp != null);
        boolean hasNoData = (nodataProp != null);
        if (hasROI || hasNoData) {
            return null;
        }
        while (!equivalent(coverage.getGridGeometry(), targetGG) ||
              (!CRS.equalsIgnoreMetadata(targetCRS, coverage.getCoordinateReferenceSystem()) &&
               !CRS.equalsIgnoreMetadata(targetCRS, coverage.getCoordinateReferenceSystem2D())))
        {
            if (!(coverage instanceof Resampler2D)) {
                return null;
            }

            final List<GridCoverage> sources = coverage.getSources();
            assert sources.size() == 1 : sources;
            coverage = (GridCoverage2D) sources.get(0);
        }
        return coverage;
    }

