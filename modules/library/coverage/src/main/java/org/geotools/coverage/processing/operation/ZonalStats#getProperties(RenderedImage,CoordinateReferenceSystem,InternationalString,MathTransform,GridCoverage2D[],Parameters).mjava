    /**
     * Prepare the properties for this ZonalStats operation.
     *
     * @see OperationJAI#getProperties(RenderedImage, CoordinateReferenceSystem,
     *     InternationalString, MathTransform, GridCoverage2D[],
     *     org.geotools.coverage.processing.OperationJAI.Parameters),
     */
    protected Map<String, ?> getProperties(
            RenderedImage data,
            CoordinateReferenceSystem crs,
            InternationalString name,
            MathTransform toCRS,
            GridCoverage2D[] sources,
            Parameters parameters) {
        // /////////////////////////////////////////////////////////////////////
        //
        // If and only if data is a RenderedOp we prepare the properties for
        // minimum and maximum as the output of the extrema operation.
        //
        // /////////////////////////////////////////////////////////////////////
        if (data instanceof RenderedOp) {
            final RenderedOp result = (RenderedOp) data;
            final Map<String, Object> synthProp = new HashMap<>();

            // get the properties
            final double[] minimums = (double[]) result.getProperty(GT_SYNTHETIC_PROPERTY_MIN);
            if (minimums != null) synthProp.put(GT_SYNTHETIC_PROPERTY_MIN, minimums);
            final double[] maximums = (double[]) result.getProperty(GT_SYNTHETIC_PROPERTY_MAX);
            if (maximums != null) synthProp.put(GT_SYNTHETIC_PROPERTY_MAX, maximums);
            final double[] means = (double[]) result.getProperty(GT_SYNTHETIC_PROPERTY_MEAN);
            if (means != null) synthProp.put(GT_SYNTHETIC_PROPERTY_MEAN, means);
            final double[] var = (double[]) result.getProperty(GT_SYNTHETIC_PROPERTY_VAR);
            if (var != null) synthProp.put(GT_SYNTHETIC_PROPERTY_VAR, var);
            final double[] sdev = (double[]) result.getProperty(GT_SYNTHETIC_PROPERTY_SDEV);
            if (sdev != null) synthProp.put(GT_SYNTHETIC_PROPERTY_SDEV, sdev);
            final double[] range = (double[]) result.getProperty(GT_SYNTHETIC_PROPERTY_RANGE);
            if (range != null) synthProp.put(GT_SYNTHETIC_PROPERTY_RANGE, range);
            final double[] median = (double[]) result.getProperty(GT_SYNTHETIC_PROPERTY_MEDIAN);
            if (median != null) synthProp.put(GT_SYNTHETIC_PROPERTY_MEDIAN, median);
            final double[] approx_median =
                    (double[]) result.getProperty(GT_SYNTHETIC_PROPERTY_APPROX_MEDIAN);
            if (approx_median != null)
                synthProp.put(GT_SYNTHETIC_PROPERTY_APPROX_MEDIAN, approx_median);
            final double[] sum = (double[]) result.getProperty(GT_SYNTHETIC_PROPERTY_SUM);
            if (sum != null) synthProp.put(GT_SYNTHETIC_PROPERTY_SUM, sum);

            // return the map
            return Collections.unmodifiableMap(synthProp);
        }
        return super.getProperties(data, crs, name, toCRS, sources, parameters);
    }

