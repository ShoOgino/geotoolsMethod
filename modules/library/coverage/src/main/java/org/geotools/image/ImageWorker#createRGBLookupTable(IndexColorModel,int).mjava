    private LookupTable createRGBLookupTable(IndexColorModel icm, int numDestinationBands) {
        final int mapSize = icm.getMapSize();
        // Even if starting from a 16bits paletted image, RGB will go to bytes
        final byte[][] data = new byte[numDestinationBands][mapSize];
        for (int i = 0; i < mapSize; i++) {
            data[0][i] = (byte) (icm.getRed(i) & 0xFF);
            data[1][i] = (byte) (icm.getGreen(i) & 0xFF);
            data[2][i] = (byte) (icm.getBlue(i) & 0xFF);
            if (numDestinationBands == 4) {
                data[3][i] = (byte) (icm.getAlpha(i) & 0xFF);
            }
        }
        return LookupTableFactory.create(data);
    }

