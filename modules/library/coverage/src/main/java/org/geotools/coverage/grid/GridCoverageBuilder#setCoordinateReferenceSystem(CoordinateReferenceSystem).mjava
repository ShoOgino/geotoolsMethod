    /**
     * Sets the coordinate reference system to the specified value. If an {@linkplain #setEnvelope
     * envelope was previously defined}, it will be reprojected to the new CRS.
     *
     * @throws IllegalArgumentException if the CRS is illegal for the {@linkplain #getEnvelope
     *     current envelope}.
     */
    public void setCoordinateReferenceSystem(final CoordinateReferenceSystem crs)
            throws IllegalArgumentException {
        if (envelope == null) {
            if (crs != null) {
                envelope = wrap(CRS.getEnvelope(crs));
                if (envelope == null) {
                    envelope = new GeneralEnvelope(crs);
                    envelope.setToNull();
                }
            }
        } else
            try {
                envelope = wrap(CRS.transform(envelope, crs));
            } catch (TransformException exception) {
                throw new IllegalArgumentException(
                        Errors.format(ErrorKeys.ILLEGAL_COORDINATE_REFERENCE_SYSTEM), exception);
            }
        coverage = null;
    }

