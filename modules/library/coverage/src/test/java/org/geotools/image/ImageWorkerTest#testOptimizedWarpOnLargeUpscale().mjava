    @Test
    public void testOptimizedWarpOnLargeUpscale() throws Exception {
        BufferedImage bi = new BufferedImage(4, 4, BufferedImage.TYPE_BYTE_INDEXED);
        GridCoverage2D source = new GridCoverageFactory().create("Test", bi, new ReferencedEnvelope(0, 1, 0, 1, DefaultGeographicCRS.WGS84));
        GridCoverage2D coverage = project(source, CRS.parseWKT(GOOGLE_MERCATOR_WKT), null,
                "nearest", null);
        RenderedImage ri = coverage.getRenderedImage();
        
        checkTileSize(ri, AffineTransform.getScaleInstance(100, 100));
        checkTileSize(ri, new AffineTransform(100, 0, 0, 100, 10, 10));
    }

