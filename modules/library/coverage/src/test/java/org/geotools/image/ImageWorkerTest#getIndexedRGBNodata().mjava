    /** Creates a test paletted image with nodata and no transparency */
    private static RenderedImage getIndexedRGBNodata() {
        // a palette with just the first 200 entries filled, the others are all zero (but present!)
        final byte[] bb = new byte[256];
        for (int i = 0; i < 256; i++) {
            if (i < 200) {
                bb[i] = (byte) i;
            } else {
                bb[i] = (byte) 0;
            }
        }
        int noDataValue = 200;
        NoDataContainer noData = new NoDataContainer(noDataValue);
        final IndexColorModel icm = new IndexColorModel(8, 256, bb, bb, bb);
        final WritableRaster raster =
                RasterFactory.createWritableRaster(
                        icm.createCompatibleSampleModel(1024, 1024), null);
        for (int i = raster.getMinX(); i < raster.getMinX() + raster.getWidth(); i++) {
            for (int j = raster.getMinY(); j < raster.getMinY() + raster.getHeight(); j++) {
                if (i - raster.getMinX() < raster.getWidth() / 2) {
                    raster.setSample(i, j, 0, (i + j) / 32);
                } else {
                    raster.setSample(i, j, 0, 200);
                }
            }
        }
        BufferedImage bi = new BufferedImage(icm, raster, false, null);
        PlanarImage planarImage = PlanarImage.wrapRenderedImage(bi);
        planarImage.setProperty(NoDataContainer.GC_NODATA, noData);
        return planarImage;
    }

