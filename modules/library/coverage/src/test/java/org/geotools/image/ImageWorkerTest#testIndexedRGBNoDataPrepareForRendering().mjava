    @Test
    public void testIndexedRGBNoDataPrepareForRendering() {
        RenderedImage image = getIndexedRGBNodata();
        ImageWorker iw = new ImageWorker(image);
        iw.prepareForRendering();
        RenderedImage expanded = iw.getRenderedImage();

        // nodata forced expansion
        assertTrue(expanded.getColorModel() instanceof ComponentColorModel);
        assertTrue(expanded.getColorModel().hasAlpha());
        assertNoData(expanded, null);
        // check the value has been made transparent
        assertEquals(
                0,
                expanded.getData()
                        .getSample(
                                expanded.getMinX() + expanded.getWidth() / 3 * 2,
                                expanded.getMinY(),
                                3));
    }

