    /** Tests the "SelectSampleDimension" operation in a more complex way. */
    @Test
    public void testBandSelect() throws TransformException {
        final CoverageProcessor processor = CoverageProcessor.getInstance();
        /*
         * Get the source coverage and build the cropped envelope.
         */
        final GridCoverage2D source = EXAMPLES.get(2);
        final Envelope envelope = source.getEnvelope();
        final RenderedImage rgbImage =
                new ImageWorker(source.getRenderedImage())
                        .forceComponentColorModel()
                        .getRenderedImage();
        final SampleModel sm = rgbImage.getSampleModel();
        final ColorModel cm = rgbImage.getColorModel();
        final int numBands = sm.getNumBands();
        final GridSampleDimension[] bands = new GridSampleDimension[numBands];
        // setting bands names.
        for (int i = 0; i < numBands; i++) {
            final ColorInterpretation colorInterpretation = TypeMap.getColorInterpretation(cm, i);
            if (colorInterpretation == null) fail("Unrecognized sample dimension type");
            bands[i] = new GridSampleDimension(colorInterpretation.name());
        }
        final GridCoverage2D newCoverage =
                CoverageFactoryFinder.getGridCoverageFactory(null)
                        .create("sample", rgbImage, envelope, bands, null, null);
        assertEquals(3, newCoverage.getNumSampleDimensions());

        /*
         * Do the band select on band 0
         */
        ParameterValueGroup param = processor.getOperation("SelectSampleDimension").getParameters();
        param.parameter("Source").setValue(newCoverage);
        param.parameter("SampleDimensions").setValue(new int[] {0});
        GridCoverage2D singleBanded = (GridCoverage2D) processor.doOperation(param);
        if (SHOW) {
            Viewer.show(source);
            Viewer.show(singleBanded);
        } else {
            // Force computation
            assertNotNull(
                    PlanarImage.wrapRenderedImage(singleBanded.getRenderedImage()).getTiles());
        }
        RenderedImage raster = singleBanded.getRenderedImage();
        assertEquals(1, raster.getSampleModel().getNumBands());
        assertNotNull(raster.getColorModel());

        /*
         * Do the crop without conserving the envelope.
         */
        param = processor.getOperation("SelectSampleDimension").getParameters();
        param.parameter("Source").setValue(newCoverage);
        param.parameter("SampleDimensions").setValue(new int[] {2});
        singleBanded = (GridCoverage2D) processor.doOperation(param);
        if (SHOW) {
            Viewer.show(source);
            Viewer.show(singleBanded);
        } else {
            // Force computation
            assertNotNull(
                    PlanarImage.wrapRenderedImage(singleBanded.getRenderedImage()).getTiles());
        }
        raster = singleBanded.getRenderedImage();
        assertEquals(1, raster.getSampleModel().getNumBands());
        assertNotNull(raster.getColorModel());
    }

