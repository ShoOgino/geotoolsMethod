    /**
     * Compares the envelopes of two coverages for equality using the smallest
     * scale factor of their "grid to world" transform as the tolerance.
     *
     * @param expected The coverage having the expected envelope.
     * @param actual   The coverage having the actual envelope.
     */
    protected static void assertEnvelopeEquals(Coverage expected, Coverage actual) {
        final double scaleA = getScale(expected);
        final double scaleB = getScale(actual);
        final double tolerance;
        if (scaleA <= scaleB) {
            tolerance = scaleA;
        } else if (!Double.isNaN(scaleB)) {
            tolerance = scaleB;
        } else {
            tolerance = EPS;
        }
        assertTrue(getGeneralEnvelope(expected).equals(actual.getEnvelope(), tolerance, false));
    }

