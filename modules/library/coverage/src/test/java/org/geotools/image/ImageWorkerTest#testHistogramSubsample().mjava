    @Test
    public void testHistogramSubsample() {
        // increase the subsampling factor, it should lead to progressive deterioration of
        // the extracted stats values. Images and workers are re-created over and over, since
        // the worker attaches the stats to the image as a property (so a new one is needed to
        // force re-calculation.
        // In this case we have actual counts, so they will have to go down accordingly too
        assertHistogram(getSynthetic(1000), 1, 1, 5408, 5487, 5475);
        assertHistogram(getSynthetic(1000), 2, 2, 1372, 1384, 1339);
        assertHistogram(getSynthetic(1000), 4, 4, 324, 363, 336);
        assertHistogram(getSynthetic(1000), 8, 8, 83, 85, 87);
        assertHistogram(getSynthetic(1000), 16, 16, 22, 18, 23);
        assertHistogram(getSynthetic(1000), 32, 32, 6, 5, 4);
    }

