    private GridCoverage2D testCrop(final GridCoverage2D source) {
        final CoverageProcessor processor = CoverageProcessor.getInstance();
        /*
         * Get the source coverage and build the cropped envelope.
         */

        final Envelope oldEnvelope = source.getEnvelope();
        final GeneralEnvelope cropEnvelope =
                new GeneralEnvelope(
                        new double[] {
                            oldEnvelope.getMinimum(0) + oldEnvelope.getSpan(0) * 3 / 8,
                            oldEnvelope.getMinimum(1) + oldEnvelope.getSpan(1) * 3 / 8
                        },
                        new double[] {
                            oldEnvelope.getMinimum(0) + oldEnvelope.getSpan(0) * 5 / 8,
                            oldEnvelope.getMinimum(1) + oldEnvelope.getSpan(1) * 5 / 8
                        });
        cropEnvelope.setCoordinateReferenceSystem(oldEnvelope.getCoordinateReferenceSystem());
        /*
         * Do the crop without conserving the envelope.
         */
        ParameterValueGroup param = processor.getOperation("CoverageCrop").getParameters();
        param.parameter("Source").setValue(source);
        param.parameter("Envelope").setValue(cropEnvelope);
        GridCoverage2D cropped = (GridCoverage2D) processor.doOperation(param);
        if (SHOW) {
            Viewer.show(coverage);
            Viewer.show(cropped);
        } else {
            // Force computation
            assertNotNull(PlanarImage.wrapRenderedImage(cropped.getRenderedImage()).getTiles());
        }
        RenderedImage raster = cropped.getRenderedImage();
        assertEquals(168, raster.getMinX());
        assertEquals(172, raster.getMinY());
        assertEquals(114, raster.getWidth());
        assertEquals(116, raster.getHeight());
        assertEquals(
                source.getGridGeometry().getGridToCRS2D(),
                cropped.getGridGeometry().getGridToCRS2D());
        assertNotEquals(cropEnvelope, cropped.getEnvelope());

        // check we did not use mosaic for this simple case
        RenderedOp op = (RenderedOp) raster;
        assertEquals("Crop", op.getOperationName());

        // check there is no ROI set (none in input, none in output)
        assertEquals(java.awt.Image.UndefinedProperty, raster.getProperty("ROI"));

        return cropped;
    }

