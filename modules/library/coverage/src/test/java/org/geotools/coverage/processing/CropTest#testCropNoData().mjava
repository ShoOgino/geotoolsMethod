    @Test
    public void testCropNoData() {
        Map<String, Object> properties = new HashMap<>();
        final Double theNoData = new Double(-123);
        CoverageUtilities.setNoDataProperty(properties, theNoData);
        GridCoverage2D source = new GridCoverageFactory().create(coverage.getName().toString(), coverage.getRenderedImage(), coverage.getEnvelope(), coverage.getSampleDimensions(), null, properties);
        
        // check the grid coverage
        GridCoverage2D cropped = testCrop(source);
        NoDataContainer noData = CoverageUtilities.getNoDataProperty(cropped);
        assertEquals(theNoData, noData.getAsSingleValue(), 0d);
        
        // but also check the image
        RenderedImage renderedImage = cropped.getRenderedImage();
        Object property = renderedImage.getProperty(NoDataContainer.GC_NODATA);
        assertNotEquals(property, Image.UndefinedProperty);
        assertThat(property, instanceOf(NoDataContainer.class));
        NoDataContainer nd = (NoDataContainer) property;
        assertEquals(-123, nd.getAsSingleValue(), 0d);
    }

