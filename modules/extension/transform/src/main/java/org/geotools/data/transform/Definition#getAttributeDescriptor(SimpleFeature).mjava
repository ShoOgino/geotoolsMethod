    /**
     * Computes the output attribute descriptor for this {@link Definition} given a sample feature
     * of the original feature type. The code will first attempt a static analysis on the original
     * feature type, if that fails it will try to evaluate the expression on the sample feature.
     */
    public AttributeDescriptor getAttributeDescriptor(SimpleFeature originalFeature) {
        // try the static analysis
        AttributeDescriptor ad = getAttributeDescriptor(originalFeature.getFeatureType());
        if (ad != null) {
            return ad;
        }

        // build it from the sample then
        AttributeTypeBuilder ab = new AttributeTypeBuilder();
        Object result = expression.evaluate(originalFeature);
        Class computedBinding = null;
        if (result != null) {
            computedBinding = result.getClass();
        }

        CoordinateReferenceSystem computedCRS = crs;
        if (Geometry.class.isAssignableFrom(computedBinding) && computedCRS == null) {
            computedCRS = evaluateCRS(originalFeature);
        }

        ab.setBinding(computedBinding);
        ab.setName(name);
        if (computedCRS != null) {
            ab.setCRS(computedCRS);
        }

        return ab.buildDescriptor(name);
    }

