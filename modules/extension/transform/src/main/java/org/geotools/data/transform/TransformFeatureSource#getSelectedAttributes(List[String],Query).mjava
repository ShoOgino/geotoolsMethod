    /** Returns the set of names actually selected by the query */
    private List<String> getSelectedAttributes(List<String> attributeNames, Query query) {
        if (query.getPropertyNames() == null) {
            return attributeNames;
        }
        List<String> pnames = Arrays.asList(query.getPropertyNames());
        List<String> result = new ArrayList<String>();
        for (String an : attributeNames) {
            if (pnames.contains(an)) {
                result.add(an);
            }
        }

        return result;
    }

