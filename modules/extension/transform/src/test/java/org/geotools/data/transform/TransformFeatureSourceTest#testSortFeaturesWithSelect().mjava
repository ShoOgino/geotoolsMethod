    @Test
    public void testSortFeaturesWithSelect() throws Exception {
        SimpleFeatureSource transformed = transformWithSelection();

        SortBy[] sortBy = {FF.sort("state_name", SortOrder.DESCENDING)};

        // check we can sort
        assertTrue(transformed.getQueryCapabilities().supportsSorting(sortBy));

        // and now with a specific one, here the property feature source will return null values
        Query q = new Query("states_mini");
        q.setSortBy(sortBy);
        q.setMaxFeatures(2);
        SimpleFeatureCollection fc = transformed.getFeatures(q);
        assertEquals(transformed.getSchema(), fc.getSchema());
        assertEquals(2, fc.size());

        // and now read for good
        List<String> names = new ArrayList<>();
        try (SimpleFeatureIterator fi = fc.features()) {
            while (fi.hasNext()) {
                SimpleFeature f = fi.next();
                names.add((String) f.getAttribute("state_name"));
            }
        }

        assertEquals(2, names.size());
        assertEquals("West Virginia", names.get(0));
        assertEquals("Virginia", names.get(1));
    }

