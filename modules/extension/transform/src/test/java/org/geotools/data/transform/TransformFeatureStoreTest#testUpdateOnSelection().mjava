    @Test
    public void testUpdateOnSelection() throws Exception {
        SimpleFeatureStore transformed = (SimpleFeatureStore) transformWithSelection();

        // modify the feature
        transformed.modifyFeatures("persons", 0, CQL.toFilter("state_name = 'Illinois'"));

        // check it has been modified
        assertEquals(1, STATES.getFeatures(new Query(null, CQL.toFilter("persons = 0"))).size());
        SimpleFeatureCollection rfc =
                transformed.getFeatures(new Query(null, CQL.toFilter("persons = 0")));
        assertEquals(1, rfc.size());

        // double check the features themselves
        try (SimpleFeatureIterator fi = rfc.features()) {
            assertTrue(fi.hasNext());
            SimpleFeature sf = fi.next();
            assertEquals("Illinois", sf.getAttribute("state_name"));
        }
    }

