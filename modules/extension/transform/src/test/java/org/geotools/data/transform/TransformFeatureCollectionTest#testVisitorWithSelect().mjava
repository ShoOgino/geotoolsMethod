    @Test
    public void testVisitorWithSelect() throws Exception {
        SimpleFeatureSource transformed = transformWithSelection();

        CountVisitor countVisitor = new CountVisitor();
        MinVisitor minVisitor = new MinVisitor("male");
        MaxVisitor maxVisitor = new MaxVisitor("male");
        UniqueVisitor uniqueVisitor = new UniqueVisitor("female");
        BoundsVisitor boundsVisitor = new BoundsVisitor();

        FeatureCalc[] visitors = {
            countVisitor, minVisitor, maxVisitor, uniqueVisitor, boundsVisitor
        };
        boolean[] expectedPass = {true, true, true, true, false};
        Object[] expectedResult = {
            10,
            282970d,
            5552233d,
            new HashSet<>(
                    Arrays.asList(
                            1663099.0, 1262929.0, 343200.0, 2462797.0, 2356394.0, 931941.0,
                            323930.0, 3149703.0, 5878369.0, 2652758.0)),
            new ReferencedEnvelope(
                    -109.047821, -75.045998, 35.989586, 42.50936100000001, CRS.decode("EPSG:4326"))
        };

        checkVisitorApplication(transformed, visitors, expectedPass, expectedResult);
    }

