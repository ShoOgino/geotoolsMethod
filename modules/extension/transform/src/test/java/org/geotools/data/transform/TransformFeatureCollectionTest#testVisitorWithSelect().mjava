    @Test
    public void testVisitorWithSelect() throws Exception {
        Query query = new Query(STORE_NAME);
        SimpleFeatureSource transformed = transformWithSelection();

        CountVisitor countVisitor = new CountVisitor();
        MinVisitor minVisitor = new MinVisitor("male");
        MaxVisitor maxVisitor = new MaxVisitor("male");
        UniqueVisitor uniqueVisitor = new UniqueVisitor("female");
        BoundsVisitor boundsVisitor = new BoundsVisitor();
        boolean passedDown = false;

        FeatureCalc[] visitors = {
            countVisitor, minVisitor, maxVisitor, uniqueVisitor, boundsVisitor
        };
        boolean[] expectedPass = {true, true, true, true, false};

        for (int i = 0; i < visitors.length; i++) {
            ((TransformFeatureStoreWrapper) transformed).setPassedDown(false);
            transformed.getFeatures(query).accepts(visitors[i], null);
            passedDown = ((TransformFeatureStoreWrapper) transformed).isPassedDown();
            assertTrue(expectedPass[i] == passedDown);
        }
    }

