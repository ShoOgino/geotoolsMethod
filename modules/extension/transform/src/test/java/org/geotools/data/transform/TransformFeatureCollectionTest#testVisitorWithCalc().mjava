    @Test
    public void testVisitorWithCalc() throws Exception {
        Query query = new Query(STORE_NAME);
        SimpleFeatureSource transformed = transformWithExpressions();

        CountVisitor countVisitor = new CountVisitor();
        MinVisitor minVisitor = new MinVisitor("total");
        MaxVisitor maxVisitor = new MaxVisitor("total");
        UniqueVisitor uniqueVisitor = new UniqueVisitor("geom");
        BoundsVisitor boundsVisitor = new BoundsVisitor();
        boolean passedDown = false;

        FeatureCalc[] visitors = {
            countVisitor, minVisitor, maxVisitor, uniqueVisitor, boundsVisitor
        };
        boolean[] expectedPass = {true, false, false, false, false};

        for (int i = 0; i < visitors.length; i++) {
            ((TransformFeatureStoreWrapper) transformed).setPassedDown(false);
            transformed.getFeatures(query).accepts(visitors[i], null);
            passedDown = ((TransformFeatureStoreWrapper) transformed).isPassedDown();
            assertTrue(expectedPass[i] == passedDown);
        }
    }

