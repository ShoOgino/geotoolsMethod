    private int getCountNestedFilter(
            JoiningJDBCFeatureSource source, Query targetQuery, FeatureTypeMapping mapping)
            throws IOException {
        // wrap the query in the Joining one to have the unmapping visitor
        // setting the ids
        JoiningQuery unrollQuery =
                (JoiningQuery) unrollQuery(new JoiningQuery(targetQuery), mapping);
        unrollQuery.setRootMapping(mapping);
        return source.getCount(unrollQuery);
    }

