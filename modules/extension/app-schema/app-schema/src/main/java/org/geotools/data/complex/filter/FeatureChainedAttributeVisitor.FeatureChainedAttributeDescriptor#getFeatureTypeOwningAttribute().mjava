        /**
         * Returns the feature type where the mapping configuration of the nested attribute is
         * defined.
         *
         * <p>In practice, this is the last linked feature type in the chain, except when the last
         * chaining is done by reference (via an xlink:href attribute), in which case the second
         * last feature type is returned.
         *
         * @return
         */
        public FeatureTypeMapping getFeatureTypeOwningAttribute() {
            FeatureChainLink lastLink = getLastLink();
            FeatureTypeMapping featureMapping = lastLink.getFeatureTypeMapping();
            if (lastLink.isChainingByReference()) {
                // last attribute xpath should be resolved against the parent feature
                if (lastLink.previous() != null) {
                    featureMapping = lastLink.previous().getFeatureTypeMapping();
                }
            }
            return featureMapping;
        }

