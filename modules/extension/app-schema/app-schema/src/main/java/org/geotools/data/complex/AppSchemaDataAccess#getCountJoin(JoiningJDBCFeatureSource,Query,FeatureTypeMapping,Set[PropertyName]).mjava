    private int getCountJoin(
            JoiningJDBCFeatureSource source,
            Query targetQuery,
            FeatureTypeMapping mapping,
            Set<PropertyName> propertyNames)
            throws IOException {
        List<FeatureChainedAttributeDescriptor> featureChainDescriptors =
                getFeatureChainedDescriptorsFromFilter(mapping, propertyNames);
        // wrap the query in the Joining one to have the unmapping visitor
        // setting the ids
        JoiningQuery unrollQuery =
                (JoiningQuery) unrollQuery(new JoiningQuery(targetQuery), mapping);
        JoiningQuery joining = buildJoiningQuery(featureChainDescriptors, unrollQuery, mapping);
        return source.getCount(joining);
    }

