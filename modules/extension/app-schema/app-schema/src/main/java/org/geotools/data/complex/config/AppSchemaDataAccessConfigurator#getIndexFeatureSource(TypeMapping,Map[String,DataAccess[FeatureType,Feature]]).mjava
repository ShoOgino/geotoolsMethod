    /**
     * If an external index (e.g. Solr) is used by the provided feature type mapping, this method
     * will retrieve the corresponding data store definition, otherwise NULL will be returned. If
     * the data source cannot be found an exception will be throw.
     */
    private FeatureSource<FeatureType, Feature> getIndexFeatureSource(
            TypeMapping dto, Map<String, DataAccess<FeatureType, Feature>> sourceDataStores)
            throws IOException {
        String dsId = dto.getIndexDataStore();
        String typeName = dto.getIndexTypeName();

        // let's check if an external index (e.g. Solr) was configured
        if (StringUtils.isEmpty(dsId) || StringUtils.isEmpty(typeName)) return null;

        DataAccess<FeatureType, Feature> sourceDataStore = sourceDataStores.get(dsId);
        if (sourceDataStore == null) {
            throw new DataSourceException(
                    "datastore " + dsId + " not found for type mapping " + dto);
        }

        Name name = Types.degloseName(typeName, namespaces);
        FeatureSource fSource = sourceDataStore.getFeatureSource(name);
        if (fSource == null) {
            throw new RuntimeException("Feature source not found '" + typeName + "'.");
        }
        if (fSource instanceof XmlFeatureSource) {
            ((XmlFeatureSource) fSource).setNamespaces(namespaces);
        }
        return fSource;
    }

