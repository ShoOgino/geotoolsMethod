    /**
     * Initialize the index FeatureCollection and iterator
     *
     * @throws IOException
     */
    protected void initializeIndexIterator() throws IOException {
        // rebuild Query to fetch only id attributes:
        Query idQuery = transformQueryToIdsOnly();
        FeatureCollection<SimpleFeatureType, SimpleFeature> fc =
                mapping.getIndexSource().getFeatures(idQuery);
        // if denormalized index:
        if (isDenormalized()) {
            indexIterator = new IndexUniqueVisitorIterator(fc, idQuery, getFidIndexName());
        } else {
            indexIterator = new IndexFeatureIdIterator(fc.features());
        }
    }

