    /**
     * Test we can {@link Schemas#findSchemas(Configuration)} with a catalog plus cache. This test
     * verifies the fall-through behaviour of the catalog even when a schema is sought inside the
     * scope of the catalog rewrite rules but is not contained in the catalog.
     */
    @Test
    public void catalogCache() throws Exception {
        File cacheDirectory = URLs.urlToFile(AppSchemaConfigurationTest.class
                .getResource("/test-data/cache"));
        SchemaResolver resolver = new SchemaResolver(SchemaCatalog.build(getClass()
                .getResource("/test-data/catalog.xml")), new SchemaCache(cacheDirectory, false));
        Configuration configuration = new AppSchemaConfiguration(
                "http://schemas.example.org/catalog-test",
                "http://schemas.example.org/catalog-test/catalog-cache-test.xsd", resolver);
        SchemaIndex schemaIndex = null;
        try {
            schemaIndex = Schemas.findSchemas(configuration);
            Assert.assertEquals(3, schemaIndex.getSchemas().length);
            String schemaLocation = null;
            for (XSDSchema schema : schemaIndex.getSchemas()) {
                if (schema.getSchemaLocation().endsWith("catalog-cache-test.xsd")) {
                    schemaLocation = schema.getSchemaLocation();
                    break;
                }
            }
            Assert.assertNotNull(schemaLocation);
            Assert.assertTrue(schemaLocation.startsWith("file:"));
            Assert.assertTrue(URLs.urlToFile(new URL(schemaLocation)).exists());
            Assert.assertNotNull(schemaIndex.getElementDeclaration(new QName(
                    "http://schemas.example.org/demo", "GeologicUnit")));
            // test that relative include can be resolved
            Assert.assertNotNull(schemaIndex.getElementDeclaration(new QName(
                    "http://schemas.example.org/demo", "InnerGeologicUnit")));
        } finally {
            if (schemaIndex != null) {
                schemaIndex.destroy();
            }
        }
    }

