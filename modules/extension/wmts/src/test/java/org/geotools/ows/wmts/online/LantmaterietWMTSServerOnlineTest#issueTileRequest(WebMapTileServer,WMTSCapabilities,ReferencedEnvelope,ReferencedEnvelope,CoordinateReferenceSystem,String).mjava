    private Set<Tile> issueTileRequest(
            WebMapTileServer wmts,
            WMTSCapabilities capabilities,
            ReferencedEnvelope bboxes,
            ReferencedEnvelope requested,
            CoordinateReferenceSystem crs,
            String layerName)
            throws ServiceException {
        WMTSLayer layer = capabilities.getLayer(layerName);
        assertNotNull(layer);
        GetTileRequest request = wmts.createGetTileRequest();
        layer.setBoundingBoxes(new CRSEnvelope(bboxes));
        layer.setSrs(layer.getBoundingBoxes().keySet());
        request.setLayer(layer);

        request.setRequestedWidth(800);
        request.setRequestedHeight(400);
        request.setCRS(crs);
        request.setRequestedBBox(requested);

        return wmts.issueRequest(request);
    }

