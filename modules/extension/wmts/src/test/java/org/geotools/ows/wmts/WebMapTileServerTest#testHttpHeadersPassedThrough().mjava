    @Test
    public void testHttpHeadersPassedThrough() throws Exception {

        WebMapTileServer server =
                new WebMapTileServer(
                        new URL("http://dummy.net/"),
                        new CheckHeadersHttpClient(),
                        createCapabilities("getcapa_kvp.xml"));
        GetTileRequest request = server.createGetTileRequest();
        request.getHeaders().put("Authorization", "dummy");

        final CoordinateReferenceSystem crs = DefaultGeographicCRS.WGS84;
        request.setCRS(crs);
        request.setLayer(server.getCapabilities().getLayer("spearfish"));
        request.setRequestedBBox(new ReferencedEnvelope(-103.878, -103.729, 44.396, 44.456, crs));
        request.setRequestedWidth(1000);

        Set<Tile> tiles = request.getTiles();
        Assert.assertFalse(tiles.isEmpty());

        tiles.iterator().next().getBufferedImage();
    }

