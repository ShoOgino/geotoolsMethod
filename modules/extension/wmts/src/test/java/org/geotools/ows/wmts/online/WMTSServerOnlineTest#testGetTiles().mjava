    @Test
    public void testGetTiles()
            throws IOException, ServiceException, FactoryException, TransformException {
        WebMapTileServer wmts = new WebMapTileServer(server);

        WMTSCapabilities capabilities = wmts.getCapabilities();

        CoordinateReferenceSystem crs = CRS.decode("EPSG:3857");
        ReferencedEnvelope envelope =
                new ReferencedEnvelope(
                        181896.32913603852,
                        1086312.9422175875,
                        6091282.433471196,
                        7689478.305598114,
                        crs);

        // envelope to request tiles for 5th zoom level
        ReferencedEnvelope re1 =
                new ReferencedEnvelope(
                        -9772.986997677013,
                        3743054.020110313,
                        6674950.119413431,
                        1.042777712652142E7,
                        crs);
        Set<Tile> responses =
                issueTileRequest(wmts, capabilities, envelope, re1, crs, "topowebb_nedtonad");
        assertFalse(responses.isEmpty());
        for (Tile response : responses) {
            // checking the identifier
            assertTrue(response.getId().startsWith("wmts_5"));
            re1.contains(response.getExtent().toBounds(re1.getCoordinateReferenceSystem()));
        }
        // envelope to request tiles for 7th zoom level
        ReferencedEnvelope re2 =
                new ReferencedEnvelope(
                        381146.49290940526,
                        1441515.582157366,
                        7403037.65074037,
                        9279451.154294366,
                        crs);
        Set<Tile> responses2 =
                issueTileRequest(wmts, capabilities, envelope, re2, crs, "topowebb_nedtonad");
        for (Tile response : responses2) {
            // checking the identifier
            assertTrue(response.getId().startsWith("wmts_7"));
            re2.contains(response.getExtent().toBounds(re2.getCoordinateReferenceSystem()));
        }
    }

