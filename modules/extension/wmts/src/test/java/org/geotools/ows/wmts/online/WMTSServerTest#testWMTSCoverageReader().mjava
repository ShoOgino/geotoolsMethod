    @Test
    public void testWMTSCoverageReader()
            throws IOException, ServiceException, FactoryException, TransformException {
        WebMapTileServer wmts = new WebMapTileServer(server);
        WMTSCapabilities capabilities = wmts.getCapabilities();
        CoordinateReferenceSystem crs = CRS.decode("EPSG:25833");
        // layer bboxes
        ReferencedEnvelope envelope =
                new ReferencedEnvelope(-2500000.0, 4766446.53289, 3479816.86767, 9045984.0, crs);

        // first envelope 5th zoom level
        ReferencedEnvelope re1 =
                new ReferencedEnvelope(
                        0.0, 469103.37588849873, 6345722.619929184, 6704879.892093816, crs);
        RenderedImage ri1 =
                getRenderImageResult(
                        wmts, capabilities, envelope, re1, "Trafikkportalen_GeocacheTrafikkJPG");
        File img1 = new File(getClass().getResource("wmtsTestResultZoom5.png").getFile());
        ImageAssert.assertEquals(img1, ri1, 50);
        // second envelope 7th zoomLevel
        ReferencedEnvelope re2 =
                new ReferencedEnvelope(
                        100965.20193007682,
                        274362.8820587485,
                        6600975.109986092,
                        6658887.225809376,
                        crs);
        RenderedImage ri2 =
                getRenderImageResult(
                        wmts, capabilities, envelope, re2, "Trafikkportalen_GeocacheTrafikkJPG");
        File img2 = new File(getClass().getResource("wmtsTestResultZoom7.png").getFile());
        ImageAssert.assertEquals(img2, ri2, 50);
    }

