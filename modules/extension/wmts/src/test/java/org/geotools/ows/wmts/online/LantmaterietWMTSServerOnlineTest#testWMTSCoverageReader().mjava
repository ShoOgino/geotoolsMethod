    @Test
    public void testWMTSCoverageReader()
            throws IOException, ServiceException, FactoryException, TransformException {
        WebMapTileServer wmts = new WebMapTileServer(server);
        WMTSCapabilities capabilities = wmts.getCapabilities();
        CoordinateReferenceSystem crs = CRS.decode("EPSG:3857");
        // layer bboxes
        ReferencedEnvelope envelope =
                new ReferencedEnvelope(
                        181896.32913603852,
                        1086312.9422175875,
                        6091282.433471196,
                        7689478.305598114,
                        crs);

        // first envelope 5th zoom level
        ReferencedEnvelope re1 =
                new ReferencedEnvelope(
                        -9772.986997677013,
                        3743054.020110313,
                        6674950.119413431,
                        1.042777712652142E7,
                        crs);
        RenderedImage ri1 =
                getRenderImageResult(wmts, capabilities, envelope, re1, "topowebb_nedtonad");
        File img1 = new File(getClass().getResource("wmtsTestResultZoom5.png").getFile());
        ImageAssert.assertEquals(img1, ri1, 50);
        // second envelope 7th zoomLevel
        ReferencedEnvelope re2 =
                new ReferencedEnvelope(
                        381146.49290940526,
                        1441515.582157366,
                        7403037.65074037,
                        9279451.154294366,
                        crs);
        RenderedImage ri2 =
                getRenderImageResult(wmts, capabilities, envelope, re2, "topowebb_nedtonad");
        File img2 = new File(getClass().getResource("wmtsTestResultZoom7.png").getFile());
        ImageAssert.assertEquals(img2, ri2, 100);
    }

