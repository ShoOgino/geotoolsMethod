    /**
     * Builds a new WMS coverage reader
     *
     * @param server
     * @param layer
     */
    public WMTSCoverageReader(WebMapTileServer server, org.geotools.data.ows.Layer layer) {
        this.wmts = server;

        // init the reader
        setLayer(layer);

        // best guess at the format with a preference for PNG (since it's
        // normally transparent)
        List<String> formats = ((WMTSLayer) layer).getFormats();// wms2.getCapabilities().getRequest().getGetTile().getFormats();
        this.format = formats.iterator().next();
        for (String f : formats) {
            if ("image/png".equals(f) || "image/png24".equals(f) || "png".equals(f)
                    || "png24".equals(f) || "image/png; mode=24bit".equals(f)) {
                this.format = f;
                break;
            }
        }

    }

