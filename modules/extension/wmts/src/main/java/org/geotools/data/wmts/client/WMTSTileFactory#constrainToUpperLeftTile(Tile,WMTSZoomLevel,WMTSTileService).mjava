    /** If the tile is outside the limits, take a valid one which can be used to start a loop on. */
    public WMTSTile constrainToUpperLeftTile(
            Tile matrixTile, WMTSZoomLevel zl, WMTSTileService service) {

        TileMatrixLimits limits =
                getLimits(service.getMatrixSetLink(), service.getMatrixSet(), zl.getZoomLevel());

        long origxTile = matrixTile.getTileIdentifier().getX();
        long origyTile = matrixTile.getTileIdentifier().getY();
        long xTile = origxTile;
        long yTile = origyTile;

        if (xTile >= limits.getMaxcol()) xTile = limits.getMaxcol() - 1;
        if (yTile >= limits.getMaxrow()) yTile = limits.getMaxrow() - 1;

        if (xTile < limits.getMincol()) xTile = limits.getMincol();
        if (yTile < limits.getMinrow()) yTile = limits.getMinrow();

        if (origxTile != xTile || origyTile != yTile) {
            if (LOGGER.isLoggable(Level.FINE)) {
                LOGGER.fine(
                        "findUpperLeftTile: constraining tile within limits: ("
                                + origxTile
                                + ","
                                + origyTile
                                + ") -> ("
                                + xTile
                                + ","
                                + yTile
                                + ")");
            }
        }

        return new WMTSTile((int) xTile, (int) yTile, zl, service);
    }

