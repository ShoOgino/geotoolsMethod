    private InputStream setupInputStream(URL url, Map<String, String> headers) throws IOException {
        HttpClient client = this.service.getHttpClient();
        String uri = url.toExternalForm();

        if (LOGGER.isLoggable(Level.FINE)) LOGGER.log(Level.FINE, "URL is " + uri);

        HttpMethod get = new GetMethod(uri);
        get.setDoAuthentication(true);
        if (MapUtils.isNotEmpty(headers)) {
            for (String headerName : headers.keySet()) {
                if (LOGGER.isLoggable(Level.FINE)) {
                    LOGGER.log(
                            Level.FINE,
                            "Adding header " + headerName + " = " + headers.get(headerName));
                }
                get.addRequestHeader(headerName, headers.get(headerName));
            }
        }

        int code = client.executeMethod(get);
        if (code != 200) {
            throw new IOException("Connection returned code " + code);
        }

        return get.getResponseBodyAsStream();
    }

