    private URL getKVPurl(String baseUrl, TileIdentifier tileIdentifier) throws RuntimeException
    {
        //in theory it should end with ? but there may be other params that the server needs out of spec
        if(!baseUrl.contains("?")) {

            baseUrl+="?";
        }
        HashMap<String, Object> params = new HashMap<>();
        params.put("service", "WMTS");
        params.put("version", "1.0.0");
        params.put("request", "getTile");
        params.put("layer",  service.getLayerName());
        params.put("style",  service.getStyleName());
        params.put("format", service.getFormat());
        params.put("tilematrixset", service.getTileMatrixSetName());
//        params.put("TileMatrix", service.getTileMatrixSetName()+":"+tileIdentifier.getZ());
//        params.put("TileMatrix", tileIdentifier.getZ());
        params.put("TileMatrix", service.getTileMatrix(tileIdentifier.getZ()).getIdentifier());
        params.put("TileCol", tileIdentifier.getX());
        params.put("TileRow", tileIdentifier.getY());

        StringBuilder arguments = new StringBuilder();
        for(String p:params.keySet()) {
            try {
                arguments.append(p).append("=").append(URLEncoder.encode(params.get(p).toString(),"UTF-8"));
                arguments.append('&');
            }catch (Exception e) {
                // TODO: handle exception
            }
        }
        try {
            return new URL(baseUrl+arguments.toString());
        } catch (MalformedURLException e) {
            //I'm pretty sure this never happens!
            throw new RuntimeException(e);
        }
    }

