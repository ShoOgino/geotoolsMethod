    @Override
    public URL getFinalURL() {
        String requestUrl = onlineResource.toString();
        if (WMTSServiceType.REST.equals(type)) {
            requestUrl = layer.getTemplate(format);
            if (requestUrl == null) {
                if (LOGGER.isLoggable(Level.INFO))
                    LOGGER.info("Template URL not available for format  " + format);
                // format = layer.getFormats().get(0);
                if (LOGGER.isLoggable(Level.FINE)) {
                    LOGGER.fine(
                            "Available formats: " + layer.getFormats() + " -- Selecting " + format);
                }
                requestUrl = layer.getTemplate(format);
            }
        }
        URL ret = null;
        try {
            ret = new URL(requestUrl);
        } catch (MalformedURLException e) {
            // TODO Auto-generated catch block
            e.printStackTrace();
        }
        return ret;
    }

