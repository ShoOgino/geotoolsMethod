    public WMSCoverageReader(WebMapServer wms, Layer layer, String style) {
        this.wms = wms;

        // init the reader
        addLayer(layer, style);

        // best guess at the format with a preference for PNG (since it's normally transparent)
        List<String> formats = wms.getCapabilities().getRequest().getGetMap().getFormats();
        this.format = formats.iterator().next();
        for (String format : formats) {
            if ("image/png".equals(format) || "image/png24".equals(format) || "png".equals(format)
                    || "png24".equals(format) || "image/png; mode=24bit".equals(format)) {
                this.format = format;
                break;
            }
        }
    }

