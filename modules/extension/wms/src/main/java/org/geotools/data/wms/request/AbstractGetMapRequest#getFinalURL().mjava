    public URL getFinalURL() {
        if (!layers.isEmpty()) {
            String layerString = ""; //$NON-NLS-1$
            String styleString = ""; //$NON-NLS-1$
    
            ListIterator layerIter = layers.listIterator(layers.size());
            ListIterator styleIter = styles.listIterator(styles.size());
            while (layerIter.hasPrevious()) {
    
                String layerName = (String) layerIter.previous();
                String styleName = (String) styleIter.previous();
                
                try {
                    layerString = layerString + URLEncoder.encode(layerName, "UTF-8");
                } catch (UnsupportedEncodingException e) {
                    layerString = layerString + layerName;
                }
                styleName = styleName == null ? "" : styleName;
                try {

                    styleString = styleString + URLEncoder.encode(styleName, "UTF-8");
                } catch (UnsupportedEncodingException e1) {
                    styleString = styleString + styleName;
                }
                
                if (layerIter.hasPrevious()) {
                    layerString = layerString + ","; //$NON-NLS-1$
                    styleString = styleString + ","; //$NON-NLS-1$
                }
            }
            
            setProperty(LAYERS, layerString);
            setProperty(STYLES, styleString);
        }
        
        return super.getFinalURL();
    }

