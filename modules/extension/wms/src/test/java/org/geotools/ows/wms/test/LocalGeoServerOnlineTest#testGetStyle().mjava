    public void testGetStyle() throws Exception {

        String baseUrl = LocalGeoServerOnlineTest.LOCAL_GEOSERVER;
        String layers = LocalGeoServerOnlineTest.LOCAL_LAYERS;

        URL url = new URL(baseUrl);

        GetStylesResponse wmsResponse = null;
        GetStylesRequest wmsRequest = null;
        StyleFactory styleFactory = new StyleFactoryImpl();

        WebMapServer server =
                new WebMapServer(url) {
                    // GetStyle is only implemented in WMS 1.1.1
                    protected void setupSpecifications() {
                        specs = new Specification[1];
                        specs[0] = new WMS1_1_1();
                    }
                };

        wmsRequest = server.createGetStylesRequest();
        wmsRequest.setLayers(layers);
        // Test URL
        String queryParamters = wmsRequest.getFinalURL().getQuery();
        Map parameters = new HashMap();
        String[] rawParameters = queryParamters.split("&");
        for (String param : rawParameters) {
            String[] keyValue = param.split("=");
            parameters.put(keyValue[0], keyValue[1]);
        }

        assertTrue(parameters.size() >= 4);
        assertEquals("WMS", parameters.get("SERVICE"));
        assertEquals("GetStyles", parameters.get("REQUEST"));
        assertEquals("1.1.1", parameters.get("VERSION"));
        assertEquals(layers, parameters.get("LAYERS"));

        wmsResponse = server.issueRequest(wmsRequest);

        // Set encoding of response from HTTP content-type header
        ContentType contentType = new ContentType(wmsResponse.getContentType());
        InputStreamReader stream;
        if (contentType.getParameter("charset") != null)
            stream =
                    new InputStreamReader(
                            wmsResponse.getInputStream(), contentType.getParameter("charset"));
        else stream = new InputStreamReader(wmsResponse.getInputStream());

        Style[] styles = (new SLDParser(styleFactory, stream)).readXML();

        assert styles.length > 0;

        SLDTransformer styleTransform = new SLDTransformer();
        StyledLayerDescriptorBuilder SLDBuilder = new StyledLayerDescriptorBuilder();

        NamedLayerBuilder namedLayerBuilder = SLDBuilder.namedLayer();
        namedLayerBuilder.name(layers);
        StyleBuilder styleBuilder = namedLayerBuilder.style();

        for (int i = 0; i < styles.length; i++) {
            styleBuilder.reset(styles[i]);
            styles[i] = styleBuilder.build();
        }

        NamedLayer namedLayer = namedLayerBuilder.build();

        for (Style style : styles) namedLayer.addStyle(style);

        StyledLayerDescriptor sld = (new StyledLayerDescriptorBuilder()).build();
        sld.addStyledLayer(namedLayer);
        String xml = styleTransform.transform(sld);
        assert xml.length() > 300;
    }

