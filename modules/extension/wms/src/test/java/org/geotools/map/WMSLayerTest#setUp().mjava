    /**
     * @throws java.lang.Exception
     */
    @Before
    public void setUp() throws Exception {
        MockHttpClient client = new MockHttpClient() {

            public HTTPResponse get(URL url) throws IOException {
                if (url.getQuery().contains("GetCapabilities")) {
                    Map<String, String> params = parseParams(url.getQuery());
                    URL caps = null;
                    if("1.3.0".equals(params.get("VERSION"))) {
                        caps = WMSCoverageReaderTest.class.getResource("caps130.xml");
                    } else if("1.1.0".equals(params.get("VERSION"))) {
                        caps = WMSCoverageReaderTest.class.getResource("caps110.xml");
                    } 
                    return new MockHttpResponse(caps, "text/xml");
                } else {
                    throw new IllegalArgumentException(
                            "Don't know how to handle a get request over " + url.toExternalForm());
                }
            }

        };
        // setup the reader
        server = new WebMapServer(new URL("http://geoserver.org/geoserver/wms"),
                client);
    }

