    /** Test a {@link MBFunction} (type = identity) that returns an enum value. */
    @Test
    public void enumIdentityFunctionTest() throws Exception {
        String jsonStr = "{'property': 'linecap','type': 'identity', 'default':'round'}";
        MBFunction function = new MBFunction(MapboxTestUtils.object(jsonStr));
        assertEquals(
                "Function category is \"property\"",
                EnumSet.of(MBFunction.FunctionCategory.PROPERTY),
                function.category());
        assertEquals(
                "Function type is \"identity\"",
                MBFunction.FunctionType.IDENTITY,
                function.getType());

        Expression outputExpression = function.function(LineJoin.class);

        SimpleFeatureType SAMPLE =
                DataUtilities.createType("SAMPLE", "id:\"\",linecap,location=4326");

        SimpleFeature feature = DataUtilities.createFeature(SAMPLE, "measure1=A|square|POINT(0,0)");
        String output = outputExpression.evaluate(feature, String.class);
        assertEquals("square", output);

        // Check default (for a feature that's missing the function's property)
        SAMPLE = DataUtilities.createType("SAMPLE", "id:\"\",location=4326");
        feature = DataUtilities.createFeature(SAMPLE, "measure1=A|POINT(0,0)");
        output = outputExpression.evaluate(feature, String.class);
        assertEquals("round", output);
    }

