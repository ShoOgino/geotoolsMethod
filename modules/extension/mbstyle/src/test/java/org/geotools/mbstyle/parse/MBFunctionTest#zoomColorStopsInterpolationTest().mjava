    /**
     * Tests that a MapBox linear zoom function (outputting a color) correctly interpolates color
     * values for zoom levels between stops.
     */
    @Test
    public void zoomColorStopsInterpolationTest() throws Exception {
        SimpleFeatureType SAMPLE =
                DataUtilities.createType("SAMPLE", "id:\"\",temperature:0.0,location=4326");
        SimpleFeature feature = DataUtilities.createFeature(SAMPLE, "measure1=A|50.0|POINT(0,0)");

        EnvFunction.setGlobalValue("wms_scale_denominator", "34942641.4969\n");

        JSONObject json =
                MapboxTestUtils.object(
                        "{'type':'exponential', 'stops':[[0,'blue'],[6,'red'],[12, 'lime']]}");

        MBFunction function = new MBFunction(json);
        assertEquals(
                "Is a zoom function",
                EnumSet.of(MBFunction.FunctionCategory.ZOOM),
                function.category());
        assertEquals(MBFunction.FunctionType.EXPONENTIAL, function.getType());

        Function fn = (Function) function.color();
        Expression zoomLevel = fn.getParameters().get(0);
        Number n = zoomLevel.evaluate(null, Number.class);
        // This should be zoom level 3
        assertEquals(3.0, n.doubleValue(), .000001);

        Color result = fn.evaluate(feature, Color.class);
        assertEquals(new Color(128, 0, 127), result);

        EnvFunction.setGlobalValue("wms_scale_denominator", "4367830.18712");
        n = zoomLevel.evaluate(null, Number.class);
        // This should be zoom level 6
        assertEquals(6.0, n.doubleValue(), .000001);
        result = fn.evaluate(feature, Color.class);
        assertEquals(new Color(255, 0, 0), result);

        EnvFunction.setGlobalValue("wms_scale_denominator", "545978.773389");
        n = zoomLevel.evaluate(null, Number.class);
        // This should be zoom level 9
        assertEquals(9.0, n.doubleValue(), .000001);
        result = fn.evaluate(feature, Color.class);
        assertEquals(new Color(127, 128, 0), result);

        EnvFunction.setGlobalValue("wms_scale_denominator", "68247.3466735");
        n = zoomLevel.evaluate(null, Number.class);
        // This should be zoom level 12
        assertEquals(12.0, n.doubleValue(), .000001);
        result = fn.evaluate(feature, Color.class);
        assertEquals(new Color(0, 255, 0), result);
    }

