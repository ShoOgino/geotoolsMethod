    private void assertGridSizeAndIds(SimpleFeatureSource gridSource) throws Exception {
        SimpleFeatureCollection grid = gridSource.getFeatures();
        assertEquals(expectedNumElements, grid.size());

        boolean[] flag = new boolean[expectedNumElements + 1];
        int count = 0;

        try (SimpleFeatureIterator iter = grid.features()) {
            while (iter.hasNext()) {
                SimpleFeature f = iter.next();
                int id = (Integer) f.getAttribute("id");
                assertNotEquals(0, id);
                assertFalse(flag[id]);
                flag[id] = true;
                count++;
            }
        }

        assertEquals(expectedNumElements, count);
    }

