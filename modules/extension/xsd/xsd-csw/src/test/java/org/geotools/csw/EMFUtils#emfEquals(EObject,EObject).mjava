    public static boolean emfEquals(EObject e1, EObject e2) {
        if (e1 == e2) {
            return true;
        } else if (!e1.eClass().equals(e2.eClass())) {
            return false;
        }

        for (EStructuralFeature sf : e1.eClass().getEAllStructuralFeatures()) {
            Object o1 = e1.eGet(sf);
            Object o2 = e2.eGet(sf);
            if (o1 instanceof FeatureMap) {
                // this is just extra stuff that EMF adds when there is a substitution group
                continue;
            }
            boolean equals = objectEquals(o1, o2);

            if (!equals) {
                LOGGER.fine("Comparison failed on " + sf + " o1 has " + o1 + " while o2 has " + o2);
                return false;
            }
        }

        return true;
    }

