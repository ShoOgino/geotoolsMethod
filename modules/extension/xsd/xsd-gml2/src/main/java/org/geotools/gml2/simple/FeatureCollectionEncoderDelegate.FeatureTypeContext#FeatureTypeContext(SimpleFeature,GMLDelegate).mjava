        public FeatureTypeContext(SimpleFeature f, GMLDelegate gml) {
            this.featureType = f.getFeatureType();
            QName featureName =
                    new QName(
                            featureType.getName().getNamespaceURI(),
                            featureType.getName().getLocalPart());

            // look up the element in the schema
            XSDElementDeclaration element =
                    encoder.getSchemaIndex().getElementDeclaration(featureName);
            if (element == null) {
                // create one
                element = XSDFactory.eINSTANCE.createXSDElementDeclaration();
                element.setName(featureType.getName().getLocalPart());
                element.setTargetNamespace(featureType.getName().getNamespaceURI());
                element.setTypeDefinition(
                        encoder.getSchemaIndex().getTypeDefinition(GML.AbstractFeatureType));
            }

            // look up all the bindings for each property
            BindingLoader bindingLoader = encoder.getBindingLoader();

            // get all the properties
            List properties = gml.getFeatureProperties(f, element, encoder);

            attributes = setupAttributeContexts(properties, featureType, bindingLoader);

            featureQualifiedName = getFeatureQualifiedName(featureName);
        }

