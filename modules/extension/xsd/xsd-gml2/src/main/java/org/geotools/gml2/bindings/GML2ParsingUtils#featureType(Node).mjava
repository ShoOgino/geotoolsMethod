    /**
     * Turns a parse node instance into a geotools feature type.
     *
     * <p>For each child element and attribute of the node a geotools attribute type is created.
     * AttributeType#getName() is derived from the name of the child element / attribute.
     * Attribute#getType() is derived from the class of the value of the child element / attribute.
     *
     * <p>Attribute types for the mandatory properties of any gml feature type
     * (description,name,boundedBy) are also created.
     *
     * @param node The parse node / tree for the feature.
     * @return A geotools feature type
     */
    public static SimpleFeatureType featureType(Node node) throws Exception {
        SimpleFeatureTypeBuilder ftBuilder = new SimpleFeatureTypeBuilder();
        ftBuilder.setName(node.getComponent().getName());
        ftBuilder.setNamespaceURI(node.getComponent().getNamespace());
        ftBuilder.setCRS(null); // JD: set explicitly to null to avoid warning

        CoordinateReferenceSystem crs = null;

        // mandatory gml attributes
        if (!node.hasChild("description")) {
            ftBuilder.add("description", String.class);
        }

        if (!node.hasChild("name")) {
            ftBuilder.add("name", String.class);
        }

        if (!node.hasChild("boundedBy")) {
            ftBuilder.add("boundedBy", ReferencedEnvelope.class);
        } else {
            if (node.getChild("boundedBy").hasChild("Box")) {
                crs = crs(node.getChild("boundedBy").getChild("Box"));
            } else if (node.getChild("boundedBy").hasChild("Envelope")) {
                crs = crs(node.getChild("boundedBy").getChild("Envelope"));
            }
        }

        // application schema defined attributes
        for (Iterator c = node.getChildren().iterator(); c.hasNext(); ) {
            Node child = (Node) c.next();
            String name = child.getComponent().getName();
            Object value = child.getValue();

            // if the next property is of type geometry, let's set its CRS
            if (value != null && Geometry.class.isAssignableFrom(value.getClass()) && crs != null) {
                ftBuilder.crs(crs);
            }

            ftBuilder.add(name, (value != null) ? value.getClass() : Object.class);
        }
        ftBuilder.userData(PARSED_FROM_SCHEMA_KEY, false);

        return ftBuilder.buildFeatureType();
    }

