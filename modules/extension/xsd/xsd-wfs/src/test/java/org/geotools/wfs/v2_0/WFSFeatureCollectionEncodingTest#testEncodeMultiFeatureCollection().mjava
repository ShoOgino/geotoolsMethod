    @Test
    @SuppressWarnings("unchecked")
    public void testEncodeMultiFeatureCollection() throws Exception {
        FeatureCollectionType fc = WfsFactory.eINSTANCE.createFeatureCollectionType();

        fc.getFeature().add(store.getFeatureSource("feature").getFeatures());
        fc.getFeature().add(store.getFeatureSource("other").getFeatures());

        Encoder e = encoder();
        e.getNamespaces().declarePrefix("geotools", "http://geotools.org");
        e.setIndenting(true);

        Document d = e.encodeAsDOM(fc, WFS.FeatureCollection);
        XMLTestSupport.print(d);

        List<Element> members = getChildElementsByTagName(d.getDocumentElement(), "wfs:member");
        Assert.assertEquals(2, members.size());

        Assert.assertEquals(
                1, getChildElementsByTagName(members.get(0), "wfs:FeatureCollection").size());

        Element featureCollection =
                getChildElementsByTagName(members.get(0), "wfs:FeatureCollection").get(0);

        Assert.assertEquals(2, getChildElementsByTagName(featureCollection, "wfs:member").size());
        Assert.assertEquals(2, featureCollection.getElementsByTagName("gml:Point").getLength());
        Assert.assertEquals(2, featureCollection.getElementsByTagName("gml:pos").getLength());
        Assert.assertEquals(0, featureCollection.getElementsByTagName("gml:coord").getLength());

        Assert.assertEquals(
                1, getChildElementsByTagName(members.get(1), "wfs:FeatureCollection").size());

        featureCollection =
                getChildElementsByTagName(members.get(1), "wfs:FeatureCollection").get(0);

        Assert.assertEquals(2, getChildElementsByTagName(featureCollection, "wfs:member").size());
        Assert.assertEquals(2, featureCollection.getElementsByTagName("gml:Point").getLength());
        Assert.assertEquals(2, featureCollection.getElementsByTagName("gml:pos").getLength());
        Assert.assertEquals(0, featureCollection.getElementsByTagName("gml:coord").getLength());
    }

