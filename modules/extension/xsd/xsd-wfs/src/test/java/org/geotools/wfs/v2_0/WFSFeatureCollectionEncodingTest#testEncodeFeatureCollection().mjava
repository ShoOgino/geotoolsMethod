    @Test
    @SuppressWarnings("unchecked")
    public void testEncodeFeatureCollection() throws Exception {
        FeatureCollectionType fc = WfsFactory.eINSTANCE.createFeatureCollectionType();
        FeatureCollection features = store.getFeatureSource("feature").getFeatures();
        fc.getFeature().add(features);

        Encoder e = encoder();
        e.getNamespaces().declarePrefix("geotools", "http://geotools.org");
        e.setIndenting(true);

        Document d = e.encodeAsDOM(fc, WFS.FeatureCollection);
        // XMLTestSupport.print(d);

        NamedNodeMap attributes = d.getDocumentElement().getAttributes();
        Assert.assertEquals("unknown", attributes.getNamedItem("numberMatched").getTextContent());
        Assert.assertEquals(1, d.getElementsByTagName("wfs:boundedBy").getLength());
        Assert.assertEquals(2, d.getElementsByTagName("gml:boundedBy").getLength());
        Assert.assertEquals(2, d.getElementsByTagName("wfs:member").getLength());
        Assert.assertEquals(2, d.getElementsByTagName("gml:Point").getLength());
        Assert.assertEquals(2, d.getElementsByTagName("gml:pos").getLength());
        Assert.assertEquals(0, d.getElementsByTagName("gml:coord").getLength());

        // check ids
        Assert.assertEquals(
                "zero.geometry",
                d.getElementsByTagName("gml:Point")
                        .item(0)
                        .getAttributes()
                        .getNamedItem("gml:id")
                        .getNodeValue());
        Assert.assertEquals(
                "one.geometry",
                d.getElementsByTagName("gml:Point")
                        .item(1)
                        .getAttributes()
                        .getNamedItem("gml:id")
                        .getNodeValue());

        XMLAssert.assertEquals(2, d.getElementsByTagName("geotools:feature").getLength());

        Assert.assertNotNull(
                ((Element) d.getElementsByTagName("geotools:feature").item(0))
                        .getAttribute("gml:id"));
    }

