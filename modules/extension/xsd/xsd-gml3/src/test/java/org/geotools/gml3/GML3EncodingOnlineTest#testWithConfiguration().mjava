    @Test
    public void testWithConfiguration() throws Exception {
        if (isOffline()) {
            return;
        }

        TestConfiguration configuration = new TestConfiguration();

        // first parse in test data
        Parser parser = new Parser(configuration);
        SimpleFeatureCollection fc =
                (SimpleFeatureCollection)
                        parser.parse(TestConfiguration.class.getResourceAsStream("test.xml"));
        Assert.assertNotNull(fc);

        XSDSchema schema = TEST.getInstance().getSchema();
        Assert.assertNotNull(schema);

        Encoder encoder = new Encoder(configuration, schema);
        ByteArrayOutputStream output = new ByteArrayOutputStream();
        encoder.encode(fc, TEST.TestFeatureCollection, output);

        validate(output.toByteArray(), configuration);
    }

