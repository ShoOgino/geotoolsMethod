    /**
     * Encodes an object directly to a dom.
     *
     * <p>Note that this method should be used for testing or convenience since it does not stream
     * and loads the entire encoded result into memory.
     */
    public Document encodeAsDOM(Object object, QName name)
            throws IOException, SAXException, TransformerException {
        ByteArrayOutputStream out = new ByteArrayOutputStream();
        encode(object, name, out);

        ByteArrayInputStream in = new ByteArrayInputStream(out.toByteArray());
        DOMResult result = new DOMResult();
        Transformer tx = TransformerFactory.newInstance().newTransformer();
        tx.transform(new StreamSource(in), result);
        return (Document) result.getNode();
    }

