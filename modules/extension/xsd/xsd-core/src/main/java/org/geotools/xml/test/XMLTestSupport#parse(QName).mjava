    /**
     * Parses the build document, explicity specifying the type of the root
     * element.
     * <p>
     * This method should be called after building the entire document.
     *</p>
     * @param type The name of the type of the root element of the build document.
     */
    protected Object parse(QName type) throws Exception {
        Element root = document.getDocumentElement();

        if (root == null) {
            throw new IllegalStateException("Document has no root element");
        }

        Configuration config = createConfiguration();

        if (type != null) {
            config.getContext().registerComponentInstance("http://geotools.org/typeDefinition", type);
        }

        //register additional namespaces
        registerNamespaces(root);
        for ( Iterator e = namespaceMappings.entrySet().iterator(); e.hasNext(); ) {
            Map.Entry mapping = (Map.Entry) e.next();
            String prefix = (String) mapping.getKey();
            String uri = (String) mapping.getValue();
            
            root.setAttribute("xmlns:" + prefix, uri );
        }
        
        //default
        root.setAttribute("xsi:schemaLocation",
            config.getNamespaceURI() + " " + config.getSchemaFileURL());

        DOMParser parser = new DOMParser(config, document);

        return parser.parse();
    }

