    public static final XSDSchema parse(String location, ResourceSet resourceSet)
        throws IOException {
        //check for case of file url, make sure it is an absolute reference
        File locationFile = null;
        try {
            locationFile = URLs.urlToFile(new URL(location));
        } catch (MalformedURLException e) {
            // Some tests use relative file URLs, which Schemas.parse cannot
            // support as it does not permit a context URL. Treat them
            // as local file paths. Naughty, naughty.
            locationFile = new File(location);
        }
        if (locationFile != null && locationFile.exists()) {
            location = locationFile.getCanonicalFile().toURI().toString();
        }

        URI uri = URI.createURI(location);

        XSDResourceImpl xsdMainResource = (XSDResourceImpl) resourceSet.createResource(URI.createURI(
                    ".xsd"));
        xsdMainResource.setURI(uri);

        // read resource before synchronize: Shorter lock duration and prevention of deadlock
        // if remote schema is created on same JVM and synchronizes on Schemas, too.
        Map<Object, Object> options = resourceSet.getLoadOptions();
        Map<?, ?> response = getOrCreateResponseFrom(options);
        byte[] resourceData = readUriResource(uri, resourceSet, response);
                
        // schema building has effects on referenced schemas, it will alter them -> we need 
        // to synchronize this call so that only one of these operations is active at any time
        synchronized (Schemas.class) {
            try (InputStream in = new ByteArrayInputStream(resourceData)) {
                xsdMainResource.load(in, options);
            } finally {
                Long timeStamp = (Long) response.get(URIConverter.RESPONSE_TIME_STAMP_PROPERTY);
                if (timeStamp != null) {
                    xsdMainResource.setTimeStamp(timeStamp);
                }
            }
            XSDSchema schema = xsdMainResource.getSchema();
            if (schema != null) {
                // if schema contains no element declarations, nor type definitions,
                // force import of external schemas (if any), since it does not happen automatically;
                // import can be forced no matter what is in the importing schema by setting
                // the system property "org.geotools.xml.forceSchemaImport" to "true".
                String forceSchemaImport = System.getProperty(FORCE_SCHEMA_IMPORT);
                boolean alwaysForce = false;
                if (forceSchemaImport != null) {
                    alwaysForce = forceSchemaImport.equalsIgnoreCase("true");
                }
                if (alwaysForce || hasNoElementsNorTypes(schema)) {
                    forceImport((XSDSchemaImpl) schema);
                }
            }

            return schema;
        }
    }

