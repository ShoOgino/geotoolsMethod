    /**
     * Fetches the contents of the URI into a local {@link InputStream}.
     * 
     * @param uri
     * @param options
     * @param response
     * @return A local resource
     * @throws IOException
     */
    private static InputStream readUriResource(URI uri, ResourceSet resourceSet, Map<?, ?> response)
            throws IOException {
        Map<Object, Object> options = resourceSet.getLoadOptions();
        URIConverter uriConverter = getUriConverter(resourceSet);

        Map<Object, Object> loadMap = new HashMap<>(options);
        loadMap.put(URIConverter.OPTION_RESPONSE, response);

        InputStream inputStream = uriConverter.createInputStream(uri, loadMap);
        ByteArrayOutputStream out = new ByteArrayOutputStream();
        try {
            IOUtils.copy(inputStream, out);
        } finally {
            inputStream.close();
        }
        inputStream = new ByteArrayInputStream(out.toByteArray());
        return inputStream;
    }

