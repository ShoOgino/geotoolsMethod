    @Override
    @SuppressWarnings("unchecked")
    public Object getImmediateNode() {

        // first try regular way
        if (feature instanceof ComplexAttribute) {
            ComplexAttribute ca = (ComplexAttribute) feature;
            Property p = ca.getProperty("@" + name.getLocalPart());
            if (p != null) {
                return p;
            }
        }

        // FIXME - better id checking
        if (name.getLocalPart().equals("id")) {
            Identifier id = feature.getIdentifier();
            if (id != null) {
                return id.getID();
            }
        }
        Map<Name, Object> map = (Map<Name, Object>) feature.getUserData().get(Attributes.class);
        if (map != null) {
            return map.get(name);
        } else {
            return null;
        }
    }

