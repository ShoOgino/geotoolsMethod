    /** Re-Projects the given envelope to destinationCRS using transformation. */
    public static ReferencedEnvelope getProjectedEnvelope(
            ReferencedEnvelope envelope,
            CoordinateReferenceSystem destinationCRS,
            MathTransform transformation)
            throws TransformException, FactoryException {

        CoordinateReferenceSystem sourceCRS = envelope.getCoordinateReferenceSystem();

        if (sourceCRS.equals(destinationCRS)) {
            // no need to reproject
            return envelope;

        } else {
            // Reproject envelope: first try JTS.transform, if that fails use
            // ReferencedEnvelope.transform
            try {

                return new ReferencedEnvelope(
                        JTS.transform(envelope, transformation), destinationCRS);
            } catch (Exception exc) {

                return envelope.transform(destinationCRS, false);
            }
        }
    }

